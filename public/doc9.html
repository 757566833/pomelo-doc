<!DOCTYPE html>
<!-- saved from url=(0077)https://web.archive.org/web/20170521095639/http://pomelo.netease.com/api.html -->
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="./pomelo API_files/analytics.js.下载" type="text/javascript"></script>
  <script
    type="text/javascript">window.addEventListener('DOMContentLoaded', function () { var v = archive_analytics.values; v.service = 'wb'; v.server_name = 'wwwb-app103.us.archive.org'; v.server_ms = 145; archive_analytics.send_pageview({}); });</script>
  <script type="text/javascript" src="./pomelo API_files/ait-client-rewrite.js.下载" charset="utf-8"></script>
  <script type="text/javascript">
    WB_wombat_Init("https://web.archive.org/web", "20170521095639", "pomelo.netease.com:80");
  </script>
  <script type="text/javascript" src="./pomelo API_files/wbhack.js.下载" charset="utf-8"></script>
  <script type="text/javascript">
    __wbhack.init('https://web.archive.org/web');
  </script>
  <link rel="stylesheet" type="text/css" href="./pomelo API_files/banner-styles.css">
  <link rel="stylesheet" type="text/css" href="./pomelo API_files/iconochive.css">
  <!-- End Wayback Rewrite JS Include -->


  <title>pomelo API</title>
  <meta http-equiv="content-type" content="text/html">
  <meta http-equiv="content-style-type" content="text/css">
  <meta http-equiv="content-script-type" content="text/javascript">
  <meta name="author" content="netease">
  <meta name="version" content="1.0">
  <meta name="keywords" content="pomelo, game, framework, lordofpomelo, node.js, js, 网易，游戏">
  <meta name="description"
    content="Pomelo is a fast, scalable, distributed game server framework for Node.js. It provides the basic development framework and a lot of related components, including libraries and tools. Pomelo is also suitable for realtime web application, its distributed architecture makes Pomelo scale better than other realtime web frameworks.">


  <link type="text/css" rel="stylesheet" href="./pomelo API_files/base.css">
  <link type="text/css" rel="stylesheet" href="./pomelo API_files/api.css">
  <link type="text/css" rel="stylesheet" href="./doc/mk.css">
  <script>
    var raw = [{ "id": "1-1387877793311", "name": "Application", "signiture": "Application", "type": "declaration", "ctx": { "type": "declaration", "name": "Application", "value": "module.exports = {}", "string": "Application" }, "description": { "full": "<p>Application prototype.</p>", "summary": "<p>Application prototype.</p>", "body": "" }, "full_description": "<p>Application prototype.</p>", "code": "var Application = module.exports = {};", "params": [], "has_params": false, "tags": [{ "type": "module", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "4-1387877793311", "name": "getBase", "signiture": "Application.getBase()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getBase", "string": "Application.getBase()" }, "description": { "full": "<p>Get application base path</p>\n\n<p>// cwd: /home/game/<br /> pomelo start<br /> // app.getBase() -> /home/game</p>", "summary": "<p>Get application base path</p>", "body": "<p>// cwd: /home/game/<br /> pomelo start<br /> // app.getBase() -> /home/game</p>" }, "full_description": "<p>Get application base path</p>\n\n<p>// cwd: /home/game/  pomelo start  // app.getBase() -> /home/game</p>", "code": "Application.getBase = function() {\n  return this.get(Constants.Reserved.BASE);\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["String"], "description": "application base path" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "5-1387877793311", "name": "filter", "signiture": "Application.filter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "filter", "string": "Application.filter()" }, "description": { "full": "<p>add a filter to before and after filter</p>", "summary": "<p>add a filter to before and after filter</p>", "body": "" }, "full_description": "<p>add a filter to before and after filter</p>", "code": "Application.filter = function (filter) {\n  this.before(filter);\n  this.after(filter);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }, { "type": "", "string": "A filter should have two methods: before and after." }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "6-1387877793311", "name": "before", "signiture": "Application.before()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "before", "string": "Application.before()" }, "description": { "full": "<p>Add before filter.</p>", "summary": "<p>Add before filter.</p>", "body": "" }, "full_description": "<p>Add before filter.</p>", "code": "Application.before = function (bf) {\n  addFilter(this, Constants.KeyWords.BEFORE_FILTER, bf);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "7-1387877793311", "name": "after", "signiture": "Application.after()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "after", "string": "Application.after()" }, "description": { "full": "<p>Add after filter.</p>", "summary": "<p>Add after filter.</p>", "body": "" }, "full_description": "<p>Add after filter.</p>", "code": "Application.after = function (af) {\n  addFilter(this, Constants.KeyWords.AFTER_FILTER, af);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "8-1387877793311", "name": "globalFilter", "signiture": "Application.globalFilter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "globalFilter", "string": "Application.globalFilter()" }, "description": { "full": "<p>add a global filter to before and after global filter</p>", "summary": "<p>add a global filter to before and after global filter</p>", "body": "" }, "full_description": "<p>add a global filter to before and after global filter</p>", "code": "Application.globalFilter = function (filter) {\n  this.globalBefore(filter);\n  this.globalAfter(filter);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }, { "type": "", "string": "A filter should have two methods: before and after." }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "9-1387877793311", "name": "globalBefore", "signiture": "Application.globalBefore()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "globalBefore", "string": "Application.globalBefore()" }, "description": { "full": "<p>Add global before filter.</p>", "summary": "<p>Add global before filter.</p>", "body": "" }, "full_description": "<p>Add global before filter.</p>", "code": "Application.globalBefore = function (bf) {\n  addFilter(this, Constants.KeyWords.GLOBAL_BEFORE_FILTER, bf);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "10-1387877793311", "name": "globalAfter", "signiture": "Application.globalAfter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "globalAfter", "string": "Application.globalAfter()" }, "description": { "full": "<p>Add global after filter.</p>", "summary": "<p>Add global after filter.</p>", "body": "" }, "full_description": "<p>Add global after filter.</p>", "code": "Application.globalAfter = function (af) {\n  addFilter(this, Constants.KeyWords.GLOBAL_AFTER_FILTER, af);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "11-1387877793311", "name": "rpcBefore", "signiture": "Application.rpcBefore()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "rpcBefore", "string": "Application.rpcBefore()" }, "description": { "full": "<p>Add rpc before filter.</p>", "summary": "<p>Add rpc before filter.</p>", "body": "" }, "full_description": "<p>Add rpc before filter.</p>", "code": "Application.rpcBefore = function(bf) {\n  addFilter(this, Constants.KeyWords.RPC_BEFORE_FILTER, bf);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(serverId, msg, opts, next)" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(serverId, msg, opts, next)" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "12-1387877793311", "name": "rpcAfter", "signiture": "Application.rpcAfter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "rpcAfter", "string": "Application.rpcAfter()" }, "description": { "full": "<p>Add rpc after filter.</p>", "summary": "<p>Add rpc after filter.</p>", "body": "" }, "full_description": "<p>Add rpc after filter.</p>", "code": "Application.rpcAfter = function(af) {\n  addFilter(this, Constants.KeyWords.RPC_AFTER_FILTER, af);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(serverId, msg, opts, next)`" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(serverId, msg, opts, next)`" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "13-1387877793311", "name": "rpcFilter", "signiture": "Application.rpcFilter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "rpcFilter", "string": "Application.rpcFilter()" }, "description": { "full": "<p>add a rpc filter to before and after rpc filter</p>", "summary": "<p>add a rpc filter to before and after rpc filter</p>", "body": "" }, "full_description": "<p>add a rpc filter to before and after rpc filter</p>", "code": "Application.rpcFilter = function(filter) {\n  this.rpcBefore(filter);\n  this.rpcAfter(filter);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }, { "type": "", "string": "A filter should have two methods: before and after." }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "14-1387877793311", "name": "load", "signiture": "Application.load()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "load", "string": "Application.load()" }, "description": { "full": "<p>Load component</p>", "summary": "<p>Load component</p>", "body": "" }, "full_description": "<p>Load component</p>", "code": "Application.load = function(name, component, opts) {\n  if(typeof name !== 'string') {\n    opts = component;\n    component = name;\n    name = null;\n    if(typeof component.name === 'string') {\n      name = component.name;\n    }\n  }\n\n  if(typeof component === 'function') {\n    component = component(this, opts);\n  }\n\n  if(!name && typeof component.name === 'string') {\n    name = component.name;\n  }\n\n  if(name && this.components[name]) {\n    // ignore duplicat component\n    logger.warn('ignore duplicate component: %j', name);\n    return;\n  }\n\n  this.loaded.push(component);\n  if(name) {\n    // components with a name would get by name throught app.components later.\n    this.components[name] = component;\n  }\n\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "(optional) name of the component" }, { "type": "param", "types": ["Object"], "name": "component", "description": "component instance or factory function of the component" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "(optional) name of the component" }, { "type": "param", "types": ["Object"], "name": "component", "description": "component instance or factory function of the component" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }, { "type": "return", "types": ["Object"], "description": "app instance for chain invoke" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "15-1387877793311", "name": "loadConfig", "signiture": "Application.loadConfig()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "loadConfig", "string": "Application.loadConfig()" }, "description": { "full": "<p>Load Configure json file to settings.</p>", "summary": "<p>Load Configure json file to settings.</p>", "body": "" }, "full_description": "<p>Load Configure json file to settings.</p>", "code": "Application.loadConfig = function (key, val) {\n  var env = this.get(Constants.Reserved.ENV);\n  val = require(val);\n  if (val[env]) {\n    val = val[env];\n  }\n  this.set(key, val);\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "environment key" }, { "type": "param", "types": ["String"], "name": "val", "description": "environment value" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "environment key" }, { "type": "param", "types": ["String"], "name": "val", "description": "environment value" }, { "type": "return", "types": ["Server", "Mixed"], "description": "for chaining, or the setting value" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "16-1387877793311", "name": "route", "signiture": "Application.route()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "route", "string": "Application.route()" }, "description": { "full": "<p>Set the route function for the specified server type.</p>\n\n<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {<br />   // all request to area would be route to the first area server<br />   var areas = app.getServersByType('area');<br />   cb(null, areas[0].id);<br /> };</p>", "summary": "<p>Set the route function for the specified server type.</p>", "body": "<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {<br />   // all request to area would be route to the first area server<br />   var areas = app.getServersByType('area');<br />   cb(null, areas[0].id);<br /> };</p>" }, "full_description": "<p>Set the route function for the specified server type.</p>\n\n<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {    // all request to area would be route to the first area server    var areas = app.getServersByType('area');    cb(null, areas[0].id);  };</p>", "code": "Application.route = function(serverType, routeFunc) {\n  var routes = this.get(Constants.KeyWords.ROUTE);\n  if(!routes) {\n    routes = {};\n    this.set(Constants.KeyWords.ROUTE, routes);\n  }\n  routes[serverType] = routeFunc;\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type string" }, { "type": "param", "types": ["Function"], "name": "routeFunc", "description": "route function. routeFunc(session, msg, app, cb)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type string" }, { "type": "param", "types": ["Function"], "name": "routeFunc", "description": "route function. routeFunc(session, msg, app, cb)" }, { "type": "return", "types": ["Object"], "description": "current application instance for chain invoking" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "17-1387877793311", "name": "beforeStopHook", "signiture": "Application.beforeStopHook()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "beforeStopHook", "string": "Application.beforeStopHook()" }, "description": { "full": "<p>Set before stop function. It would perform before servers stop.</p>", "summary": "<p>Set before stop function. It would perform before servers stop.</p>", "body": "" }, "full_description": "<p>Set before stop function. It would perform before servers stop.</p>", "code": "Application.beforeStopHook = function(fun) {\n  logger.warn('this method was deprecated in pomelo 0.8');\n  if(!!fun && typeof fun === 'function') {\n    this.set(Constants.KeyWords.BEFORE_STOP_HOOK, fun);\n  }\n};", "params": [{ "type": "param", "types": ["Function"], "name": "fun", "description": "before close function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Function"], "name": "fun", "description": "before close function" }, { "type": "return", "types": ["Void"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "18-1387877793311", "name": "start", "signiture": "Application.start()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "start", "string": "Application.start()" }, "description": { "full": "<p>Start application. It would load the default components and start all the loaded components.</p>", "summary": "<p>Start application. It would load the default components and start all the loaded components.</p>", "body": "" }, "full_description": "<p>Start application. It would load the default components and start all the loaded components.</p>", "code": "Application.start = function(cb) {\n  this.startTime = Date.now();\n  if(this.state > STATE_INITED) {\n    utils.invokeCallback(cb, new Error('application has already start.'));\n    return;\n  }\n  appUtil.loadDefaultComponents(this);\n  var self = this;\n  var startUp = function() {\n    appUtil.optComponents(self.loaded, Constants.Reserved.START, function(err) {\n      self.state = STATE_START;\n      if(err) {\n        utils.invokeCallback(cb, err);\n      } else {\n        logger.info('%j enter after start...', self.getServerId());\n        self.afterStart(cb);\n      }\n    });\n  };\n  var beforeFun = this.lifecycleCbs[Constants.LIFECYCLE.BEFORE_STARTUP];\n  if(!!beforeFun) {\n    beforeFun.call(null, this, startUp);\n  } else {\n    startUp();\n  }\n};", "params": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "21-1387877793311", "name": "set", "signiture": "Application.set()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "set", "string": "Application.set()" }, "description": { "full": "<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>\n\n<p>Example:</p>\n\n<p>app.set('key1', 'value1');<br /> app.get('key1');  // 'value1'<br /> app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);<br /> app.get('key2');  // 'value2'<br /> app.key2;         // 'value2'</p>", "summary": "<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>", "body": "<p>Example:</p>\n\n<p>app.set('key1', 'value1');<br /> app.get('key1');  // 'value1'<br /> app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);<br /> app.get('key2');  // 'value2'<br /> app.key2;         // 'value2'</p>" }, "full_description": "<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>\n\n<p>Example:</p>\n\n<p>app.set('key1', 'value1');  app.get('key1');  // 'value1'  app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);  app.get('key2');  // 'value2'  app.key2;         // 'value2'</p>", "code": "Application.set = function (setting, val, attach) {\n  if (arguments.length === 1) {\n    return this.settings[setting];\n  }\n  this.settings[setting] = val;\n  if(attach) {\n    this[setting] = val;\n  }\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "the setting of application" }, { "type": "param", "types": ["String"], "name": "val", "description": "the setting's value" }, { "type": "param", "types": ["Boolean"], "name": "attach", "description": "whether attach the settings to application" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "the setting of application" }, { "type": "param", "types": ["String"], "name": "val", "description": "the setting's value" }, { "type": "param", "types": ["Boolean"], "name": "attach", "description": "whether attach the settings to application" }, { "type": "return", "types": ["Server", "Mixed"], "description": "for chaining, or the setting value" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "22-1387877793311", "name": "get", "signiture": "Application.get()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "get", "string": "Application.get()" }, "description": { "full": "<p>Get property from setting</p>", "summary": "<p>Get property from setting</p>", "body": "" }, "full_description": "<p>Get property from setting</p>", "code": "Application.get = function (setting) {\n  return this.settings[setting];\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["String"], "description": "val" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "23-1387877793311", "name": "enabled", "signiture": "Application.enabled()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "enabled", "string": "Application.enabled()" }, "description": { "full": "<p>Check if <code>setting</code> is enabled.</p>", "summary": "<p>Check if <code>setting</code> is enabled.</p>", "body": "" }, "full_description": "<p>Check if <code>setting</code> is enabled.</p>", "code": "Application.enabled = function (setting) {\n  return !!this.get(setting);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "24-1387877793311", "name": "disabled", "signiture": "Application.disabled()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "disabled", "string": "Application.disabled()" }, "description": { "full": "<p>Check if <code>setting</code> is disabled.</p>", "summary": "<p>Check if <code>setting</code> is disabled.</p>", "body": "" }, "full_description": "<p>Check if <code>setting</code> is disabled.</p>", "code": "Application.disabled = function (setting) {\n  return !this.get(setting);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "25-1387877793311", "name": "enable", "signiture": "Application.enable()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "enable", "string": "Application.enable()" }, "description": { "full": "<p>Enable <code>setting</code>.</p>", "summary": "<p>Enable <code>setting</code>.</p>", "body": "" }, "full_description": "<p>Enable <code>setting</code>.</p>", "code": "Application.enable = function (setting) {\n  return this.set(setting, true);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["app"], "description": "for chaining" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "26-1387877793311", "name": "disable", "signiture": "Application.disable()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "disable", "string": "Application.disable()" }, "description": { "full": "<p>Disable <code>setting</code>.</p>", "summary": "<p>Disable <code>setting</code>.</p>", "body": "" }, "full_description": "<p>Disable <code>setting</code>.</p>", "code": "Application.disable = function (setting) {\n  return this.set(setting, false);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["app"], "description": "for chaining" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "27-1387877793311", "name": "configure", "signiture": "Application.configure()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "configure", "string": "Application.configure()" }, "description": { "full": "<p>Configure callback for the specified env and server type.<br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified<br />that callback will be invoked for all server types.</p>\n\n<p>Examples:</p>\n\n<p>app.configure(function(){<br />   // executed for all envs and server types<br /> });</p>\n\n<p>app.configure('development', function(){<br />   // executed development env<br /> });</p>\n\n<p>app.configure('development', 'connector', function(){<br />   // executed for development env and connector server type<br /> });</p>", "summary": "<p>Configure callback for the specified env and server type.<br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified<br />that callback will be invoked for all server types.</p>", "body": "<p>Examples:</p>\n\n<p>app.configure(function(){<br />   // executed for all envs and server types<br /> });</p>\n\n<p>app.configure('development', function(){<br />   // executed development env<br /> });</p>\n\n<p>app.configure('development', 'connector', function(){<br />   // executed for development env and connector server type<br /> });</p>" }, "full_description": "<p>Configure callback for the specified env and server type. When no env is specified that callback will be invoked for all environments and when no type is specified that callback will be invoked for all server types.</p>\n\n<p>Examples:</p>\n\n<p>app.configure(function(){    // executed for all envs and server types  });</p>\n\n<p>app.configure('development', function(){    // executed development env  });</p>\n\n<p>app.configure('development', 'connector', function(){    // executed for development env and connector server type  });</p>", "code": "Application.configure = function (env, type, fn) {\n  var args = [].slice.call(arguments);\n  fn = args.pop();\n  env = type = Constants.Reserved.ALL;\n\n  if(args.length > 0) {\n    env = args[0];\n  }\n  if(args.length > 1) {\n    type = args[1];\n  }\n\n  if (env === Constants.Reserved.ALL || contains(this.settings.env, env)) {\n    if (type === Constants.Reserved.ALL || contains(this.settings.serverType, type)) {\n      fn.call(this);\n    }\n  }\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "env", "description": "application environment" }, { "type": "param", "types": ["Function"], "name": "fn", "description": "callback function" }, { "type": "param", "types": ["String"], "name": "type", "description": "server type" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "env", "description": "application environment" }, { "type": "param", "types": ["Function"], "name": "fn", "description": "callback function" }, { "type": "param", "types": ["String"], "name": "type", "description": "server type" }, { "type": "return", "types": ["Application"], "description": "for chaining" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "28-1387877793311", "name": "registerAdmin", "signiture": "Application.registerAdmin()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "registerAdmin", "string": "Application.registerAdmin()" }, "description": { "full": "<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>", "summary": "<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>", "body": "" }, "full_description": "<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>", "code": "Application.registerAdmin = function(moduleId, module, opts) {\n  var modules = this.get(Constants.KeyWords.MODULE);\n  if(!modules) {\n    modules = {};\n    this.set(Constants.KeyWords.MODULE, modules);\n  }\n\n  if(typeof moduleId !== 'string') {\n    opts = module;\n    module = moduleId;\n    if(module) {\n      moduleId = module.moduleId;\n    }\n  }\n\n  if(!moduleId){\n    return;\n  }\n\n  modules[moduleId] = {\n    moduleId: moduleId,\n    module: module,\n    opts: opts\n  };\n};", "params": [{ "type": "param", "types": ["String"], "name": "module", "description": "(optional) module id or provoided by module.moduleId" }, { "type": "param", "types": ["Object"], "name": "module", "description": "module object or factory function for module" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "construct parameter for module" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "module", "description": "(optional) module id or provoided by module.moduleId" }, { "type": "param", "types": ["Object"], "name": "module", "description": "module object or factory function for module" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "construct parameter for module" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "29-1387877793311", "name": "use", "signiture": "Application.use()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "use", "string": "Application.use()" }, "description": { "full": "<p>Use plugin.</p>", "summary": "<p>Use plugin.</p>", "body": "" }, "full_description": "<p>Use plugin.</p>", "code": "Application.use = function(plugin, opts) {\n  if(!plugin.components) {\n    logger.error('invalid components, no components exist');\n    return;\n  }\n  \n  var self = this;\n  var dir = path.dirname(plugin.components);\n\n  if(!fs.existsSync(plugin.components)) {\n    logger.error('fail to find components, find path: %s', plugin.components);\n    return;\n  }\n\n  fs.readdirSync(plugin.components).forEach(function (filename) {\n    if (!/\\.js$/.test(filename)) {\n      return;\n    }\n    var name = path.basename(filename, '.js');\n    var param = opts[name] || {};\n    var absolutePath = path.join(dir, Constants.Dir.COMPONENT, filename);\n    if(!fs.existsSync(absolutePath)) {\n      logger.error('component %s not exist at %s', name, absolutePath);\n    } else {\n      self.load(require(absolutePath), param);\n    }\n  });\n\n  // load events\n  if(!plugin.events) {\n    return;\n  } else {\n    if(!fs.existsSync(plugin.events)) {\n      logger.error('fail to find events, find path: %s', plugin.events);\n      return;\n    }\n\n    fs.readdirSync(plugin.events).forEach(function (filename) {\n      if (!/\\.js$/.test(filename)) {\n        return;\n      }\n      var absolutePath = path.join(dir, Constants.Dir.EVENT, filename);\n      if(!fs.existsSync(absolutePath)) {\n        logger.error('events %s not exist at %s', filename, absolutePath);\n      } else {\n        bindEvents(require(absolutePath), self);\n      }\n    });\n  }\n};", "params": [{ "type": "param", "types": ["Object"], "name": "plugin", "description": "plugin instance" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "plugin", "description": "plugin instance" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "30-1387877793311", "name": "transaction", "signiture": "Application.transaction()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "transaction", "string": "Application.transaction()" }, "description": { "full": "<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed.<br />And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>", "summary": "<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed.<br />And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>", "body": "" }, "full_description": "<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed. And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>", "code": "Application.transaction = function(name, conditions, handlers, retry) {\n  appManager.transaction(name, conditions, handlers, retry);\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "transaction name" }, { "type": "param", "types": ["Object"], "name": "conditions", "description": "functions which are called before transaction" }, { "type": "param", "types": ["Object"], "name": "handlers", "description": "functions which are called during transaction" }, { "type": "param", "types": ["Number"], "name": "retry", "description": "retry times to execute handlers if conditions are successfully executed" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "transaction name" }, { "type": "param", "types": ["Object"], "name": "conditions", "description": "functions which are called before transaction" }, { "type": "param", "types": ["Object"], "name": "handlers", "description": "functions which are called during transaction" }, { "type": "param", "types": ["Number"], "name": "retry", "description": "retry times to execute handlers if conditions are successfully executed" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "31-1387877793311", "name": "getMaster", "signiture": "Application.getMaster()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getMaster", "string": "Application.getMaster()" }, "description": { "full": "<p>Get master server info.</p>", "summary": "<p>Get master server info.</p>", "body": "" }, "full_description": "<p>Get master server info.</p>", "code": "Application.getMaster = function() {\n  return this.master;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "master server info, {id, host, port}" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "32-1387877793311", "name": "getCurServer", "signiture": "Application.getCurServer()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getCurServer", "string": "Application.getCurServer()" }, "description": { "full": "<p>Get current server info.</p>", "summary": "<p>Get current server info.</p>", "body": "" }, "full_description": "<p>Get current server info.</p>", "code": "Application.getCurServer = function() {\n  return this.curServer;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "current server info, {id, serverType, host, port}" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "33-1387877793311", "name": "getServerId", "signiture": "Application.getServerId()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerId", "string": "Application.getServerId()" }, "description": { "full": "<p>Get current server id.</p>", "summary": "<p>Get current server id.</p>", "body": "" }, "full_description": "<p>Get current server id.</p>", "code": "Application.getServerId = function() {\n  return this.serverId;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["String", "Number"], "description": "current server id from servers.json" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "34-1387877793311", "name": "getServerType", "signiture": "Application.getServerType()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerType", "string": "Application.getServerType()" }, "description": { "full": "<p>Get current server type.</p>", "summary": "<p>Get current server type.</p>", "body": "" }, "full_description": "<p>Get current server type.</p>", "code": "Application.getServerType = function() {\n  return this.serverType;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["String", "Number"], "description": "current server type from servers.json" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "35-1387877793311", "name": "getServers", "signiture": "Application.getServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServers", "string": "Application.getServers()" }, "description": { "full": "<p>Get all the current server infos.</p>", "summary": "<p>Get all the current server infos.</p>", "body": "" }, "full_description": "<p>Get all the current server infos.</p>", "code": "Application.getServers = function() {\n  return this.servers;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "server info map, key: server id, value: server info" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "36-1387877793311", "name": "getServersFromConfig", "signiture": "Application.getServersFromConfig()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServersFromConfig", "string": "Application.getServersFromConfig()" }, "description": { "full": "<p>Get all server infos from servers.json.</p>", "summary": "<p>Get all server infos from servers.json.</p>", "body": "" }, "full_description": "<p>Get all server infos from servers.json.</p>", "code": "Application.getServersFromConfig = function() {\n  return this.get(Constants.KeyWords.SERVER_MAP);\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "server info map, key: server id, value: server info" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "37-1387877793311", "name": "getServerTypes", "signiture": "Application.getServerTypes()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerTypes", "string": "Application.getServerTypes()" }, "description": { "full": "<p>Get all the server type.</p>", "summary": "<p>Get all the server type.</p>", "body": "" }, "full_description": "<p>Get all the server type.</p>", "code": "Application.getServerTypes = function() {\n  return this.serverTypes;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Array"], "description": "server type list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "38-1387877793311", "name": "getServerById", "signiture": "Application.getServerById()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerById", "string": "Application.getServerById()" }, "description": { "full": "<p>Get server info by server id from current server cluster.</p>", "summary": "<p>Get server info by server id from current server cluster.</p>", "body": "" }, "full_description": "<p>Get server info by server id from current server cluster.</p>", "code": "Application.getServerById = function(serverId) {\n  return this.servers[serverId];\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }, { "type": "return", "types": ["Object"], "description": "server info or undefined" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "39-1387877793311", "name": "getServerFromConfig", "signiture": "Application.getServerFromConfig()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerFromConfig", "string": "Application.getServerFromConfig()" }, "description": { "full": "<p>Get server info by server id from servers.json.</p>", "summary": "<p>Get server info by server id from servers.json.</p>", "body": "" }, "full_description": "<p>Get server info by server id from servers.json.</p>", "code": "Application.getServerFromConfig = function(serverId) {\n  return this.get(Constants.keyWords.SERVER_MAP)[serverId];\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }, { "type": "return", "types": ["Object"], "description": "server info or undefined" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "40-1387877793311", "name": "getServersByType", "signiture": "Application.getServersByType()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServersByType", "string": "Application.getServersByType()" }, "description": { "full": "<p>Get server infos by server type.</p>", "summary": "<p>Get server infos by server type.</p>", "body": "" }, "full_description": "<p>Get server infos by server type.</p>", "code": "Application.getServersByType = function(serverType) {\n  return this.serverTypeMaps[serverType];\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type" }, { "type": "return", "types": ["Array"], "description": "server info list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "41-1387877793311", "name": "isFrontend", "signiture": "Application.isFrontend()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "isFrontend", "string": "Application.isFrontend()" }, "description": { "full": "<p>Check the server whether is a frontend server</p>", "summary": "<p>Check the server whether is a frontend server</p>", "body": "" }, "full_description": "<p>Check the server whether is a frontend server</p>", "code": "Application.isFrontend = function(server) {\n  server = server || this.getCurServer();\n  return !!server && server.frontend === 'true';\n};", "params": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }], "has_params": true, "tags": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }, { "type": "", "string": "if server not specified" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "42-1387877793311", "name": "isBackend", "signiture": "Application.isBackend()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "isBackend", "string": "Application.isBackend()" }, "description": { "full": "<p>Check the server whether is a backend server</p>", "summary": "<p>Check the server whether is a backend server</p>", "body": "" }, "full_description": "<p>Check the server whether is a backend server</p>", "code": "Application.isBackend = function(server) {\n  server = server || this.getCurServer();\n  return !!server && !server.frontend;\n};", "params": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }], "has_params": true, "tags": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }, { "type": "", "string": "if server not specified" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "43-1387877793311", "name": "isMaster", "signiture": "Application.isMaster()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "isMaster", "string": "Application.isMaster()" }, "description": { "full": "<p>Check whether current server is a master server</p>", "summary": "<p>Check whether current server is a master server</p>", "body": "" }, "full_description": "<p>Check whether current server is a master server</p>", "code": "Application.isMaster = function() {\n  return this.serverType === Constants.Reserved.MASTER;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "44-1387877793311", "name": "addServers", "signiture": "Application.addServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "addServers", "string": "Application.addServers()" }, "description": { "full": "<p>Add new server info to current application in runtime.</p>", "summary": "<p>Add new server info to current application in runtime.</p>", "body": "" }, "full_description": "<p>Add new server info to current application in runtime.</p>", "code": "Application.addServers = function(servers) {\n  if(!servers || !servers.length) {\n    return;\n  }\n\n  var item, slist;\n  for(var i=0, l=servers.length; i<l; i++) {\n    item = servers[i];\n    // update global server map\n    this.servers[item.id] = item;\n\n    // update global server type map\n    slist = this.serverTypeMaps[item.serverType];\n    if(!slist) {\n      this.serverTypeMaps[item.serverType] = slist = [];\n    }\n    replaceServer(slist, item);\n\n    // update global server type list\n    if(this.serverTypes.indexOf(item.serverType) < 0) {\n      this.serverTypes.push(item.serverType);\n    }\n  }\n  this.event.emit(events.ADD_SERVERS, servers);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "servers", "description": "new server info list" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "servers", "description": "new server info list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "45-1387877793311", "name": "removeServers", "signiture": "Application.removeServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "removeServers", "string": "Application.removeServers()" }, "description": { "full": "<p>Remove server info from current application at runtime.</p>", "summary": "<p>Remove server info from current application at runtime.</p>", "body": "" }, "full_description": "<p>Remove server info from current application at runtime.</p>", "code": "Application.removeServers = function(ids) {\n  if(!ids || !ids.length) {\n    return;\n  }\n\n  var id, item, slist;\n  for(var i=0, l=ids.length; i<l; i++) {\n    id = ids[i];\n    item = this.servers[id];\n    if(!item) {\n      continue;\n    }\n    // clean global server map\n    delete this.servers[id];\n\n    // clean global server type map\n    slist = this.serverTypeMaps[item.serverType];\n    removeServer(slist, id);\n    // TODO: should remove the server type if the slist is empty?\n  }\n  this.event.emit(events.REMOVE_SERVERS, ids);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "ids", "description": "server id list" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "ids", "description": "server id list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "46-1387877793311", "name": "replaceServers", "signiture": "Application.replaceServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "replaceServers", "string": "Application.replaceServers()" }, "description": { "full": "<p>Replace server info from current application at runtime.</p>", "summary": "<p>Replace server info from current application at runtime.</p>", "body": "" }, "full_description": "<p>Replace server info from current application at runtime.</p>", "code": "Application.replaceServers = function(servers) {\n  if(!servers){\n    return;\n  }\n\n  this.servers = servers;\n  this.serverTypeMaps = {};\n  this.serverTypes = [];\n  var serverArray = [];\n  for(var id in servers){\n    var server = servers[id];\n    var serverType = server[Constants.Reserved.SERVER_TYPE];\n    var slist = this.serverTypeMaps[serverType];\n    if(!slist) {\n      this.serverTypeMaps[serverType] = slist = [];\n    }\n    this.serverTypeMaps[serverType].push(server);\n    // update global server type list\n    if(this.serverTypes.indexOf(serverType) < 0) {\n      this.serverTypes.push(serverType);\n    }\n    serverArray.push(server);\n  }\n  this.event.emit(events.REPLACE_SERVERS, serverArray);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "server", "description": "id map" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "server", "description": "id map" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "47-1387877793311", "name": "addCrons", "signiture": "Application.addCrons()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "addCrons", "string": "Application.addCrons()" }, "description": { "full": "<p>Add crons from current application at runtime.</p>", "summary": "<p>Add crons from current application at runtime.</p>", "body": "" }, "full_description": "<p>Add crons from current application at runtime.</p>", "code": "Application.addCrons = function(crons) {\n  if(!crons || !crons.length) {\n    logger.warn('crons is not defined.');\n    return;\n  }\n  this.event.emit(events.ADD_CRONS, crons);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "new crons would be added in application" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "new crons would be added in application" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "48-1387877793311", "name": "removeCrons", "signiture": "Application.removeCrons()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "removeCrons", "string": "Application.removeCrons()" }, "description": { "full": "<p>Remove crons from current application at runtime.</p>", "summary": "<p>Remove crons from current application at runtime.</p>", "body": "" }, "full_description": "<p>Remove crons from current application at runtime.</p>", "code": "Application.removeCrons = function(crons) {\n  if(!crons || !crons.length) {\n    logger.warn('ids is not defined.');\n    return;\n  }\n  this.event.emit(events.REMOVE_CRONS, crons);\n};\n\nvar replaceServer = function(slist, serverInfo) {\n  for(var i=0, l=slist.length; i<l; i++) {\n    if(slist[i].id === serverInfo.id) {\n      slist[i] = serverInfo;\n      return;\n    }\n  }\n  slist.push(serverInfo);\n};\n\nvar removeServer = function(slist, id) {\n  if(!slist || !slist.length) {\n    return;\n  }\n\n  for(var i=0, l=slist.length; i<l; i++) {\n    if(slist[i].id === id) {\n      slist.splice(i, 1);\n      return;\n    }\n  }\n};\n\nvar contains = function(str, settings) {\n  if(!settings) {\n    return false;\n  }\n\n  var ts = settings.split(\"|\");\n  for(var i=0, l=ts.length; i<l; i++) {\n    if(str === ts[i]) {\n      return true;\n    }\n  }\n  return false;\n};\n\nvar bindEvents = function(Event, app) {\n  var emethods = new Event(app);\n  for(var m in emethods) {\n    if(typeof emethods[m] === 'function') {\n      app.event.on(m, emethods[m].bind(emethods));\n    }\n  }\n};\n\nvar addFilter = function(app, type, filter) {\n var filters = app.get(type);\n  if(!filters) {\n    filters = [];\n    app.set(type, filters);\n  }\n  filters.push(filter);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "old crons would be removed in application" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "old crons would be removed in application" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }] }, { "id": "63-1387877793312", "name": "BackendSessionService", "signiture": "BackendSessionService()", "type": "function", "ctx": { "type": "function", "name": "BackendSessionService", "string": "BackendSessionService()" }, "description": { "full": "<p>Service that maintains backend sessions and the communiation with frontend<br />servers.</p>\n\n<p>BackendSessionService would be created in each server process and maintains<br />backend sessions for current process and communicates with the relative<br />frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by<br /><code>app.get('backendSessionService')</code> or app.backendSessionService.</p>", "summary": "<p>Service that maintains backend sessions and the communiation with frontend<br />servers.</p>", "body": "<p>BackendSessionService would be created in each server process and maintains<br />backend sessions for current process and communicates with the relative<br />frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by<br /><code>app.get('backendSessionService')</code> or app.backendSessionService.</p>" }, "full_description": "<p>Service that maintains backend sessions and the communiation with frontend servers.</p>\n\n<p>BackendSessionService would be created in each server process and maintains backend sessions for current process and communicates with the relative frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by <code>app.get('backendSessionService')</code> or app.backendSessionService.</p>", "code": "var BackendSessionService = function(app) {\n  this.app = app;\n};\n\nmodule.exports = BackendSessionService;\n\nBackendSessionService.prototype.create = function(opts) {\n  if(!opts) {\n    throw new Error('opts should not be empty.');\n  }\n  return new BackendSession(opts, this);\n};", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "64-1387877793312", "name": "get", "signiture": "BackendSessionService.prototype.get()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "get", "string": "BackendSessionService.prototype.get()" }, "description": { "full": "<p>Get backend session by frontend server id and session id.</p>", "summary": "<p>Get backend session by frontend server id and session id.</p>", "body": "" }, "full_description": "<p>Get backend session by frontend server id and session id.</p>", "code": "BackendSessionService.prototype.get = function(frontendId, sid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'getBackendSessionBySid';\n  var args = [sid];\n  rpcInvoke(this.app, frontendId, namespace, service, method,\n            args, BackendSessionCB.bind(null, this, cb));\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSession)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSession)" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }, { "id": "65-1387877793312", "name": "getByUid", "signiture": "BackendSessionService.prototype.getByUid()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "getByUid", "string": "BackendSessionService.prototype.getByUid()" }, "description": { "full": "<p>Get backend sessions by frontend server id and user id.</p>", "summary": "<p>Get backend sessions by frontend server id and user id.</p>", "body": "" }, "full_description": "<p>Get backend sessions by frontend server id and user id.</p>", "code": "BackendSessionService.prototype.getByUid = function(frontendId, uid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'getBackendSessionsByUid';\n  var args = [uid];\n  rpcInvoke(this.app, frontendId, namespace, service, method,\n            args, BackendSessionCB.bind(null, this, cb));\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "uid", "description": "user id binded with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSessions)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "uid", "description": "user id binded with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSessions)" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }, { "id": "66-1387877793312", "name": "kickBySid", "signiture": "BackendSessionService.prototype.kickBySid()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "kickBySid", "string": "BackendSessionService.prototype.kickBySid()" }, "description": { "full": "<p>Kick a session by session id.</p>", "summary": "<p>Kick a session by session id.</p>", "body": "" }, "full_description": "<p>Kick a session by session id.</p>", "code": "BackendSessionService.prototype.kickBySid = function(frontendId, sid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'kickBySid';\n  var args = [sid];\n  rpcInvoke(this.app, frontendId, namespace, service, method, args, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }, { "id": "67-1387877793312", "name": "kickByUid", "signiture": "BackendSessionService.prototype.kickByUid()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "kickByUid", "string": "BackendSessionService.prototype.kickByUid()" }, "description": { "full": "<p>Kick sessions by user id.</p>", "summary": "<p>Kick sessions by user id.</p>", "body": "" }, "full_description": "<p>Kick sessions by user id.</p>", "code": "BackendSessionService.prototype.kickByUid = function(frontendId, uid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'kickByUid';\n  var args = [uid];\n  rpcInvoke(this.app, frontendId, namespace, service, method, args, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }] }, { "id": "68-1387877793312", "name": "BackendSession", "signiture": "BackendSession()", "type": "function", "ctx": { "type": "function", "name": "BackendSession", "string": "BackendSession()" }, "description": { "full": "<p>BackendSession is the proxy for the frontend internal session passed to handlers and<br />it helps to keep the key/value pairs for the server locally.<br />Internal session locates in frontend server and should not be accessed directly.</p>\n\n<p>The mainly operation on backend session should be read and any changes happen in backend <br />session is local and would be discarded in next request. You have to push the<br />changes to the frontend manually if necessary. Any push would overwrite the last push<br />of the same key silently and the changes would be saw in next request.<br />And you have to make sure the transaction outside if you would push the session<br />concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>", "summary": "<p>BackendSession is the proxy for the frontend internal session passed to handlers and<br />it helps to keep the key/value pairs for the server locally.<br />Internal session locates in frontend server and should not be accessed directly.</p>", "body": "<p>The mainly operation on backend session should be read and any changes happen in backend <br />session is local and would be discarded in next request. You have to push the<br />changes to the frontend manually if necessary. Any push would overwrite the last push<br />of the same key silently and the changes would be saw in next request.<br />And you have to make sure the transaction outside if you would push the session<br />concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>" }, "full_description": "<p>BackendSession is the proxy for the frontend internal session passed to handlers and it helps to keep the key/value pairs for the server locally. Internal session locates in frontend server and should not be accessed directly.</p>\n\n<p>The mainly operation on backend session should be read and any changes happen in backend  session is local and would be discarded in next request. You have to push the changes to the frontend manually if necessary. Any push would overwrite the last push of the same key silently and the changes would be saw in next request. And you have to make sure the transaction outside if you would push the session concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>", "code": "var BackendSession = function(opts, service) {\n  EventEmitter.call(this);\n  for(var f in opts) {\n    this[f] = opts[f];\n  }\n  this.__sessionService__ = service;\n};\n\nutil.inherits(BackendSession, EventEmitter);", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "69-1387877793312", "name": "bind", "signiture": "BackendSession.prototype.bind()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "bind", "string": "BackendSession.prototype.bind()" }, "description": { "full": "<p>Bind current session with the user id. It would push the uid to frontend<br />server and bind  uid to the frontend internal session.</p>", "summary": "<p>Bind current session with the user id. It would push the uid to frontend<br />server and bind  uid to the frontend internal session.</p>", "body": "" }, "full_description": "<p>Bind current session with the user id. It would push the uid to frontend server and bind  uid to the frontend internal session.</p>", "code": "BackendSession.prototype.bind = function(uid, cb) {\n  var self = this;\n  this.__sessionService__.bind(this.frontendId, this.id, uid, function(err) {\n    if(!err) {\n      self.uid = uid;\n    }\n    utils.invokeCallback(cb, err);\n  });\n};", "params": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSession" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "70-1387877793312", "name": "unbind", "signiture": "BackendSession.prototype.unbind()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "unbind", "string": "BackendSession.prototype.unbind()" }, "description": { "full": "<p>Unbind current session with the user id. It would push the uid to frontend<br />server and unbind uid from the frontend internal session.</p>", "summary": "<p>Unbind current session with the user id. It would push the uid to frontend<br />server and unbind uid from the frontend internal session.</p>", "body": "" }, "full_description": "<p>Unbind current session with the user id. It would push the uid to frontend server and unbind uid from the frontend internal session.</p>", "code": "BackendSession.prototype.unbind = function(uid, cb) {\n  var self = this;\n  this.__sessionService__.unbind(this.frontendId, this.id, uid, function(err) {\n    if(!err) {\n      self.uid = null;\n    }\n    utils.invokeCallback(cb, err);\n  });\n};", "params": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSession" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "71-1387877793312", "name": "set", "signiture": "BackendSession.prototype.set()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "set", "string": "BackendSession.prototype.set()" }, "description": { "full": "<p>Set the key/value into backend session.</p>", "summary": "<p>Set the key/value into backend session.</p>", "body": "" }, "full_description": "<p>Set the key/value into backend session.</p>", "code": "BackendSession.prototype.set = function(key, value) {\n  this.settings[key] = value;\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Object"], "name": "value", "description": "value" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Object"], "name": "value", "description": "value" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "72-1387877793312", "name": "get", "signiture": "BackendSession.prototype.get()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "get", "string": "BackendSession.prototype.get()" }, "description": { "full": "<p>Get the value from backend session by key.</p>", "summary": "<p>Get the value from backend session by key.</p>", "body": "" }, "full_description": "<p>Get the value from backend session by key.</p>", "code": "BackendSession.prototype.get = function(key) {\n  return this.settings[key];\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "return", "types": ["Object"], "description": "value" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "73-1387877793312", "name": "push", "signiture": "BackendSession.prototype.push()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "push", "string": "BackendSession.prototype.push()" }, "description": { "full": "<p>Push the key/value in backend session to the front internal session.</p>", "summary": "<p>Push the key/value in backend session to the front internal session.</p>", "body": "" }, "full_description": "<p>Push the key/value in backend session to the front internal session.</p>", "code": "BackendSession.prototype.push = function(key, cb) {\n  this.__sessionService__.push(this.frontendId, this.id, key, this.get(key), cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "74-1387877793312", "name": "pushAll", "signiture": "BackendSession.prototype.pushAll()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "pushAll", "string": "BackendSession.prototype.pushAll()" }, "description": { "full": "<p>Push all the key/values in backend session to the frontend internal session.</p>", "summary": "<p>Push all the key/values in backend session to the frontend internal session.</p>", "body": "" }, "full_description": "<p>Push all the key/values in backend session to the frontend internal session.</p>", "code": "BackendSession.prototype.pushAll = function(cb) {\n  this.__sessionService__.pushAll(this.frontendId, this.id, this.settings, cb);\n};", "params": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }] }, { "id": "76-1387877793312", "name": "ChannelService", "signiture": "ChannelService()", "type": "function", "ctx": { "type": "function", "name": "ChannelService", "string": "ChannelService()" }, "description": { "full": "<p>Create and maintain channels for server local.</p>\n\n<p>ChannelService is created by channel component which is a default loaded<br />component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>", "summary": "<p>Create and maintain channels for server local.</p>", "body": "<p>ChannelService is created by channel component which is a default loaded<br />component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>" }, "full_description": "<p>Create and maintain channels for server local.</p>\n\n<p>ChannelService is created by channel component which is a default loaded component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>", "code": "var ChannelService = function(app, opts) {\n  opts = opts || {};\n  this.app = app;\n  this.channels = {};\n  this.broadcastFilter = opts.broadcastFilter;\n};\n\nmodule.exports = ChannelService;", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "77-1387877793312", "name": "createChannel", "signiture": "ChannelService.prototype.createChannel()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "createChannel", "string": "ChannelService.prototype.createChannel()" }, "description": { "full": "<p>Create channel with name.</p>", "summary": "<p>Create channel with name.</p>", "body": "" }, "full_description": "<p>Create channel with name.</p>", "code": "ChannelService.prototype.createChannel = function(name) {\n  if(this.channels[name]) {\n    return this.channels[name];\n  }\n\n  var c = new Channel(name, this);\n  this.channels[name] = c;\n  return c;\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "78-1387877793312", "name": "getChannel", "signiture": "ChannelService.prototype.getChannel()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "getChannel", "string": "ChannelService.prototype.getChannel()" }, "description": { "full": "<p>Get channel by name.</p>", "summary": "<p>Get channel by name.</p>", "body": "" }, "full_description": "<p>Get channel by name.</p>", "code": "ChannelService.prototype.getChannel = function(name, create) {\n  var channel = this.channels[name];\n  if(!channel && !!create) {\n    channel = this.channels[name] = new Channel(name, this);\n  }\n  return channel;\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }, { "type": "param", "types": ["Boolean"], "name": "create", "description": "if true, create channel" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }, { "type": "param", "types": ["Boolean"], "name": "create", "description": "if true, create channel" }, { "type": "return", "types": ["Channel"], "description": "" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "79-1387877793312", "name": "destroyChannel", "signiture": "ChannelService.prototype.destroyChannel()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "destroyChannel", "string": "ChannelService.prototype.destroyChannel()" }, "description": { "full": "<p>Destroy channel by name.</p>", "summary": "<p>Destroy channel by name.</p>", "body": "" }, "full_description": "<p>Destroy channel by name.</p>", "code": "ChannelService.prototype.destroyChannel = function(name) {\n  delete this.channels[name];\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel name" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel name" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "80-1387877793312", "name": "pushMessageByUids", "signiture": "ChannelService.prototype.pushMessageByUids()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "pushMessageByUids", "string": "ChannelService.prototype.pushMessageByUids()" }, "description": { "full": "<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>", "summary": "<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>", "body": "" }, "full_description": "<p>Push message by uids. Group the uids by group. ignore any uid if sid not specified.</p>", "code": "ChannelService.prototype.pushMessageByUids = function(route, msg, uids, opts, cb) {\n  if(typeof route !== 'string') {\n    cb = opts;\n    opts = uids;\n    uids = msg;\n    msg = route;\n    route = msg.route;\n  }\n\n  if(!cb && typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  if(!uids || uids.length === 0) {\n    utils.invokeCallback(cb, new Error('uids should not be empty'));\n    return;\n  }\n  var groups = {}, record;\n  for(var i=0, l=uids.length; i<l; i++) {\n    record = uids[i];\n    add(record.uid, record.sid, groups);\n  }\n\n  sendMessageByGroup(this, route, msg, groups, opts, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Array"], "name": "uids", "description": "the receiver info list, [{uid: userId, sid: frontendServerId}]" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional " }, { "type": "param", "types": ["Function"], "name": "cb", "description": "cb(err)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Array"], "name": "uids", "description": "the receiver info list, [{uid: userId, sid: frontendServerId}]" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional " }, { "type": "param", "types": ["Function"], "name": "cb", "description": "cb(err)" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "81-1387877793312", "name": "broadcast", "signiture": "ChannelService.prototype.broadcast()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "broadcast", "string": "ChannelService.prototype.broadcast()" }, "description": { "full": "<p>Broadcast message to all the connected clients.</p>", "summary": "<p>Broadcast message to all the connected clients.</p>", "body": "" }, "full_description": "<p>Broadcast message to all the connected clients.</p>", "code": "ChannelService.prototype.broadcast = function(stype, route, msg, opts, cb) {\n  var app = this.app;\n  var namespace = 'sys';\n  var service = 'channelRemote';\n  var method = 'broadcast';\n  var servers = app.getServersByType(stype);\n\n  if(!servers || servers.length === 0) {\n    // server list is empty\n    utils.invokeCallback(cb);\n    return;\n  }\n\n  var count = servers.length;\n  var successFlag = false;\n\n  var latch = countDownLatch.createCountDownLatch(count, function() {\n    if(!successFlag) {\n      utils.invokeCallback(cb, new Error('broadcast fails'));\n      return;\n    }\n    utils.invokeCallback(cb, null);\n  });\n\n  var genCB = function() {\n    return function(err) {\n      if(err) {\n        logger.error('[broadcast] fail to push message, err:' + err.stack);\n        latch.done();\n        return;\n      }\n      successFlag = true;\n      latch.done();\n    };\n  };\n\n  opts = {type: 'broadcast', userOptions: opts || {}};\n\n  // for compatiblity \n  opts.isBroadcast = true;\n  if(opts.userOptions) {\n    opts.binded = opts.userOptions.binded;\n    opts.filterParam = opts.userOptions.filterParam;\n  }\n\n  for(var i=0, l=count; i<l; i++) {\n    app.rpcInvoke(servers[i].id, {namespace: namespace, service: service,\n      method: method, args: [route, msg, opts]}, genCB());\n  }\n};", "params": [{ "type": "param", "types": ["String"], "name": "stype", "description": "frontend server type string" }, { "type": "param", "types": ["String"], "name": "route", "description": "route string" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined broadcast options, optional" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "stype", "description": "frontend server type string" }, { "type": "param", "types": ["String"], "name": "route", "description": "route string" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined broadcast options, optional" }, { "type": "", "string": "opts.binded: push to binded sessions or all the sessions" }, { "type": "", "string": "opts.filterParam: parameters for broadcast filter." }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }] }, { "id": "82-1387877793312", "name": "Channel", "signiture": "Channel()", "type": "function", "ctx": { "type": "function", "name": "Channel", "string": "Channel()" }, "description": { "full": "<p>Channel maintains the receiver collection for a subject. You can<br />add users into a channel and then broadcast message to them by channel.</p>", "summary": "<p>Channel maintains the receiver collection for a subject. You can<br />add users into a channel and then broadcast message to them by channel.</p>", "body": "" }, "full_description": "<p>Channel maintains the receiver collection for a subject. You can add users into a channel and then broadcast message to them by channel.</p>", "code": "var Channel = function(name, service) {\n  this.name = name;\n  this.groups = {};       // group map for uids. key: sid, value: [uid]\n  this.records = {};      // member records. key: uid\n  this.__channelService__ = service;\n  this.state = ST_INITED;\n};", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "channel" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "83-1387877793312", "name": "add", "signiture": "Channel.prototype.add()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "add", "string": "Channel.prototype.add()" }, "description": { "full": "<p>Add user to channel.</p>", "summary": "<p>Add user to channel.</p>", "body": "" }, "full_description": "<p>Add user to channel.</p>", "code": "Channel.prototype.add = function(uid, sid) {\n  if(this.state > ST_INITED) {\n    return false;\n  } else {\n    var res = add(uid, sid, this.groups);\n    if(res) {\n      this.records[uid] = {sid: sid, uid: uid};\n    }\n    return res;\n  }\n};", "params": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "84-1387877793312", "name": "leave", "signiture": "Channel.prototype.leave()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "leave", "string": "Channel.prototype.leave()" }, "description": { "full": "<p>Remove user from channel.</p>", "summary": "<p>Remove user from channel.</p>", "body": "" }, "full_description": "<p>Remove user from channel.</p>", "code": "Channel.prototype.leave = function(uid, sid) {\n  if(!uid || !sid) {\n    return false;\n  }\n  delete this.records[uid];\n  var res = deleteFrom(uid, sid, this.groups[sid]);\n  if(this.groups[sid] && this.groups[sid].length === 0) {\n    delete this.groups[sid];\n  }\n  return res;\n};", "params": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to." }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to." }, { "type": "return", "types": ["[Boolean]"], "description": "true if success or false if fail" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "85-1387877793312", "name": "getMembers", "signiture": "Channel.prototype.getMembers()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "getMembers", "string": "Channel.prototype.getMembers()" }, "description": { "full": "<p>Get channel members.</p>\n\n<p><b>Notice:</b> Heavy operation.</p>", "summary": "<p>Get channel members.</p>", "body": "<p><b>Notice:</b> Heavy operation.</p>" }, "full_description": "<p>Get channel members.</p>\n\n<p><b>Notice:</b> Heavy operation.</p>", "code": "Channel.prototype.getMembers = function() {\n  var res = [], groups = this.groups;\n  var group, i, l;\n  for(var sid in groups) {\n    group = groups[sid];\n    for(i=0, l=group.length; i<l; i++) {\n      res.push(group[i]);\n    }\n  }\n  return res;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Array"], "description": "channel member uid list" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "86-1387877793312", "name": "getMember", "signiture": "Channel.prototype.getMember()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "getMember", "string": "Channel.prototype.getMember()" }, "description": { "full": "<p>Get Member info.</p>", "summary": "<p>Get Member info.</p>", "body": "" }, "full_description": "<p>Get Member info.</p>", "code": "Channel.prototype.getMember = function(uid) {\n  return this.records[uid];\n};", "params": [{ "type": "param", "types": ["String"], "name": "uid", "description": "user id" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "uid", "description": "user id" }, { "type": "return", "types": ["Object"], "description": "member info" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "87-1387877793312", "name": "destroy", "signiture": "Channel.prototype.destroy()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "destroy", "string": "Channel.prototype.destroy()" }, "description": { "full": "<p>Destroy channel.</p>", "summary": "<p>Destroy channel.</p>", "body": "" }, "full_description": "<p>Destroy channel.</p>", "code": "Channel.prototype.destroy = function() {\n  this.state = ST_DESTROYED;\n  this.__channelService__.destroyChannel(this.name);\n};", "params": [], "has_params": false, "tags": [], "module": false, "parent": "Channel", "has_related": false }, { "id": "88-1387877793312", "name": "pushMessage", "signiture": "Channel.prototype.pushMessage()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "pushMessage", "string": "Channel.prototype.pushMessage()" }, "description": { "full": "<p>Push message to all the members in the channel</p>", "summary": "<p>Push message to all the members in the channel</p>", "body": "" }, "full_description": "<p>Push message to all the members in the channel</p>", "code": "Channel.prototype.pushMessage = function(route, msg, opts, cb) {\n  if(this.state !== ST_INITED) {\n    utils.invokeCallback(new Error('channel is not running now'));\n    return;\n  }\n\n  if(typeof route !== 'string') {\n    cb = opts;\n    opts = msg;\n    msg = route;\n    route = msg.route;\n  }\n\n  if(!cb && typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  sendMessageByGroup(this.__channelService__, route, msg, this.groups, opts, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }] }, { "id": "106-1387877793312", "name": "SessionService", "signiture": "SessionService()", "type": "function", "ctx": { "type": "function", "name": "SessionService", "string": "SessionService()" }, "description": { "full": "<p>Session service maintains the internal session for each client connection.</p>\n\n<p>Session service is created by session component and is only<br /><b>available</b> in frontend servers. You can access the service by<br /><code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>", "summary": "<p>Session service maintains the internal session for each client connection.</p>", "body": "<p>Session service is created by session component and is only<br /><b>available</b> in frontend servers. You can access the service by<br /><code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>" }, "full_description": "<p>Session service maintains the internal session for each client connection.</p>\n\n<p>Session service is created by session component and is only <b>available</b> in frontend servers. You can access the service by <code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>", "code": "var SessionService = function(opts) {\n  opts = opts || {};\n  this.singleSession = opts.singleSession;\n  this.sessions = {};     // sid -> session\n  this.uidMap = {};       // uid -> sessions\n};\n\nmodule.exports = SessionService;", "params": [{ "type": "param", "types": ["Object"], "name": "opts", "description": "constructor parameters" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "opts", "description": "constructor parameters" }, { "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "107-1387877793312", "name": "kick", "signiture": "SessionService.prototype.kick()", "type": "method", "ctx": { "type": "method", "constructor": "SessionService", "cons": "SessionService", "name": "kick", "string": "SessionService.prototype.kick()" }, "description": { "full": "<p>Kick all the session offline under the user id.</p>", "summary": "<p>Kick all the session offline under the user id.</p>", "body": "" }, "full_description": "<p>Kick all the session offline under the user id.</p>", "code": "SessionService.prototype.kick = function(uid, reason, cb) {\n  // compatible for old kick(uid, cb);\n  if(typeof reason === 'function') {\n    cb = reason;\n    reason = 'kick';\n  }\n  var sessions = this.getByUid(uid);\n\n  if(sessions) {\n    // notify client\n    for(var i=0, l=sessions.length; i<l; i++) {\n      sessions[i].closed(reason);\n    }\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  } else {\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  }\n};", "params": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id asscociated with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id asscociated with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "SessionService" }], "module": false, "parent": "SessionService", "related": { "href": "" }, "has_related": true }, { "id": "108-1387877793312", "name": "kickBySessionId", "signiture": "SessionService.prototype.kickBySessionId()", "type": "method", "ctx": { "type": "method", "constructor": "SessionService", "cons": "SessionService", "name": "kickBySessionId", "string": "SessionService.prototype.kickBySessionId()" }, "description": { "full": "<p>Kick a user offline by session id.</p>", "summary": "<p>Kick a user offline by session id.</p>", "body": "" }, "full_description": "<p>Kick a user offline by session id.</p>", "code": "SessionService.prototype.kickBySessionId = function(sid, cb) {\n  var session = this.get(sid);\n\n  if(session) {\n    // notify client\n    session.closed('kick');\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  } else {\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  }\n};", "params": [{ "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "SessionService" }], "module": false, "parent": "SessionService", "related": { "href": "" }, "has_related": true }] }, { "id": "214-1387877793314", "name": "Pomelo", "signiture": "Pomelo", "type": "declaration", "ctx": { "type": "declaration", "name": "Pomelo", "value": "module.exports = {}", "string": "Pomelo" }, "description": { "full": "<p>Expose <code>createApplication()</code>.</p>", "summary": "<p>Expose <code>createApplication()</code>.</p>", "body": "" }, "full_description": "<p>Expose <code>createApplication()</code>.</p>", "code": "var Pomelo = module.exports = {};", "params": [], "has_params": false, "tags": [{ "type": "module", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "222-1387877793314", "name": "createApp", "signiture": "Pomelo.createApp()", "type": "method", "ctx": { "type": "method", "receiver": "Pomelo", "name": "createApp", "string": "Pomelo.createApp()" }, "description": { "full": "<p>Create an pomelo application.</p>", "summary": "<p>Create an pomelo application.</p>", "body": "" }, "full_description": "<p>Create an pomelo application.</p>", "code": "Pomelo.createApp = function (opts) {\n  var app = application;\n  app.init(opts);\n  self.app = app;\n  return app;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Application"], "description": "" }, { "type": "memberOf", "parent": "Pomelo" }, { "type": "api", "visibility": "public" }], "module": false, "parent": "Pomelo", "related": { "href": "" }, "has_related": true }] }]
  </script>
  <!-- Array，String，Object扩展函数（因为IE9-不支持，而Lunr有使用到) -->
  <script src="./pomelo API_files/extend.js.下载"></script>
  <!-- 将原来引用网上的jquery转为引用本地的 -->
  <script src="./pomelo API_files/jquery-1.6.4-min.js.下载"></script>
  <!-- 将Lunr和页面逻辑整合一起放在lunr.js文件 -->
  <script src="./pomelo API_files/lunr.js.下载"></script>
</head>

<body>
  <!-- BEGIN WAYBACK TOOLBAR INSERT -->
  <script type="text/javascript" src="./pomelo API_files/timestamp.js.下载" charset="utf-8"></script>
  <script type="text/javascript" src="./pomelo API_files/graph-calc.js.下载" charset="utf-8"></script>
  <script type="text/javascript" src="./pomelo API_files/auto-complete.js.下载" charset="utf-8"></script>
  <script type="text/javascript" src="./pomelo API_files/toolbar.js.下载" charset="utf-8"></script>
  <style type="text/css">
    body {
      margin-top: 0 !important;
      padding-top: 0 !important;
      /*min-width:800px !important;*/
    }

    .wb-autocomplete-suggestions {
      text-align: left;
      cursor: default;
      border: 1px solid #ccc;
      border-top: 0;
      background: #fff;
      box-shadow: -1px 1px 3px rgba(0, 0, 0, .1);
      position: absolute;
      display: none;
      z-index: 2147483647;
      max-height: 254px;
      overflow: hidden;
      overflow-y: auto;
      box-sizing: border-box;
    }

    .wb-autocomplete-suggestion {
      position: relative;
      padding: 0 .6em;
      line-height: 23px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 1.02em;
      color: #333;
    }

    .wb-autocomplete-suggestion b {
      font-weight: bold;
    }

    .wb-autocomplete-suggestion.selected {
      background: #f0f0f0;
    }
  </style>
  <div id="wm-ipp-base" lang="en" style="display: block; direction: ltr;">
  </div>
  <script type="text/javascript">
    __wm.bt(600, 27, 25, 2, "web", "http://pomelo.netease.com/api.html", "2017-05-21", 1996, "/static/", ['css/banner-styles.css', 'css/iconochive.css']);
  </script>
  <div class="wb-autocomplete-suggestions "></div>
  <!-- END WAYBACK TOOLBAR INSERT -->
  <!-- 顶栏 -->
  <div class="g-bar">
    <!-- 顶栏github模块 -->
    <div class="m-github">
      <span class="title">gitHub:</span><a class="link" target="_blank"
        href="https://github.com/NetEase/pomelo">http://github.com/NetEase/pomelo</a>
    </div>
  </div>
  <!-- 头部 -->
  <div class="g-hd">
    <div class="m-hdnav">
      <div class="bg">
        <div class="wrap">
          <ul class="cnt">
            <li><a href="./index.html">Home</a></li>
            <li><a href="./api.html">Api</a></li>
            <li class="current"><a href="./doc9.html">0.9新增</a></li>
            <li><a href="./doc10.html">0.10新增</a></li>
          </ul>
        </div>
      </div>
      <div class="logo"><a href="https://github.com/NetEase/pomelo">
          <div class="img"></div>
        </a></div>
    </div>
  </div>
  <!-- 整体居中 -->
  <div class="g-doc">
    <!-- 主体 -->
    <div class="g-bd">
      <!-- API主体 -->
      <div class="m-wrap">
        <!-- API -->
        <div class="container-lg new-discussion-timeline experiment-repo-nav  p-responsive content markdown-section">
          <div class="repository-content ">



            <div id="wiki-wrapper" class="page">


              <div class="d-flex flex-column flex-md-row gh-header">
                <h1 class="flex-auto min-width-0 mb-2 mb-md-0 mr-0 mr-md-2 gh-header-title instapaper_title">pomelo
                  0.9新特性</h1>

                <div class="mt-0 mt-lg-1 flex-shrink-0 gh-header-actions">
                  <a href="#wiki-pages-box" class="d-md-none pl-2 float-right">Jump to bottom</a>

                  <a class="btn btn-sm ml-0"
                    href="/NetEase/pomelo/wiki/pomelo-0.9%E6%96%B0%E7%89%B9%E6%80%A7/_edit">Edit</a>
                  <a class="btn btn-sm btn-primary" href="/NetEase/pomelo/wiki/_new">New Page</a>
                </div>
              </div>

              <div class="mt-2 mt-md-1 pb-3 gh-header-meta">
                py edited this page <relative-time datetime="2014-02-26T06:32:49Z" title="2014年2月26日 GMT+8 下午2:32">on 26
                  Feb 2014</relative-time>
                ·
                <a href="/NetEase/pomelo/wiki/pomelo-0.9%E6%96%B0%E7%89%B9%E6%80%A7/_history" class="muted-link">
                  1 revision
                </a>
              </div>

              <div id="wiki-content" class="d-flex flex-column flex-md-row">
                <div id="wiki-body" class="mt-4 flex-auto min-width-0 gollum-markdown-content instapaper_body">
                  <div class="markdown-body">
                    <h2>
                      <a id="user-content-pomelo-rpc支持zeromq通信" class="anchor"
                        href="#pomelo-rpc%E6%94%AF%E6%8C%81zeromq%E9%80%9A%E4%BF%A1" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>pomelo rpc支持zeromq通信</h2>
                    <p>在pomelo
                      0.9中提供了基于zmq的rpc调用，开发者可以根据需要选择原有的pomelo-rpc或者pomelo-rpc-zeromq。基于zeromq和原有的pomelo-rpc的性能对比测试结果可以参考：
                    </p>
                    <p>具体使用方法：</p>
                    <ol>
                      <li>
                        <p>安装zeromq</p>
                      </li>
                      <li>
                        <p>在app.js中进行配置，具体配置如下所示：</p>
                      </li>
                    </ol>
                    <pre><code>
          var zmq = require('pomelo-rpc-zeromq');
          
          app.configure('production|development', function() {
          
              app.set('proxyConfig', {
                  rpcClient: zmq.client
              });
          
              app.set('remoteConfig', {
                  rpcServer: zmq.server
              });
          
          });
          
          </code></pre>
                    <p>具体使用示例可以参考 <a href="https://github.com/NetEase/chatofpomelo/tree/zmq">chatofpomelo</a> zmq分支</p>
                    <p><a
                        href="https://github.com/NetEase/pomelo/wiki/pomelo-rpc-zeromq%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A">pomelo-rpc-zeromq性能测试报告</a>与原有的<a
                        href="https://github.com/NetEase/pomelo/wiki/pomelo-rpc%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A">pomelo-rpc的性能测试报告</a>可以参考。
                    </p>
                    <h2>
                      <a id="user-content-pomelo命令行改进" class="anchor"
                        href="#pomelo%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%94%B9%E8%BF%9B" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>pomelo命令行改进</h2>
                    <p>根据网友的建议，在pomelo 0.9版本中增加了重启的命令和服务器单独启动的命令；具体命令如下：</p>
                    <p>pomelo start -t [server type] 启动某类型的服务器，如果需要分开启动不同类型服务器时候使用，首先必须启动master服务器，例如：</p>
                    <pre><code>
          pomelo start -t master
          pomelo start -t connector
          
          </code></pre>
                    <p>pomelo start -i [server id] 启动具体某个服务器，同上首先需要启动master，master服务器无需提供具体id, 例如：</p>
                    <pre><code>
          pomelo start -i master
          pomelo start -i chat-server-1
          
          </code></pre>
                    <p>pomelo restart 重启除了master以为的其它服务器，可能会出现重启失败的情况。</p>
                    <p>pomelo restart -t [server type] 重启某类型的服务器，不包括master服务器</p>
                    <p>pomelo restart -i [server id] 重启具体某个服务器，不包括master服务器</p>
                    <pre><code>
          pomelo restart -t connector
          pomelo restart -i chat-server-1
          
          </code></pre>
                    <h2>
                      <a id="user-content-pomelo-rpc增加回调超时机制" class="anchor"
                        href="#pomelo-rpc%E5%A2%9E%E5%8A%A0%E5%9B%9E%E8%B0%83%E8%B6%85%E6%97%B6%E6%9C%BA%E5%88%B6"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>pomelo rpc增加回调超时机制</h2>
                    <p>针对之前网友提出的<a href="http://nodejs.netease.com/topic/52b2d8470a516e1851b256e4"
                        rel="nofollow">rpc回调函数积压问题</a>,
                      在新版本的pomelo-rpc中通过增加了回调函数的超时机制解决，rpc客户端在记录应用层的回调函数的同时添加对应的定时器，如果rpc服务端收到对应的消息则将定时器清除，如果定时器超时则将对应的回调函数清除。定时器的超时时间开发者可以进行设置，默认是10s，
                      具体使用如下：</p>
                    <pre><code>
          app.set('proxyConfig', {
              timeout: 1000 * 20
          });
          
          </code></pre>
                    <h2>
                      <a id="user-content-pomelo支持连接黑名单机制" class="anchor"
                        href="#pomelo%E6%94%AF%E6%8C%81%E8%BF%9E%E6%8E%A5%E9%BB%91%E5%90%8D%E5%8D%95%E6%9C%BA%E5%88%B6"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>pomelo支持连接黑名单机制</h2>
                    <p>在新版本的pomelo中连接服务器支持静态或者动态添加ip黑名单功能，服务端可以在连接服务器中增加黑名单对攻击的ip进行屏蔽。</p>
                    <h3>
                      <a id="user-content-原理" class="anchor" href="#%E5%8E%9F%E7%90%86" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>原理</h3>
                    <p>connector每接受一个连接都会抛出一个连接事件, 这个事件中含有该连接的客户端IP. connector会捕获该连接事件, 并调用用户传入的获取IP黑名单的函数,
                      如果该客户端IP在黑名单中, 则立刻将对应的socket断开. 以此来实现连接服务器的黑名单过滤功能.</p>
                    <h3>
                      <a id="user-content-使用方法" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>使用方法</h3>
                    <h4>
                      <a id="user-content-静态添加黑名单" class="anchor"
                        href="#%E9%9D%99%E6%80%81%E6%B7%BB%E5%8A%A0%E9%BB%91%E5%90%8D%E5%8D%95" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>静态添加黑名单</h4>
                    <p>使用时只需要向在connector的connectionConfig配置中传入一个获取IP黑名单的函数即可, 这个函数需要接受一个回调函数作为其参数,
                      该回调函数形如<code>function(err, list) {...}</code>. 在获取IP黑名单的函数内,
                      拿到IP黑名单时(该黑名单应为一维<code>JS Array</code>),
                      以类似于<code>cb(null, self.list)</code>的形式调用IP过滤回调函数，具体使用方法如下：</p>
                    <pre><code>./game-server/app/util/blackList.js
          ... ...
          var self = this;
          self.blackList = ['192.168.100.1', '192.168.100.2'];
          module.exports.blackListFun = function(cb) {
            cb(null, self.blackList);
          };
          ... ...
          </code></pre>
                    <pre><code>./game-server/app.js
          var blackList = require('./app/util/blackList');
          ... ...
          app.configure('production|development', function() {
          ... ...
            app.set('connectorConfig', {
                blacklistFun: blackList.blackListFun
            });
          ... ...
          }
          </code></pre>
                    <h4>
                      <a id="user-content-动态添加黑名单" class="anchor"
                        href="#%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0%E9%BB%91%E5%90%8D%E5%8D%95" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>动态添加黑名单</h4>
                    <p>动态添加黑名单可以通过pomelo-cli完成，其中运行输入具体ip或者正则表达式，具体命令如下：</p>
                    <pre><code>
          blacklist 192.168.100.1
          blacklist (([01]?d?d|2[0-4]d|25[0-5]).){3}([01]?d?d|2[0-4]d|25[0-5])
          
          </code></pre>
                    <h2>
                      <a id="user-content-channel-序列化接口" class="anchor"
                        href="#channel-%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A5%E5%8F%A3" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>channel 序列化接口</h2>
                    <p>
                      在新版本的pomelo中提供channel的序列化接口，开发者可以通过实现该接口将系统中创建的channel进行保存；同时当服务器重新启动后，系统会将之前保存的channel恢复到系统中。开发者需要实现如下四个接口：
                    </p>
                    <h4>
                      <a id="user-content-addkey-value-cb" class="anchor" href="#addkey-value-cb"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>add(key, value, cb)</h4>
                    <p>add key value pairs</p>
                    <h4>
                      <a id="user-content-removekey-value-cb" class="anchor" href="#removekey-value-cb"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>remove(key, value, cb)</h4>
                    <p>remove key value pairs</p>
                    <h4>
                      <a id="user-content-loadkey-cb" class="anchor" href="#loadkey-cb" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>load(key, cb)</h4>
                    <p>load all values</p>
                    <h4>
                      <a id="user-content-removeallkey-cb" class="anchor" href="#removeallkey-cb"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>removeAll(key, cb)</h4>
                    <p>remove all values</p>
                    <p>具体的使用方法如下所示：</p>
                    <pre><code>
          var store = require('./store');
          
          app.set('channelConfig', {
                      store : store,
                      prefix : 'pomelo'
                  });
          
          </code></pre>
                    <pre><code>//store.js
          
          var redis = require('redis');
          
          var StoreManager = function() {
            this.redis = redis.createClient(6379, '127.0.0.1', {});
          };
          
          module.exports = new StoreManager();
          
          StoreManager.prototype.add = function(key, value, cb) {
            this.redis.sadd(key, value, function(err) {
              cb(err);
            });
          };
          
          StoreManager.prototype.remove = function(key, value, cb) {
            this.redis.srem(key, value, function(err) {
                cb(err);
            });
          };
          
          StoreManager.prototype.load = function(key, cb) {
              this.redis.smembers(key, function(err, list) {
                  cb(err, list);
              });
          };
          
          StoreManager.prototype.removeAll = function(key, cb) {
            this.redis.del(key, function(err) {
              cb(err);
            });
          };
          
          </code></pre>
                    <h2>
                      <a id="user-content-热重启的部分支持" class="anchor"
                        href="#%E7%83%AD%E9%87%8D%E5%90%AF%E7%9A%84%E9%83%A8%E5%88%86%E6%94%AF%E6%8C%81"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>热重启的部分支持</h2>
                    <p>
                      在新版本的pomelo中对rpc模块进行了改进，在rpc服务端断开连接后，上层应用的rpc请求会在rpc客户端缓存；当rpc服务端恢复后，再次发起rpc请求时，会把之前的rpc请求一起发到rpc服务端。
                    </p>
                    <p>
                      在系统中如果是rpc单向依赖，也就是说系统中只有A类服务器发送rpc请求到B类服务器，没有B类服务器发送rpc请求到A类服务器，同时B类服务器是没有任何状态信息和实例化信息，这样B类服务器就可以在pomelo
                      0.9版本中重启，且不会影响系统的正常运行。</p>
                    <p>具体可以参考<a href="https://github.com/NetEase/chatofpomelo">chatofpomelo</a>
                      store分支。在chatofpomelo中只有connector到chat服务器的单向rpc依赖，对于chat服务器有channel的实例存在，所以使用channel序列化接口将channel存储，所以需要使用到redis。
                    </p>
                    <p>操作步骤如下：</p>
                    <ol>
                      <li>在不同的命令行界面分别执行 pomelo start -t master， pomelo start -t connector, pomelo start -t gate, pomelo
                        start -t chat;</li>
                      <li>打开web服务器，运行chatofpomelo;</li>
                      <li>关闭chat服务器，并重新启动；</li>
                    </ol>
                    <h2>
                      <a id="user-content-pomelo支持decodeio-protobuf" class="anchor"
                        href="#pomelo%E6%94%AF%E6%8C%81decodeio-protobuf" aria-hidden="true"><svg
                          class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                          aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>pomelo支持decodeIO protobuf</h2>
                    <p>在pomelo 0.9版本中提供了对decodeIO的protobuf的支持，对于decodeIO的protobuf的介绍可以参考<a
                        href="https://github.com/dcodeIO/ProtoBuf.js">decodeIO-protobufjs</a>.</p>
                    <p>###使用方法</p>
                    <p>####客户端</p>
                    <p>使用最新的pomelo-jsclient-websocket,
                      同时在客户端添加命名为pomelo-decodeIO-protobuf的component，并将其挂载到window对象下。对应的component.js如下所示：</p>
                    <pre><code>
          {
            "name": "boot",
            "description": "Main app boot component",
            "dependencies": {
              "component/emitter":"master",
              "NetEase/pomelo-protocol": "master",
              "pomelonode/pomelo-decodeIO-protobuf": "master",
              "pomelonode/pomelo-jsclient-websocket": "master",
              "component/jquery": "*"
            },
            "scripts": ["index.js"]
          }
          
          
          </code></pre>
                    <p>对应的index.js如下所示：</p>
                    <pre><code>
            var Emitter = require('emitter');
            window.EventEmitter = Emitter;
          
            var protocol = require('pomelo-protocol');
            window.Protocol = protocol;
          
            var protobuf = require('pomelo-decodeIO-protobuf');
            window.decodeIO_protobuf = protobuf; 
            
            var pomelo = require('pomelo-jsclient-websocket');
            window.pomelo = pomelo;
          
            var jquery = require('jquery');
            window.$ = jquery;
          
          
          </code></pre>
                    <p>####服务端</p>
                    <p>在服务端需要使用pomelo-protobuf-plugin，并在app.js中使用对应的插件，具体配置如下：</p>
                    <pre><code>
          app.configure('production|development', function() {
              app.use(protobuf, {
                  protobuf: {
                  }
              });
          });
          
          </code></pre>
                    <p>####注意事项</p>
                    <p>pomelo原有的protobuf和decodeIO-protobufjs不能同时使用，即不能同时使用pomelo-protobuf-plugin插件并在前端服务器开启useProtobuf。
                    </p>
                    <p>考虑到与原有的protobuf保持一致，pomelo
                      0.9版本中支持的decodeIO-protobuf同样采用serverProtos.json和clientProtos.json，不支持decodeIO-protobufjs中的*.proto格式，对于*.proto格式可以采用decodeIO-protobufjs提供的命令行工具转换成json格式。
                    </p>
                    <p>具体的使用示例可以参考<a
                        href="https://github.com/NetEase/lordofpomelo/tree/decodeIO_protobuf">lordofpomelo</a>
                      decodeIO-protobuf分支。</p>
                    <h2>
                      <a id="user-content-pomelo-websocket支持自动重连" class="anchor"
                        href="#pomelo-websocket%E6%94%AF%E6%8C%81%E8%87%AA%E5%8A%A8%E9%87%8D%E8%BF%9E"
                        aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                          width="16" height="16" aria-hidden="true">
                          <path fill-rule="evenodd"
                            d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                          </path>
                        </svg></a>pomelo websocket支持自动重连</h2>
                    <p>在pomelo 0.9版本中，pomelo-jsclient-websocket
                      支持自动重连。重连发生在连接断开后的5s后，在重连失败后下次重连的时间将是上次重连时间的2倍；所以重连时间依次为5s,
                      10s，20s,依次类推。默认最大的重连次数是10次，该参数可以在连接初始化过程中进行配置。</p>
                    <pre><code>
          //设置客户端重连
          
          pomelo.init({
                  host: 127.0.0.1,
                  port: 3050,
                  reconnect: true
              }, function() {
          
          });
          
          
          //设置客户端重连最大次数
          
          pomelo.init({
                  host: 127.0.0.1,
                  port: 3050,
                  reconnect: true，
                    maxReconnectAttempts： 20
              }, function() {
          
          });
          
          
          </code></pre>

                  </div>

                 
                </div>

                
              </div>


            </div>
            <div class="modal-backdrop js-touch-events"></div>
          </div>


        </div>
      </div>
    </div>
  </div>
  <!-- 尾部 -->
  <div class="g-ft">
    <!-- 尾部模块 -->
    <div class="m-ft">
      copyright 2012, NetEase, Inc. All Rights Reserved.
    </div>
  </div>
  <!-- 向上图标 -->
  <div class="m-arrow f-dn"><a href="https://github.com/NetEase/pomelo"></a></div>
  <!-- 代码高亮模块 -->
  <script src="./pomelo API_files/hijs.js.下载"></script>
  <!-- 页面效果模块 -->
  <script src="./pomelo API_files/api.js.下载"></script>


  <!--
     FILE ARCHIVED ON 09:56:39 May 21, 2017 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 08:03:27 Apr 17, 2019.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
  <!--
playback timings (ms):
  LoadShardBlock: 38.391 (3)
  esindex: 0.009
  captures_list: 63.134
  CDXLines.iter: 9.271 (3)
  PetaboxLoader3.datanode: 79.422 (4)
  exclusion.robots: 0.271
  exclusion.robots.policy: 0.258
  RedisCDXSource: 12.031
  PetaboxLoader3.resolve: 29.114
  load_resource: 77.579
-->
</body>

</html>