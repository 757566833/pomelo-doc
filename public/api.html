<!DOCTYPE html>
<!-- saved from url=(0077)https://web.archive.org/web/20170521095639/http://pomelo.netease.com/api.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./pomelo API_files/analytics.js.下载" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app103.us.archive.org';v.server_ms=145;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="./pomelo API_files/ait-client-rewrite.js.下载" charset="utf-8"></script>
<script type="text/javascript">
WB_wombat_Init("https://web.archive.org/web", "20170521095639", "pomelo.netease.com:80");
</script>
<script type="text/javascript" src="./pomelo API_files/wbhack.js.下载" charset="utf-8"></script>
<script type="text/javascript">
__wbhack.init('https://web.archive.org/web');
</script>
<link rel="stylesheet" type="text/css" href="./pomelo API_files/banner-styles.css">
<link rel="stylesheet" type="text/css" href="./pomelo API_files/iconochive.css">
<!-- End Wayback Rewrite JS Include -->

    
    <title>pomelo API</title>
    <meta http-equiv="content-type" content="text/html">
    <meta http-equiv="content-style-type" content="text/css">
    <meta http-equiv="content-script-type" content="text/javascript">
    <meta name="author" content="netease">
    <meta name="version" content="1.0">
    <meta name="keywords" content="pomelo, game, framework, lordofpomelo, node.js, js, 网易，游戏">
    <meta name="description" content="Pomelo is a fast, scalable, distributed game server framework for Node.js. It provides the basic development framework and a lot of related components, including libraries and tools. Pomelo is also suitable for realtime web application, its distributed architecture makes Pomelo scale better than other realtime web frameworks.">


    <link type="text/css" rel="stylesheet" href="./pomelo API_files/base.css">
    <link type="text/css" rel="stylesheet" href="./pomelo API_files/api.css">

    <script>
      var raw = [{"id":"1-1387877793311","name":"Application","signiture":"Application","type":"declaration","ctx":{"type":"declaration","name":"Application","value":"module.exports = {}","string":"Application"},"description":{"full":"<p>Application prototype.</p>","summary":"<p>Application prototype.</p>","body":""},"full_description":"<p>Application prototype.</p>","code":"var Application = module.exports = {};","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"4-1387877793311","name":"getBase","signiture":"Application.getBase()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getBase","string":"Application.getBase()"},"description":{"full":"<p>Get application base path</p>\n\n<p>// cwd: /home/game/<br /> pomelo start<br /> // app.getBase() -> /home/game</p>","summary":"<p>Get application base path</p>","body":"<p>// cwd: /home/game/<br /> pomelo start<br /> // app.getBase() -> /home/game</p>"},"full_description":"<p>Get application base path</p>\n\n<p>// cwd: /home/game/  pomelo start  // app.getBase() -> /home/game</p>","code":"Application.getBase = function() {\n  return this.get(Constants.Reserved.BASE);\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["String"],"description":"application base path"},{"type":"","string":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"5-1387877793311","name":"filter","signiture":"Application.filter()","type":"method","ctx":{"type":"method","receiver":"Application","name":"filter","string":"Application.filter()"},"description":{"full":"<p>add a filter to before and after filter</p>","summary":"<p>add a filter to before and after filter</p>","body":""},"full_description":"<p>add a filter to before and after filter</p>","code":"Application.filter = function (filter) {\n  this.before(filter);\n  this.after(filter);\n};","params":[{"type":"param","types":["Object"],"name":"filter","description":"provide before and after filter method."}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"filter","description":"provide before and after filter method."},{"type":"","string":"A filter should have two methods: before and after."},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"6-1387877793311","name":"before","signiture":"Application.before()","type":"method","ctx":{"type":"method","receiver":"Application","name":"before","string":"Application.before()"},"description":{"full":"<p>Add before filter.</p>","summary":"<p>Add before filter.</p>","body":""},"full_description":"<p>Add before filter.</p>","code":"Application.before = function (bf) {\n  addFilter(this, Constants.KeyWords.BEFORE_FILTER, bf);\n};","params":[{"type":"param","types":["Object","Function"],"name":"bf","description":"before fileter, bf(msg, session, next)"}],"has_params":true,"tags":[{"type":"param","types":["Object","Function"],"name":"bf","description":"before fileter, bf(msg, session, next)"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"7-1387877793311","name":"after","signiture":"Application.after()","type":"method","ctx":{"type":"method","receiver":"Application","name":"after","string":"Application.after()"},"description":{"full":"<p>Add after filter.</p>","summary":"<p>Add after filter.</p>","body":""},"full_description":"<p>Add after filter.</p>","code":"Application.after = function (af) {\n  addFilter(this, Constants.KeyWords.AFTER_FILTER, af);\n};","params":[{"type":"param","types":["Object","Function"],"name":"af","description":"after filter, `af(err, msg, session, resp, next)`"}],"has_params":true,"tags":[{"type":"param","types":["Object","Function"],"name":"af","description":"after filter, `af(err, msg, session, resp, next)`"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"8-1387877793311","name":"globalFilter","signiture":"Application.globalFilter()","type":"method","ctx":{"type":"method","receiver":"Application","name":"globalFilter","string":"Application.globalFilter()"},"description":{"full":"<p>add a global filter to before and after global filter</p>","summary":"<p>add a global filter to before and after global filter</p>","body":""},"full_description":"<p>add a global filter to before and after global filter</p>","code":"Application.globalFilter = function (filter) {\n  this.globalBefore(filter);\n  this.globalAfter(filter);\n};","params":[{"type":"param","types":["Object"],"name":"filter","description":"provide before and after filter method."}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"filter","description":"provide before and after filter method."},{"type":"","string":"A filter should have two methods: before and after."},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"9-1387877793311","name":"globalBefore","signiture":"Application.globalBefore()","type":"method","ctx":{"type":"method","receiver":"Application","name":"globalBefore","string":"Application.globalBefore()"},"description":{"full":"<p>Add global before filter.</p>","summary":"<p>Add global before filter.</p>","body":""},"full_description":"<p>Add global before filter.</p>","code":"Application.globalBefore = function (bf) {\n  addFilter(this, Constants.KeyWords.GLOBAL_BEFORE_FILTER, bf);\n};","params":[{"type":"param","types":["Object","Function"],"name":"bf","description":"before fileter, bf(msg, session, next)"}],"has_params":true,"tags":[{"type":"param","types":["Object","Function"],"name":"bf","description":"before fileter, bf(msg, session, next)"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"10-1387877793311","name":"globalAfter","signiture":"Application.globalAfter()","type":"method","ctx":{"type":"method","receiver":"Application","name":"globalAfter","string":"Application.globalAfter()"},"description":{"full":"<p>Add global after filter.</p>","summary":"<p>Add global after filter.</p>","body":""},"full_description":"<p>Add global after filter.</p>","code":"Application.globalAfter = function (af) {\n  addFilter(this, Constants.KeyWords.GLOBAL_AFTER_FILTER, af);\n};","params":[{"type":"param","types":["Object","Function"],"name":"af","description":"after filter, `af(err, msg, session, resp, next)`"}],"has_params":true,"tags":[{"type":"param","types":["Object","Function"],"name":"af","description":"after filter, `af(err, msg, session, resp, next)`"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"11-1387877793311","name":"rpcBefore","signiture":"Application.rpcBefore()","type":"method","ctx":{"type":"method","receiver":"Application","name":"rpcBefore","string":"Application.rpcBefore()"},"description":{"full":"<p>Add rpc before filter.</p>","summary":"<p>Add rpc before filter.</p>","body":""},"full_description":"<p>Add rpc before filter.</p>","code":"Application.rpcBefore = function(bf) {\n  addFilter(this, Constants.KeyWords.RPC_BEFORE_FILTER, bf);\n};","params":[{"type":"param","types":["Object","Function"],"name":"bf","description":"before fileter, bf(serverId, msg, opts, next)"}],"has_params":true,"tags":[{"type":"param","types":["Object","Function"],"name":"bf","description":"before fileter, bf(serverId, msg, opts, next)"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"12-1387877793311","name":"rpcAfter","signiture":"Application.rpcAfter()","type":"method","ctx":{"type":"method","receiver":"Application","name":"rpcAfter","string":"Application.rpcAfter()"},"description":{"full":"<p>Add rpc after filter.</p>","summary":"<p>Add rpc after filter.</p>","body":""},"full_description":"<p>Add rpc after filter.</p>","code":"Application.rpcAfter = function(af) {\n  addFilter(this, Constants.KeyWords.RPC_AFTER_FILTER, af);\n};","params":[{"type":"param","types":["Object","Function"],"name":"af","description":"after filter, `af(serverId, msg, opts, next)`"}],"has_params":true,"tags":[{"type":"param","types":["Object","Function"],"name":"af","description":"after filter, `af(serverId, msg, opts, next)`"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"13-1387877793311","name":"rpcFilter","signiture":"Application.rpcFilter()","type":"method","ctx":{"type":"method","receiver":"Application","name":"rpcFilter","string":"Application.rpcFilter()"},"description":{"full":"<p>add a rpc filter to before and after rpc filter</p>","summary":"<p>add a rpc filter to before and after rpc filter</p>","body":""},"full_description":"<p>add a rpc filter to before and after rpc filter</p>","code":"Application.rpcFilter = function(filter) {\n  this.rpcBefore(filter);\n  this.rpcAfter(filter);\n};","params":[{"type":"param","types":["Object"],"name":"filter","description":"provide before and after filter method."}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"filter","description":"provide before and after filter method."},{"type":"","string":"A filter should have two methods: before and after."},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"14-1387877793311","name":"load","signiture":"Application.load()","type":"method","ctx":{"type":"method","receiver":"Application","name":"load","string":"Application.load()"},"description":{"full":"<p>Load component</p>","summary":"<p>Load component</p>","body":""},"full_description":"<p>Load component</p>","code":"Application.load = function(name, component, opts) {\n  if(typeof name !== 'string') {\n    opts = component;\n    component = name;\n    name = null;\n    if(typeof component.name === 'string') {\n      name = component.name;\n    }\n  }\n\n  if(typeof component === 'function') {\n    component = component(this, opts);\n  }\n\n  if(!name && typeof component.name === 'string') {\n    name = component.name;\n  }\n\n  if(name && this.components[name]) {\n    // ignore duplicat component\n    logger.warn('ignore duplicate component: %j', name);\n    return;\n  }\n\n  this.loaded.push(component);\n  if(name) {\n    // components with a name would get by name throught app.components later.\n    this.components[name] = component;\n  }\n\n  return this;\n};","params":[{"type":"param","types":["String"],"name":"name","description":"(optional) name of the component"},{"type":"param","types":["Object"],"name":"component","description":"component instance or factory function of the component"},{"type":"param","types":["[type]"],"name":"opts","description":"(optional) construct parameters for the factory function"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"(optional) name of the component"},{"type":"param","types":["Object"],"name":"component","description":"component instance or factory function of the component"},{"type":"param","types":["[type]"],"name":"opts","description":"(optional) construct parameters for the factory function"},{"type":"return","types":["Object"],"description":"app instance for chain invoke"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"15-1387877793311","name":"loadConfig","signiture":"Application.loadConfig()","type":"method","ctx":{"type":"method","receiver":"Application","name":"loadConfig","string":"Application.loadConfig()"},"description":{"full":"<p>Load Configure json file to settings.</p>","summary":"<p>Load Configure json file to settings.</p>","body":""},"full_description":"<p>Load Configure json file to settings.</p>","code":"Application.loadConfig = function (key, val) {\n  var env = this.get(Constants.Reserved.ENV);\n  val = require(val);\n  if (val[env]) {\n    val = val[env];\n  }\n  this.set(key, val);\n};","params":[{"type":"param","types":["String"],"name":"key","description":"environment key"},{"type":"param","types":["String"],"name":"val","description":"environment value"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"key","description":"environment key"},{"type":"param","types":["String"],"name":"val","description":"environment value"},{"type":"return","types":["Server","Mixed"],"description":"for chaining, or the setting value"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"16-1387877793311","name":"route","signiture":"Application.route()","type":"method","ctx":{"type":"method","receiver":"Application","name":"route","string":"Application.route()"},"description":{"full":"<p>Set the route function for the specified server type.</p>\n\n<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {<br />   // all request to area would be route to the first area server<br />   var areas = app.getServersByType('area');<br />   cb(null, areas[0].id);<br /> };</p>","summary":"<p>Set the route function for the specified server type.</p>","body":"<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {<br />   // all request to area would be route to the first area server<br />   var areas = app.getServersByType('area');<br />   cb(null, areas[0].id);<br /> };</p>"},"full_description":"<p>Set the route function for the specified server type.</p>\n\n<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {    // all request to area would be route to the first area server    var areas = app.getServersByType('area');    cb(null, areas[0].id);  };</p>","code":"Application.route = function(serverType, routeFunc) {\n  var routes = this.get(Constants.KeyWords.ROUTE);\n  if(!routes) {\n    routes = {};\n    this.set(Constants.KeyWords.ROUTE, routes);\n  }\n  routes[serverType] = routeFunc;\n  return this;\n};","params":[{"type":"param","types":["String"],"name":"serverType","description":"server type string"},{"type":"param","types":["Function"],"name":"routeFunc","description":"route function. routeFunc(session, msg, app, cb)"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"serverType","description":"server type string"},{"type":"param","types":["Function"],"name":"routeFunc","description":"route function. routeFunc(session, msg, app, cb)"},{"type":"return","types":["Object"],"description":"current application instance for chain invoking"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"17-1387877793311","name":"beforeStopHook","signiture":"Application.beforeStopHook()","type":"method","ctx":{"type":"method","receiver":"Application","name":"beforeStopHook","string":"Application.beforeStopHook()"},"description":{"full":"<p>Set before stop function. It would perform before servers stop.</p>","summary":"<p>Set before stop function. It would perform before servers stop.</p>","body":""},"full_description":"<p>Set before stop function. It would perform before servers stop.</p>","code":"Application.beforeStopHook = function(fun) {\n  logger.warn('this method was deprecated in pomelo 0.8');\n  if(!!fun && typeof fun === 'function') {\n    this.set(Constants.KeyWords.BEFORE_STOP_HOOK, fun);\n  }\n};","params":[{"type":"param","types":["Function"],"name":"fun","description":"before close function"}],"has_params":true,"tags":[{"type":"param","types":["Function"],"name":"fun","description":"before close function"},{"type":"return","types":["Void"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"18-1387877793311","name":"start","signiture":"Application.start()","type":"method","ctx":{"type":"method","receiver":"Application","name":"start","string":"Application.start()"},"description":{"full":"<p>Start application. It would load the default components and start all the loaded components.</p>","summary":"<p>Start application. It would load the default components and start all the loaded components.</p>","body":""},"full_description":"<p>Start application. It would load the default components and start all the loaded components.</p>","code":"Application.start = function(cb) {\n  this.startTime = Date.now();\n  if(this.state > STATE_INITED) {\n    utils.invokeCallback(cb, new Error('application has already start.'));\n    return;\n  }\n  appUtil.loadDefaultComponents(this);\n  var self = this;\n  var startUp = function() {\n    appUtil.optComponents(self.loaded, Constants.Reserved.START, function(err) {\n      self.state = STATE_START;\n      if(err) {\n        utils.invokeCallback(cb, err);\n      } else {\n        logger.info('%j enter after start...', self.getServerId());\n        self.afterStart(cb);\n      }\n    });\n  };\n  var beforeFun = this.lifecycleCbs[Constants.LIFECYCLE.BEFORE_STARTUP];\n  if(!!beforeFun) {\n    beforeFun.call(null, this, startUp);\n  } else {\n    startUp();\n  }\n};","params":[{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"21-1387877793311","name":"set","signiture":"Application.set()","type":"method","ctx":{"type":"method","receiver":"Application","name":"set","string":"Application.set()"},"description":{"full":"<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>\n\n<p>Example:</p>\n\n<p>app.set('key1', 'value1');<br /> app.get('key1');  // 'value1'<br /> app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);<br /> app.get('key2');  // 'value2'<br /> app.key2;         // 'value2'</p>","summary":"<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>","body":"<p>Example:</p>\n\n<p>app.set('key1', 'value1');<br /> app.get('key1');  // 'value1'<br /> app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);<br /> app.get('key2');  // 'value2'<br /> app.key2;         // 'value2'</p>"},"full_description":"<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>\n\n<p>Example:</p>\n\n<p>app.set('key1', 'value1');  app.get('key1');  // 'value1'  app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);  app.get('key2');  // 'value2'  app.key2;         // 'value2'</p>","code":"Application.set = function (setting, val, attach) {\n  if (arguments.length === 1) {\n    return this.settings[setting];\n  }\n  this.settings[setting] = val;\n  if(attach) {\n    this[setting] = val;\n  }\n  return this;\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"the setting of application"},{"type":"param","types":["String"],"name":"val","description":"the setting's value"},{"type":"param","types":["Boolean"],"name":"attach","description":"whether attach the settings to application"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"the setting of application"},{"type":"param","types":["String"],"name":"val","description":"the setting's value"},{"type":"param","types":["Boolean"],"name":"attach","description":"whether attach the settings to application"},{"type":"return","types":["Server","Mixed"],"description":"for chaining, or the setting value"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"22-1387877793311","name":"get","signiture":"Application.get()","type":"method","ctx":{"type":"method","receiver":"Application","name":"get","string":"Application.get()"},"description":{"full":"<p>Get property from setting</p>","summary":"<p>Get property from setting</p>","body":""},"full_description":"<p>Get property from setting</p>","code":"Application.get = function (setting) {\n  return this.settings[setting];\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["String"],"description":"val"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"23-1387877793311","name":"enabled","signiture":"Application.enabled()","type":"method","ctx":{"type":"method","receiver":"Application","name":"enabled","string":"Application.enabled()"},"description":{"full":"<p>Check if <code>setting</code> is enabled.</p>","summary":"<p>Check if <code>setting</code> is enabled.</p>","body":""},"full_description":"<p>Check if <code>setting</code> is enabled.</p>","code":"Application.enabled = function (setting) {\n  return !!this.get(setting);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["Boolean"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"24-1387877793311","name":"disabled","signiture":"Application.disabled()","type":"method","ctx":{"type":"method","receiver":"Application","name":"disabled","string":"Application.disabled()"},"description":{"full":"<p>Check if <code>setting</code> is disabled.</p>","summary":"<p>Check if <code>setting</code> is disabled.</p>","body":""},"full_description":"<p>Check if <code>setting</code> is disabled.</p>","code":"Application.disabled = function (setting) {\n  return !this.get(setting);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["Boolean"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"25-1387877793311","name":"enable","signiture":"Application.enable()","type":"method","ctx":{"type":"method","receiver":"Application","name":"enable","string":"Application.enable()"},"description":{"full":"<p>Enable <code>setting</code>.</p>","summary":"<p>Enable <code>setting</code>.</p>","body":""},"full_description":"<p>Enable <code>setting</code>.</p>","code":"Application.enable = function (setting) {\n  return this.set(setting, true);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["app"],"description":"for chaining"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"26-1387877793311","name":"disable","signiture":"Application.disable()","type":"method","ctx":{"type":"method","receiver":"Application","name":"disable","string":"Application.disable()"},"description":{"full":"<p>Disable <code>setting</code>.</p>","summary":"<p>Disable <code>setting</code>.</p>","body":""},"full_description":"<p>Disable <code>setting</code>.</p>","code":"Application.disable = function (setting) {\n  return this.set(setting, false);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["app"],"description":"for chaining"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"27-1387877793311","name":"configure","signiture":"Application.configure()","type":"method","ctx":{"type":"method","receiver":"Application","name":"configure","string":"Application.configure()"},"description":{"full":"<p>Configure callback for the specified env and server type.<br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified<br />that callback will be invoked for all server types.</p>\n\n<p>Examples:</p>\n\n<p>app.configure(function(){<br />   // executed for all envs and server types<br /> });</p>\n\n<p>app.configure('development', function(){<br />   // executed development env<br /> });</p>\n\n<p>app.configure('development', 'connector', function(){<br />   // executed for development env and connector server type<br /> });</p>","summary":"<p>Configure callback for the specified env and server type.<br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified<br />that callback will be invoked for all server types.</p>","body":"<p>Examples:</p>\n\n<p>app.configure(function(){<br />   // executed for all envs and server types<br /> });</p>\n\n<p>app.configure('development', function(){<br />   // executed development env<br /> });</p>\n\n<p>app.configure('development', 'connector', function(){<br />   // executed for development env and connector server type<br /> });</p>"},"full_description":"<p>Configure callback for the specified env and server type. When no env is specified that callback will be invoked for all environments and when no type is specified that callback will be invoked for all server types.</p>\n\n<p>Examples:</p>\n\n<p>app.configure(function(){    // executed for all envs and server types  });</p>\n\n<p>app.configure('development', function(){    // executed development env  });</p>\n\n<p>app.configure('development', 'connector', function(){    // executed for development env and connector server type  });</p>","code":"Application.configure = function (env, type, fn) {\n  var args = [].slice.call(arguments);\n  fn = args.pop();\n  env = type = Constants.Reserved.ALL;\n\n  if(args.length > 0) {\n    env = args[0];\n  }\n  if(args.length > 1) {\n    type = args[1];\n  }\n\n  if (env === Constants.Reserved.ALL || contains(this.settings.env, env)) {\n    if (type === Constants.Reserved.ALL || contains(this.settings.serverType, type)) {\n      fn.call(this);\n    }\n  }\n  return this;\n};","params":[{"type":"param","types":["String"],"name":"env","description":"application environment"},{"type":"param","types":["Function"],"name":"fn","description":"callback function"},{"type":"param","types":["String"],"name":"type","description":"server type"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"env","description":"application environment"},{"type":"param","types":["Function"],"name":"fn","description":"callback function"},{"type":"param","types":["String"],"name":"type","description":"server type"},{"type":"return","types":["Application"],"description":"for chaining"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"28-1387877793311","name":"registerAdmin","signiture":"Application.registerAdmin()","type":"method","ctx":{"type":"method","receiver":"Application","name":"registerAdmin","string":"Application.registerAdmin()"},"description":{"full":"<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>","summary":"<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>","body":""},"full_description":"<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>","code":"Application.registerAdmin = function(moduleId, module, opts) {\n  var modules = this.get(Constants.KeyWords.MODULE);\n  if(!modules) {\n    modules = {};\n    this.set(Constants.KeyWords.MODULE, modules);\n  }\n\n  if(typeof moduleId !== 'string') {\n    opts = module;\n    module = moduleId;\n    if(module) {\n      moduleId = module.moduleId;\n    }\n  }\n\n  if(!moduleId){\n    return;\n  }\n\n  modules[moduleId] = {\n    moduleId: moduleId,\n    module: module,\n    opts: opts\n  };\n};","params":[{"type":"param","types":["String"],"name":"module","description":"(optional) module id or provoided by module.moduleId"},{"type":"param","types":["Object"],"name":"module","description":"module object or factory function for module"},{"type":"param","types":["Object"],"name":"opts","description":"construct parameter for module"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"module","description":"(optional) module id or provoided by module.moduleId"},{"type":"param","types":["Object"],"name":"module","description":"module object or factory function for module"},{"type":"param","types":["Object"],"name":"opts","description":"construct parameter for module"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"29-1387877793311","name":"use","signiture":"Application.use()","type":"method","ctx":{"type":"method","receiver":"Application","name":"use","string":"Application.use()"},"description":{"full":"<p>Use plugin.</p>","summary":"<p>Use plugin.</p>","body":""},"full_description":"<p>Use plugin.</p>","code":"Application.use = function(plugin, opts) {\n  if(!plugin.components) {\n    logger.error('invalid components, no components exist');\n    return;\n  }\n  \n  var self = this;\n  var dir = path.dirname(plugin.components);\n\n  if(!fs.existsSync(plugin.components)) {\n    logger.error('fail to find components, find path: %s', plugin.components);\n    return;\n  }\n\n  fs.readdirSync(plugin.components).forEach(function (filename) {\n    if (!/\\.js$/.test(filename)) {\n      return;\n    }\n    var name = path.basename(filename, '.js');\n    var param = opts[name] || {};\n    var absolutePath = path.join(dir, Constants.Dir.COMPONENT, filename);\n    if(!fs.existsSync(absolutePath)) {\n      logger.error('component %s not exist at %s', name, absolutePath);\n    } else {\n      self.load(require(absolutePath), param);\n    }\n  });\n\n  // load events\n  if(!plugin.events) {\n    return;\n  } else {\n    if(!fs.existsSync(plugin.events)) {\n      logger.error('fail to find events, find path: %s', plugin.events);\n      return;\n    }\n\n    fs.readdirSync(plugin.events).forEach(function (filename) {\n      if (!/\\.js$/.test(filename)) {\n        return;\n      }\n      var absolutePath = path.join(dir, Constants.Dir.EVENT, filename);\n      if(!fs.existsSync(absolutePath)) {\n        logger.error('events %s not exist at %s', filename, absolutePath);\n      } else {\n        bindEvents(require(absolutePath), self);\n      }\n    });\n  }\n};","params":[{"type":"param","types":["Object"],"name":"plugin","description":"plugin instance"},{"type":"param","types":["[type]"],"name":"opts","description":"(optional) construct parameters for the factory function"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"plugin","description":"plugin instance"},{"type":"param","types":["[type]"],"name":"opts","description":"(optional) construct parameters for the factory function"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"30-1387877793311","name":"transaction","signiture":"Application.transaction()","type":"method","ctx":{"type":"method","receiver":"Application","name":"transaction","string":"Application.transaction()"},"description":{"full":"<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed.<br />And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>","summary":"<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed.<br />And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>","body":""},"full_description":"<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed. And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>","code":"Application.transaction = function(name, conditions, handlers, retry) {\n  appManager.transaction(name, conditions, handlers, retry);\n};","params":[{"type":"param","types":["String"],"name":"name","description":"transaction name"},{"type":"param","types":["Object"],"name":"conditions","description":"functions which are called before transaction"},{"type":"param","types":["Object"],"name":"handlers","description":"functions which are called during transaction"},{"type":"param","types":["Number"],"name":"retry","description":"retry times to execute handlers if conditions are successfully executed"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"transaction name"},{"type":"param","types":["Object"],"name":"conditions","description":"functions which are called before transaction"},{"type":"param","types":["Object"],"name":"handlers","description":"functions which are called during transaction"},{"type":"param","types":["Number"],"name":"retry","description":"retry times to execute handlers if conditions are successfully executed"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"31-1387877793311","name":"getMaster","signiture":"Application.getMaster()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getMaster","string":"Application.getMaster()"},"description":{"full":"<p>Get master server info.</p>","summary":"<p>Get master server info.</p>","body":""},"full_description":"<p>Get master server info.</p>","code":"Application.getMaster = function() {\n  return this.master;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Object"],"description":"master server info, {id, host, port}"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"32-1387877793311","name":"getCurServer","signiture":"Application.getCurServer()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getCurServer","string":"Application.getCurServer()"},"description":{"full":"<p>Get current server info.</p>","summary":"<p>Get current server info.</p>","body":""},"full_description":"<p>Get current server info.</p>","code":"Application.getCurServer = function() {\n  return this.curServer;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Object"],"description":"current server info, {id, serverType, host, port}"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"33-1387877793311","name":"getServerId","signiture":"Application.getServerId()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServerId","string":"Application.getServerId()"},"description":{"full":"<p>Get current server id.</p>","summary":"<p>Get current server id.</p>","body":""},"full_description":"<p>Get current server id.</p>","code":"Application.getServerId = function() {\n  return this.serverId;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["String","Number"],"description":"current server id from servers.json"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"34-1387877793311","name":"getServerType","signiture":"Application.getServerType()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServerType","string":"Application.getServerType()"},"description":{"full":"<p>Get current server type.</p>","summary":"<p>Get current server type.</p>","body":""},"full_description":"<p>Get current server type.</p>","code":"Application.getServerType = function() {\n  return this.serverType;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["String","Number"],"description":"current server type from servers.json"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"35-1387877793311","name":"getServers","signiture":"Application.getServers()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServers","string":"Application.getServers()"},"description":{"full":"<p>Get all the current server infos.</p>","summary":"<p>Get all the current server infos.</p>","body":""},"full_description":"<p>Get all the current server infos.</p>","code":"Application.getServers = function() {\n  return this.servers;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Object"],"description":"server info map, key: server id, value: server info"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"36-1387877793311","name":"getServersFromConfig","signiture":"Application.getServersFromConfig()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServersFromConfig","string":"Application.getServersFromConfig()"},"description":{"full":"<p>Get all server infos from servers.json.</p>","summary":"<p>Get all server infos from servers.json.</p>","body":""},"full_description":"<p>Get all server infos from servers.json.</p>","code":"Application.getServersFromConfig = function() {\n  return this.get(Constants.KeyWords.SERVER_MAP);\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Object"],"description":"server info map, key: server id, value: server info"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"37-1387877793311","name":"getServerTypes","signiture":"Application.getServerTypes()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServerTypes","string":"Application.getServerTypes()"},"description":{"full":"<p>Get all the server type.</p>","summary":"<p>Get all the server type.</p>","body":""},"full_description":"<p>Get all the server type.</p>","code":"Application.getServerTypes = function() {\n  return this.serverTypes;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Array"],"description":"server type list"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"38-1387877793311","name":"getServerById","signiture":"Application.getServerById()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServerById","string":"Application.getServerById()"},"description":{"full":"<p>Get server info by server id from current server cluster.</p>","summary":"<p>Get server info by server id from current server cluster.</p>","body":""},"full_description":"<p>Get server info by server id from current server cluster.</p>","code":"Application.getServerById = function(serverId) {\n  return this.servers[serverId];\n};","params":[{"type":"param","types":["String"],"name":"serverId","description":"server id"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"serverId","description":"server id"},{"type":"return","types":["Object"],"description":"server info or undefined"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"39-1387877793311","name":"getServerFromConfig","signiture":"Application.getServerFromConfig()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServerFromConfig","string":"Application.getServerFromConfig()"},"description":{"full":"<p>Get server info by server id from servers.json.</p>","summary":"<p>Get server info by server id from servers.json.</p>","body":""},"full_description":"<p>Get server info by server id from servers.json.</p>","code":"Application.getServerFromConfig = function(serverId) {\n  return this.get(Constants.keyWords.SERVER_MAP)[serverId];\n};","params":[{"type":"param","types":["String"],"name":"serverId","description":"server id"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"serverId","description":"server id"},{"type":"return","types":["Object"],"description":"server info or undefined"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"40-1387877793311","name":"getServersByType","signiture":"Application.getServersByType()","type":"method","ctx":{"type":"method","receiver":"Application","name":"getServersByType","string":"Application.getServersByType()"},"description":{"full":"<p>Get server infos by server type.</p>","summary":"<p>Get server infos by server type.</p>","body":""},"full_description":"<p>Get server infos by server type.</p>","code":"Application.getServersByType = function(serverType) {\n  return this.serverTypeMaps[serverType];\n};","params":[{"type":"param","types":["String"],"name":"serverType","description":"server type"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"serverType","description":"server type"},{"type":"return","types":["Array"],"description":"server info list"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"41-1387877793311","name":"isFrontend","signiture":"Application.isFrontend()","type":"method","ctx":{"type":"method","receiver":"Application","name":"isFrontend","string":"Application.isFrontend()"},"description":{"full":"<p>Check the server whether is a frontend server</p>","summary":"<p>Check the server whether is a frontend server</p>","body":""},"full_description":"<p>Check the server whether is a frontend server</p>","code":"Application.isFrontend = function(server) {\n  server = server || this.getCurServer();\n  return !!server && server.frontend === 'true';\n};","params":[{"type":"param","types":["server"],"name":"server","description":"server info. it would check current server"}],"has_params":true,"tags":[{"type":"param","types":["server"],"name":"server","description":"server info. it would check current server"},{"type":"","string":"if server not specified"},{"type":"return","types":["Boolean"],"description":""},{"type":"","string":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"42-1387877793311","name":"isBackend","signiture":"Application.isBackend()","type":"method","ctx":{"type":"method","receiver":"Application","name":"isBackend","string":"Application.isBackend()"},"description":{"full":"<p>Check the server whether is a backend server</p>","summary":"<p>Check the server whether is a backend server</p>","body":""},"full_description":"<p>Check the server whether is a backend server</p>","code":"Application.isBackend = function(server) {\n  server = server || this.getCurServer();\n  return !!server && !server.frontend;\n};","params":[{"type":"param","types":["server"],"name":"server","description":"server info. it would check current server"}],"has_params":true,"tags":[{"type":"param","types":["server"],"name":"server","description":"server info. it would check current server"},{"type":"","string":"if server not specified"},{"type":"return","types":["Boolean"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"43-1387877793311","name":"isMaster","signiture":"Application.isMaster()","type":"method","ctx":{"type":"method","receiver":"Application","name":"isMaster","string":"Application.isMaster()"},"description":{"full":"<p>Check whether current server is a master server</p>","summary":"<p>Check whether current server is a master server</p>","body":""},"full_description":"<p>Check whether current server is a master server</p>","code":"Application.isMaster = function() {\n  return this.serverType === Constants.Reserved.MASTER;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Boolean"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"44-1387877793311","name":"addServers","signiture":"Application.addServers()","type":"method","ctx":{"type":"method","receiver":"Application","name":"addServers","string":"Application.addServers()"},"description":{"full":"<p>Add new server info to current application in runtime.</p>","summary":"<p>Add new server info to current application in runtime.</p>","body":""},"full_description":"<p>Add new server info to current application in runtime.</p>","code":"Application.addServers = function(servers) {\n  if(!servers || !servers.length) {\n    return;\n  }\n\n  var item, slist;\n  for(var i=0, l=servers.length; i<l; i++) {\n    item = servers[i];\n    // update global server map\n    this.servers[item.id] = item;\n\n    // update global server type map\n    slist = this.serverTypeMaps[item.serverType];\n    if(!slist) {\n      this.serverTypeMaps[item.serverType] = slist = [];\n    }\n    replaceServer(slist, item);\n\n    // update global server type list\n    if(this.serverTypes.indexOf(item.serverType) < 0) {\n      this.serverTypes.push(item.serverType);\n    }\n  }\n  this.event.emit(events.ADD_SERVERS, servers);\n};","params":[{"type":"param","types":["Array"],"name":"servers","description":"new server info list"}],"has_params":true,"tags":[{"type":"param","types":["Array"],"name":"servers","description":"new server info list"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"45-1387877793311","name":"removeServers","signiture":"Application.removeServers()","type":"method","ctx":{"type":"method","receiver":"Application","name":"removeServers","string":"Application.removeServers()"},"description":{"full":"<p>Remove server info from current application at runtime.</p>","summary":"<p>Remove server info from current application at runtime.</p>","body":""},"full_description":"<p>Remove server info from current application at runtime.</p>","code":"Application.removeServers = function(ids) {\n  if(!ids || !ids.length) {\n    return;\n  }\n\n  var id, item, slist;\n  for(var i=0, l=ids.length; i<l; i++) {\n    id = ids[i];\n    item = this.servers[id];\n    if(!item) {\n      continue;\n    }\n    // clean global server map\n    delete this.servers[id];\n\n    // clean global server type map\n    slist = this.serverTypeMaps[item.serverType];\n    removeServer(slist, id);\n    // TODO: should remove the server type if the slist is empty?\n  }\n  this.event.emit(events.REMOVE_SERVERS, ids);\n};","params":[{"type":"param","types":["Array"],"name":"ids","description":"server id list"}],"has_params":true,"tags":[{"type":"param","types":["Array"],"name":"ids","description":"server id list"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"46-1387877793311","name":"replaceServers","signiture":"Application.replaceServers()","type":"method","ctx":{"type":"method","receiver":"Application","name":"replaceServers","string":"Application.replaceServers()"},"description":{"full":"<p>Replace server info from current application at runtime.</p>","summary":"<p>Replace server info from current application at runtime.</p>","body":""},"full_description":"<p>Replace server info from current application at runtime.</p>","code":"Application.replaceServers = function(servers) {\n  if(!servers){\n    return;\n  }\n\n  this.servers = servers;\n  this.serverTypeMaps = {};\n  this.serverTypes = [];\n  var serverArray = [];\n  for(var id in servers){\n    var server = servers[id];\n    var serverType = server[Constants.Reserved.SERVER_TYPE];\n    var slist = this.serverTypeMaps[serverType];\n    if(!slist) {\n      this.serverTypeMaps[serverType] = slist = [];\n    }\n    this.serverTypeMaps[serverType].push(server);\n    // update global server type list\n    if(this.serverTypes.indexOf(serverType) < 0) {\n      this.serverTypes.push(serverType);\n    }\n    serverArray.push(server);\n  }\n  this.event.emit(events.REPLACE_SERVERS, serverArray);\n};","params":[{"type":"param","types":["Object"],"name":"server","description":"id map"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"server","description":"id map"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"47-1387877793311","name":"addCrons","signiture":"Application.addCrons()","type":"method","ctx":{"type":"method","receiver":"Application","name":"addCrons","string":"Application.addCrons()"},"description":{"full":"<p>Add crons from current application at runtime.</p>","summary":"<p>Add crons from current application at runtime.</p>","body":""},"full_description":"<p>Add crons from current application at runtime.</p>","code":"Application.addCrons = function(crons) {\n  if(!crons || !crons.length) {\n    logger.warn('crons is not defined.');\n    return;\n  }\n  this.event.emit(events.ADD_CRONS, crons);\n};","params":[{"type":"param","types":["Array"],"name":"crons","description":"new crons would be added in application"}],"has_params":true,"tags":[{"type":"param","types":["Array"],"name":"crons","description":"new crons would be added in application"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"48-1387877793311","name":"removeCrons","signiture":"Application.removeCrons()","type":"method","ctx":{"type":"method","receiver":"Application","name":"removeCrons","string":"Application.removeCrons()"},"description":{"full":"<p>Remove crons from current application at runtime.</p>","summary":"<p>Remove crons from current application at runtime.</p>","body":""},"full_description":"<p>Remove crons from current application at runtime.</p>","code":"Application.removeCrons = function(crons) {\n  if(!crons || !crons.length) {\n    logger.warn('ids is not defined.');\n    return;\n  }\n  this.event.emit(events.REMOVE_CRONS, crons);\n};\n\nvar replaceServer = function(slist, serverInfo) {\n  for(var i=0, l=slist.length; i<l; i++) {\n    if(slist[i].id === serverInfo.id) {\n      slist[i] = serverInfo;\n      return;\n    }\n  }\n  slist.push(serverInfo);\n};\n\nvar removeServer = function(slist, id) {\n  if(!slist || !slist.length) {\n    return;\n  }\n\n  for(var i=0, l=slist.length; i<l; i++) {\n    if(slist[i].id === id) {\n      slist.splice(i, 1);\n      return;\n    }\n  }\n};\n\nvar contains = function(str, settings) {\n  if(!settings) {\n    return false;\n  }\n\n  var ts = settings.split(\"|\");\n  for(var i=0, l=ts.length; i<l; i++) {\n    if(str === ts[i]) {\n      return true;\n    }\n  }\n  return false;\n};\n\nvar bindEvents = function(Event, app) {\n  var emethods = new Event(app);\n  for(var m in emethods) {\n    if(typeof emethods[m] === 'function') {\n      app.event.on(m, emethods[m].bind(emethods));\n    }\n  }\n};\n\nvar addFilter = function(app, type, filter) {\n var filters = app.get(type);\n  if(!filters) {\n    filters = [];\n    app.set(type, filters);\n  }\n  filters.push(filter);\n};","params":[{"type":"param","types":["Array"],"name":"crons","description":"old crons would be removed in application"}],"has_params":true,"tags":[{"type":"param","types":["Array"],"name":"crons","description":"old crons would be removed in application"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true}]},{"id":"63-1387877793312","name":"BackendSessionService","signiture":"BackendSessionService()","type":"function","ctx":{"type":"function","name":"BackendSessionService","string":"BackendSessionService()"},"description":{"full":"<p>Service that maintains backend sessions and the communiation with frontend<br />servers.</p>\n\n<p>BackendSessionService would be created in each server process and maintains<br />backend sessions for current process and communicates with the relative<br />frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by<br /><code>app.get('backendSessionService')</code> or app.backendSessionService.</p>","summary":"<p>Service that maintains backend sessions and the communiation with frontend<br />servers.</p>","body":"<p>BackendSessionService would be created in each server process and maintains<br />backend sessions for current process and communicates with the relative<br />frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by<br /><code>app.get('backendSessionService')</code> or app.backendSessionService.</p>"},"full_description":"<p>Service that maintains backend sessions and the communiation with frontend servers.</p>\n\n<p>BackendSessionService would be created in each server process and maintains backend sessions for current process and communicates with the relative frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by <code>app.get('backendSessionService')</code> or app.backendSessionService.</p>","code":"var BackendSessionService = function(app) {\n  this.app = app;\n};\n\nmodule.exports = BackendSessionService;\n\nBackendSessionService.prototype.create = function(opts) {\n  if(!opts) {\n    throw new Error('opts should not be empty.');\n  }\n  return new BackendSession(opts, this);\n};","params":[],"has_params":false,"tags":[{"type":"class","string":""},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"64-1387877793312","name":"get","signiture":"BackendSessionService.prototype.get()","type":"method","ctx":{"type":"method","constructor":"BackendSessionService","cons":"BackendSessionService","name":"get","string":"BackendSessionService.prototype.get()"},"description":{"full":"<p>Get backend session by frontend server id and session id.</p>","summary":"<p>Get backend session by frontend server id and session id.</p>","body":""},"full_description":"<p>Get backend session by frontend server id and session id.</p>","code":"BackendSessionService.prototype.get = function(frontendId, sid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'getBackendSessionBySid';\n  var args = [sid];\n  rpcInvoke(this.app, frontendId, namespace, service, method,\n            args, BackendSessionCB.bind(null, this, cb));\n};","params":[{"type":"param","types":["String"],"name":"frontendId","description":"frontend server id that session attached"},{"type":"param","types":["String"],"name":"sid","description":"session id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function. args: cb(err, BackendSession)"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"frontendId","description":"frontend server id that session attached"},{"type":"param","types":["String"],"name":"sid","description":"session id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function. args: cb(err, BackendSession)"},{"type":"","string":""},{"type":"memberOf","parent":"BackendSessionService"}],"module":false,"parent":"BackendSessionService","related":{"href":""},"has_related":true},{"id":"65-1387877793312","name":"getByUid","signiture":"BackendSessionService.prototype.getByUid()","type":"method","ctx":{"type":"method","constructor":"BackendSessionService","cons":"BackendSessionService","name":"getByUid","string":"BackendSessionService.prototype.getByUid()"},"description":{"full":"<p>Get backend sessions by frontend server id and user id.</p>","summary":"<p>Get backend sessions by frontend server id and user id.</p>","body":""},"full_description":"<p>Get backend sessions by frontend server id and user id.</p>","code":"BackendSessionService.prototype.getByUid = function(frontendId, uid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'getBackendSessionsByUid';\n  var args = [uid];\n  rpcInvoke(this.app, frontendId, namespace, service, method,\n            args, BackendSessionCB.bind(null, this, cb));\n};","params":[{"type":"param","types":["String"],"name":"frontendId","description":"frontend server id that session attached"},{"type":"param","types":["String"],"name":"uid","description":"user id binded with the session"},{"type":"param","types":["Function"],"name":"cb","description":"callback function. args: cb(err, BackendSessions)"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"frontendId","description":"frontend server id that session attached"},{"type":"param","types":["String"],"name":"uid","description":"user id binded with the session"},{"type":"param","types":["Function"],"name":"cb","description":"callback function. args: cb(err, BackendSessions)"},{"type":"","string":""},{"type":"memberOf","parent":"BackendSessionService"}],"module":false,"parent":"BackendSessionService","related":{"href":""},"has_related":true},{"id":"66-1387877793312","name":"kickBySid","signiture":"BackendSessionService.prototype.kickBySid()","type":"method","ctx":{"type":"method","constructor":"BackendSessionService","cons":"BackendSessionService","name":"kickBySid","string":"BackendSessionService.prototype.kickBySid()"},"description":{"full":"<p>Kick a session by session id.</p>","summary":"<p>Kick a session by session id.</p>","body":""},"full_description":"<p>Kick a session by session id.</p>","code":"BackendSessionService.prototype.kickBySid = function(frontendId, sid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'kickBySid';\n  var args = [sid];\n  rpcInvoke(this.app, frontendId, namespace, service, method, args, cb);\n};","params":[{"type":"param","types":["String"],"name":"frontendId","description":"cooperating frontend server id"},{"type":"param","types":["Number"],"name":"sid","description":"session id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"frontendId","description":"cooperating frontend server id"},{"type":"param","types":["Number"],"name":"sid","description":"session id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"","string":""},{"type":"memberOf","parent":"BackendSessionService"}],"module":false,"parent":"BackendSessionService","related":{"href":""},"has_related":true},{"id":"67-1387877793312","name":"kickByUid","signiture":"BackendSessionService.prototype.kickByUid()","type":"method","ctx":{"type":"method","constructor":"BackendSessionService","cons":"BackendSessionService","name":"kickByUid","string":"BackendSessionService.prototype.kickByUid()"},"description":{"full":"<p>Kick sessions by user id.</p>","summary":"<p>Kick sessions by user id.</p>","body":""},"full_description":"<p>Kick sessions by user id.</p>","code":"BackendSessionService.prototype.kickByUid = function(frontendId, uid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'kickByUid';\n  var args = [uid];\n  rpcInvoke(this.app, frontendId, namespace, service, method, args, cb);\n};","params":[{"type":"param","types":["String"],"name":"frontendId","description":"cooperating frontend server id"},{"type":"param","types":["Number","String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"frontendId","description":"cooperating frontend server id"},{"type":"param","types":["Number","String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"","string":""},{"type":"memberOf","parent":"BackendSessionService"}],"module":false,"parent":"BackendSessionService","related":{"href":""},"has_related":true}]},{"id":"68-1387877793312","name":"BackendSession","signiture":"BackendSession()","type":"function","ctx":{"type":"function","name":"BackendSession","string":"BackendSession()"},"description":{"full":"<p>BackendSession is the proxy for the frontend internal session passed to handlers and<br />it helps to keep the key/value pairs for the server locally.<br />Internal session locates in frontend server and should not be accessed directly.</p>\n\n<p>The mainly operation on backend session should be read and any changes happen in backend <br />session is local and would be discarded in next request. You have to push the<br />changes to the frontend manually if necessary. Any push would overwrite the last push<br />of the same key silently and the changes would be saw in next request.<br />And you have to make sure the transaction outside if you would push the session<br />concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>","summary":"<p>BackendSession is the proxy for the frontend internal session passed to handlers and<br />it helps to keep the key/value pairs for the server locally.<br />Internal session locates in frontend server and should not be accessed directly.</p>","body":"<p>The mainly operation on backend session should be read and any changes happen in backend <br />session is local and would be discarded in next request. You have to push the<br />changes to the frontend manually if necessary. Any push would overwrite the last push<br />of the same key silently and the changes would be saw in next request.<br />And you have to make sure the transaction outside if you would push the session<br />concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>"},"full_description":"<p>BackendSession is the proxy for the frontend internal session passed to handlers and it helps to keep the key/value pairs for the server locally. Internal session locates in frontend server and should not be accessed directly.</p>\n\n<p>The mainly operation on backend session should be read and any changes happen in backend  session is local and would be discarded in next request. You have to push the changes to the frontend manually if necessary. Any push would overwrite the last push of the same key silently and the changes would be saw in next request. And you have to make sure the transaction outside if you would push the session concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>","code":"var BackendSession = function(opts, service) {\n  EventEmitter.call(this);\n  for(var f in opts) {\n    this[f] = opts[f];\n  }\n  this.__sessionService__ = service;\n};\n\nutil.inherits(BackendSession, EventEmitter);","params":[],"has_params":false,"tags":[{"type":"class","string":""},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"69-1387877793312","name":"bind","signiture":"BackendSession.prototype.bind()","type":"method","ctx":{"type":"method","constructor":"BackendSession","cons":"BackendSession","name":"bind","string":"BackendSession.prototype.bind()"},"description":{"full":"<p>Bind current session with the user id. It would push the uid to frontend<br />server and bind  uid to the frontend internal session.</p>","summary":"<p>Bind current session with the user id. It would push the uid to frontend<br />server and bind  uid to the frontend internal session.</p>","body":""},"full_description":"<p>Bind current session with the user id. It would push the uid to frontend server and bind  uid to the frontend internal session.</p>","code":"BackendSession.prototype.bind = function(uid, cb) {\n  var self = this;\n  this.__sessionService__.bind(this.frontendId, this.id, uid, function(err) {\n    if(!err) {\n      self.uid = uid;\n    }\n    utils.invokeCallback(cb, err);\n  });\n};","params":[{"type":"param","types":["Number","String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Number","String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"","string":""},{"type":"memberOf","parent":"BackendSession"}],"module":false,"parent":"BackendSession","related":{"href":""},"has_related":true},{"id":"70-1387877793312","name":"unbind","signiture":"BackendSession.prototype.unbind()","type":"method","ctx":{"type":"method","constructor":"BackendSession","cons":"BackendSession","name":"unbind","string":"BackendSession.prototype.unbind()"},"description":{"full":"<p>Unbind current session with the user id. It would push the uid to frontend<br />server and unbind uid from the frontend internal session.</p>","summary":"<p>Unbind current session with the user id. It would push the uid to frontend<br />server and unbind uid from the frontend internal session.</p>","body":""},"full_description":"<p>Unbind current session with the user id. It would push the uid to frontend server and unbind uid from the frontend internal session.</p>","code":"BackendSession.prototype.unbind = function(uid, cb) {\n  var self = this;\n  this.__sessionService__.unbind(this.frontendId, this.id, uid, function(err) {\n    if(!err) {\n      self.uid = null;\n    }\n    utils.invokeCallback(cb, err);\n  });\n};","params":[{"type":"param","types":["Number","String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Number","String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"","string":""},{"type":"memberOf","parent":"BackendSession"}],"module":false,"parent":"BackendSession","related":{"href":""},"has_related":true},{"id":"71-1387877793312","name":"set","signiture":"BackendSession.prototype.set()","type":"method","ctx":{"type":"method","constructor":"BackendSession","cons":"BackendSession","name":"set","string":"BackendSession.prototype.set()"},"description":{"full":"<p>Set the key/value into backend session.</p>","summary":"<p>Set the key/value into backend session.</p>","body":""},"full_description":"<p>Set the key/value into backend session.</p>","code":"BackendSession.prototype.set = function(key, value) {\n  this.settings[key] = value;\n};","params":[{"type":"param","types":["String"],"name":"key","description":"key"},{"type":"param","types":["Object"],"name":"value","description":"value"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"key","description":"key"},{"type":"param","types":["Object"],"name":"value","description":"value"}],"module":false,"parent":"BackendSession","related":{"href":""},"has_related":true},{"id":"72-1387877793312","name":"get","signiture":"BackendSession.prototype.get()","type":"method","ctx":{"type":"method","constructor":"BackendSession","cons":"BackendSession","name":"get","string":"BackendSession.prototype.get()"},"description":{"full":"<p>Get the value from backend session by key.</p>","summary":"<p>Get the value from backend session by key.</p>","body":""},"full_description":"<p>Get the value from backend session by key.</p>","code":"BackendSession.prototype.get = function(key) {\n  return this.settings[key];\n};","params":[{"type":"param","types":["String"],"name":"key","description":"key"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"key","description":"key"},{"type":"return","types":["Object"],"description":"value"}],"module":false,"parent":"BackendSession","related":{"href":""},"has_related":true},{"id":"73-1387877793312","name":"push","signiture":"BackendSession.prototype.push()","type":"method","ctx":{"type":"method","constructor":"BackendSession","cons":"BackendSession","name":"push","string":"BackendSession.prototype.push()"},"description":{"full":"<p>Push the key/value in backend session to the front internal session.</p>","summary":"<p>Push the key/value in backend session to the front internal session.</p>","body":""},"full_description":"<p>Push the key/value in backend session to the front internal session.</p>","code":"BackendSession.prototype.push = function(key, cb) {\n  this.__sessionService__.push(this.frontendId, this.id, key, this.get(key), cb);\n};","params":[{"type":"param","types":["String"],"name":"key","description":"key"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"key","description":"key"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"module":false,"parent":"BackendSession","related":{"href":""},"has_related":true},{"id":"74-1387877793312","name":"pushAll","signiture":"BackendSession.prototype.pushAll()","type":"method","ctx":{"type":"method","constructor":"BackendSession","cons":"BackendSession","name":"pushAll","string":"BackendSession.prototype.pushAll()"},"description":{"full":"<p>Push all the key/values in backend session to the frontend internal session.</p>","summary":"<p>Push all the key/values in backend session to the frontend internal session.</p>","body":""},"full_description":"<p>Push all the key/values in backend session to the frontend internal session.</p>","code":"BackendSession.prototype.pushAll = function(cb) {\n  this.__sessionService__.pushAll(this.frontendId, this.id, this.settings, cb);\n};","params":[{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"module":false,"parent":"BackendSession","related":{"href":""},"has_related":true}]},{"id":"76-1387877793312","name":"ChannelService","signiture":"ChannelService()","type":"function","ctx":{"type":"function","name":"ChannelService","string":"ChannelService()"},"description":{"full":"<p>Create and maintain channels for server local.</p>\n\n<p>ChannelService is created by channel component which is a default loaded<br />component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>","summary":"<p>Create and maintain channels for server local.</p>","body":"<p>ChannelService is created by channel component which is a default loaded<br />component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>"},"full_description":"<p>Create and maintain channels for server local.</p>\n\n<p>ChannelService is created by channel component which is a default loaded component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>","code":"var ChannelService = function(app, opts) {\n  opts = opts || {};\n  this.app = app;\n  this.channels = {};\n  this.broadcastFilter = opts.broadcastFilter;\n};\n\nmodule.exports = ChannelService;","params":[],"has_params":false,"tags":[{"type":"class","string":""},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"77-1387877793312","name":"createChannel","signiture":"ChannelService.prototype.createChannel()","type":"method","ctx":{"type":"method","constructor":"ChannelService","cons":"ChannelService","name":"createChannel","string":"ChannelService.prototype.createChannel()"},"description":{"full":"<p>Create channel with name.</p>","summary":"<p>Create channel with name.</p>","body":""},"full_description":"<p>Create channel with name.</p>","code":"ChannelService.prototype.createChannel = function(name) {\n  if(this.channels[name]) {\n    return this.channels[name];\n  }\n\n  var c = new Channel(name, this);\n  this.channels[name] = c;\n  return c;\n};","params":[{"type":"param","types":["String"],"name":"name","description":"channel's name"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"channel's name"},{"type":"memberOf","parent":"ChannelService"}],"module":false,"parent":"ChannelService","related":{"href":""},"has_related":true},{"id":"78-1387877793312","name":"getChannel","signiture":"ChannelService.prototype.getChannel()","type":"method","ctx":{"type":"method","constructor":"ChannelService","cons":"ChannelService","name":"getChannel","string":"ChannelService.prototype.getChannel()"},"description":{"full":"<p>Get channel by name.</p>","summary":"<p>Get channel by name.</p>","body":""},"full_description":"<p>Get channel by name.</p>","code":"ChannelService.prototype.getChannel = function(name, create) {\n  var channel = this.channels[name];\n  if(!channel && !!create) {\n    channel = this.channels[name] = new Channel(name, this);\n  }\n  return channel;\n};","params":[{"type":"param","types":["String"],"name":"name","description":"channel's name"},{"type":"param","types":["Boolean"],"name":"create","description":"if true, create channel"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"channel's name"},{"type":"param","types":["Boolean"],"name":"create","description":"if true, create channel"},{"type":"return","types":["Channel"],"description":""},{"type":"memberOf","parent":"ChannelService"}],"module":false,"parent":"ChannelService","related":{"href":""},"has_related":true},{"id":"79-1387877793312","name":"destroyChannel","signiture":"ChannelService.prototype.destroyChannel()","type":"method","ctx":{"type":"method","constructor":"ChannelService","cons":"ChannelService","name":"destroyChannel","string":"ChannelService.prototype.destroyChannel()"},"description":{"full":"<p>Destroy channel by name.</p>","summary":"<p>Destroy channel by name.</p>","body":""},"full_description":"<p>Destroy channel by name.</p>","code":"ChannelService.prototype.destroyChannel = function(name) {\n  delete this.channels[name];\n};","params":[{"type":"param","types":["String"],"name":"name","description":"channel name"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"channel name"},{"type":"memberOf","parent":"ChannelService"}],"module":false,"parent":"ChannelService","related":{"href":""},"has_related":true},{"id":"80-1387877793312","name":"pushMessageByUids","signiture":"ChannelService.prototype.pushMessageByUids()","type":"method","ctx":{"type":"method","constructor":"ChannelService","cons":"ChannelService","name":"pushMessageByUids","string":"ChannelService.prototype.pushMessageByUids()"},"description":{"full":"<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>","summary":"<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>","body":""},"full_description":"<p>Push message by uids. Group the uids by group. ignore any uid if sid not specified.</p>","code":"ChannelService.prototype.pushMessageByUids = function(route, msg, uids, opts, cb) {\n  if(typeof route !== 'string') {\n    cb = opts;\n    opts = uids;\n    uids = msg;\n    msg = route;\n    route = msg.route;\n  }\n\n  if(!cb && typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  if(!uids || uids.length === 0) {\n    utils.invokeCallback(cb, new Error('uids should not be empty'));\n    return;\n  }\n  var groups = {}, record;\n  for(var i=0, l=uids.length; i<l; i++) {\n    record = uids[i];\n    add(record.uid, record.sid, groups);\n  }\n\n  sendMessageByGroup(this, route, msg, groups, opts, cb);\n};","params":[{"type":"param","types":["String"],"name":"route","description":"message route"},{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Array"],"name":"uids","description":"the receiver info list, [{uid: userId, sid: frontendServerId}]"},{"type":"param","types":["Object"],"name":"opts","description":"user-defined push options, optional "},{"type":"param","types":["Function"],"name":"cb","description":"cb(err)"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"route","description":"message route"},{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Array"],"name":"uids","description":"the receiver info list, [{uid: userId, sid: frontendServerId}]"},{"type":"param","types":["Object"],"name":"opts","description":"user-defined push options, optional "},{"type":"param","types":["Function"],"name":"cb","description":"cb(err)"},{"type":"memberOf","parent":"ChannelService"}],"module":false,"parent":"ChannelService","related":{"href":""},"has_related":true},{"id":"81-1387877793312","name":"broadcast","signiture":"ChannelService.prototype.broadcast()","type":"method","ctx":{"type":"method","constructor":"ChannelService","cons":"ChannelService","name":"broadcast","string":"ChannelService.prototype.broadcast()"},"description":{"full":"<p>Broadcast message to all the connected clients.</p>","summary":"<p>Broadcast message to all the connected clients.</p>","body":""},"full_description":"<p>Broadcast message to all the connected clients.</p>","code":"ChannelService.prototype.broadcast = function(stype, route, msg, opts, cb) {\n  var app = this.app;\n  var namespace = 'sys';\n  var service = 'channelRemote';\n  var method = 'broadcast';\n  var servers = app.getServersByType(stype);\n\n  if(!servers || servers.length === 0) {\n    // server list is empty\n    utils.invokeCallback(cb);\n    return;\n  }\n\n  var count = servers.length;\n  var successFlag = false;\n\n  var latch = countDownLatch.createCountDownLatch(count, function() {\n    if(!successFlag) {\n      utils.invokeCallback(cb, new Error('broadcast fails'));\n      return;\n    }\n    utils.invokeCallback(cb, null);\n  });\n\n  var genCB = function() {\n    return function(err) {\n      if(err) {\n        logger.error('[broadcast] fail to push message, err:' + err.stack);\n        latch.done();\n        return;\n      }\n      successFlag = true;\n      latch.done();\n    };\n  };\n\n  opts = {type: 'broadcast', userOptions: opts || {}};\n\n  // for compatiblity \n  opts.isBroadcast = true;\n  if(opts.userOptions) {\n    opts.binded = opts.userOptions.binded;\n    opts.filterParam = opts.userOptions.filterParam;\n  }\n\n  for(var i=0, l=count; i<l; i++) {\n    app.rpcInvoke(servers[i].id, {namespace: namespace, service: service,\n      method: method, args: [route, msg, opts]}, genCB());\n  }\n};","params":[{"type":"param","types":["String"],"name":"stype","description":"frontend server type string"},{"type":"param","types":["String"],"name":"route","description":"route string"},{"type":"param","types":["Object"],"name":"msg","description":"message"},{"type":"param","types":["Object"],"name":"opts","description":"user-defined broadcast options, optional"},{"type":"param","types":["Function"],"name":"cb","description":"callback"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"stype","description":"frontend server type string"},{"type":"param","types":["String"],"name":"route","description":"route string"},{"type":"param","types":["Object"],"name":"msg","description":"message"},{"type":"param","types":["Object"],"name":"opts","description":"user-defined broadcast options, optional"},{"type":"","string":"opts.binded: push to binded sessions or all the sessions"},{"type":"","string":"opts.filterParam: parameters for broadcast filter."},{"type":"param","types":["Function"],"name":"cb","description":"callback"},{"type":"memberOf","parent":"ChannelService"}],"module":false,"parent":"ChannelService","related":{"href":""},"has_related":true}]},{"id":"82-1387877793312","name":"Channel","signiture":"Channel()","type":"function","ctx":{"type":"function","name":"Channel","string":"Channel()"},"description":{"full":"<p>Channel maintains the receiver collection for a subject. You can<br />add users into a channel and then broadcast message to them by channel.</p>","summary":"<p>Channel maintains the receiver collection for a subject. You can<br />add users into a channel and then broadcast message to them by channel.</p>","body":""},"full_description":"<p>Channel maintains the receiver collection for a subject. You can add users into a channel and then broadcast message to them by channel.</p>","code":"var Channel = function(name, service) {\n  this.name = name;\n  this.groups = {};       // group map for uids. key: sid, value: [uid]\n  this.records = {};      // member records. key: uid\n  this.__channelService__ = service;\n  this.state = ST_INITED;\n};","params":[],"has_params":false,"tags":[{"type":"class","string":"channel"},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"83-1387877793312","name":"add","signiture":"Channel.prototype.add()","type":"method","ctx":{"type":"method","constructor":"Channel","cons":"Channel","name":"add","string":"Channel.prototype.add()"},"description":{"full":"<p>Add user to channel.</p>","summary":"<p>Add user to channel.</p>","body":""},"full_description":"<p>Add user to channel.</p>","code":"Channel.prototype.add = function(uid, sid) {\n  if(this.state > ST_INITED) {\n    return false;\n  } else {\n    var res = add(uid, sid, this.groups);\n    if(res) {\n      this.records[uid] = {sid: sid, uid: uid};\n    }\n    return res;\n  }\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true},{"id":"84-1387877793312","name":"leave","signiture":"Channel.prototype.leave()","type":"method","ctx":{"type":"method","constructor":"Channel","cons":"Channel","name":"leave","string":"Channel.prototype.leave()"},"description":{"full":"<p>Remove user from channel.</p>","summary":"<p>Remove user from channel.</p>","body":""},"full_description":"<p>Remove user from channel.</p>","code":"Channel.prototype.leave = function(uid, sid) {\n  if(!uid || !sid) {\n    return false;\n  }\n  delete this.records[uid];\n  var res = deleteFrom(uid, sid, this.groups[sid]);\n  if(this.groups[sid] && this.groups[sid].length === 0) {\n    delete this.groups[sid];\n  }\n  return res;\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to."}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to."},{"type":"return","types":["[Boolean]"],"description":"true if success or false if fail"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true},{"id":"85-1387877793312","name":"getMembers","signiture":"Channel.prototype.getMembers()","type":"method","ctx":{"type":"method","constructor":"Channel","cons":"Channel","name":"getMembers","string":"Channel.prototype.getMembers()"},"description":{"full":"<p>Get channel members.</p>\n\n<p><b>Notice:</b> Heavy operation.</p>","summary":"<p>Get channel members.</p>","body":"<p><b>Notice:</b> Heavy operation.</p>"},"full_description":"<p>Get channel members.</p>\n\n<p><b>Notice:</b> Heavy operation.</p>","code":"Channel.prototype.getMembers = function() {\n  var res = [], groups = this.groups;\n  var group, i, l;\n  for(var sid in groups) {\n    group = groups[sid];\n    for(i=0, l=group.length; i<l; i++) {\n      res.push(group[i]);\n    }\n  }\n  return res;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Array"],"description":"channel member uid list"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true},{"id":"86-1387877793312","name":"getMember","signiture":"Channel.prototype.getMember()","type":"method","ctx":{"type":"method","constructor":"Channel","cons":"Channel","name":"getMember","string":"Channel.prototype.getMember()"},"description":{"full":"<p>Get Member info.</p>","summary":"<p>Get Member info.</p>","body":""},"full_description":"<p>Get Member info.</p>","code":"Channel.prototype.getMember = function(uid) {\n  return this.records[uid];\n};","params":[{"type":"param","types":["String"],"name":"uid","description":"user id"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"uid","description":"user id"},{"type":"return","types":["Object"],"description":"member info"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true},{"id":"87-1387877793312","name":"destroy","signiture":"Channel.prototype.destroy()","type":"method","ctx":{"type":"method","constructor":"Channel","cons":"Channel","name":"destroy","string":"Channel.prototype.destroy()"},"description":{"full":"<p>Destroy channel.</p>","summary":"<p>Destroy channel.</p>","body":""},"full_description":"<p>Destroy channel.</p>","code":"Channel.prototype.destroy = function() {\n  this.state = ST_DESTROYED;\n  this.__channelService__.destroyChannel(this.name);\n};","params":[],"has_params":false,"tags":[],"module":false,"parent":"Channel","has_related":false},{"id":"88-1387877793312","name":"pushMessage","signiture":"Channel.prototype.pushMessage()","type":"method","ctx":{"type":"method","constructor":"Channel","cons":"Channel","name":"pushMessage","string":"Channel.prototype.pushMessage()"},"description":{"full":"<p>Push message to all the members in the channel</p>","summary":"<p>Push message to all the members in the channel</p>","body":""},"full_description":"<p>Push message to all the members in the channel</p>","code":"Channel.prototype.pushMessage = function(route, msg, opts, cb) {\n  if(this.state !== ST_INITED) {\n    utils.invokeCallback(new Error('channel is not running now'));\n    return;\n  }\n\n  if(typeof route !== 'string') {\n    cb = opts;\n    opts = msg;\n    msg = route;\n    route = msg.route;\n  }\n\n  if(!cb && typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  sendMessageByGroup(this.__channelService__, route, msg, this.groups, opts, cb);\n};","params":[{"type":"param","types":["String"],"name":"route","description":"message route"},{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Object"],"name":"opts","description":"user-defined push options, optional"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"route","description":"message route"},{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Object"],"name":"opts","description":"user-defined push options, optional"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true}]},{"id":"106-1387877793312","name":"SessionService","signiture":"SessionService()","type":"function","ctx":{"type":"function","name":"SessionService","string":"SessionService()"},"description":{"full":"<p>Session service maintains the internal session for each client connection.</p>\n\n<p>Session service is created by session component and is only<br /><b>available</b> in frontend servers. You can access the service by<br /><code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>","summary":"<p>Session service maintains the internal session for each client connection.</p>","body":"<p>Session service is created by session component and is only<br /><b>available</b> in frontend servers. You can access the service by<br /><code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>"},"full_description":"<p>Session service maintains the internal session for each client connection.</p>\n\n<p>Session service is created by session component and is only <b>available</b> in frontend servers. You can access the service by <code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>","code":"var SessionService = function(opts) {\n  opts = opts || {};\n  this.singleSession = opts.singleSession;\n  this.sessions = {};     // sid -> session\n  this.uidMap = {};       // uid -> sessions\n};\n\nmodule.exports = SessionService;","params":[{"type":"param","types":["Object"],"name":"opts","description":"constructor parameters"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"opts","description":"constructor parameters"},{"type":"class","string":""},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"107-1387877793312","name":"kick","signiture":"SessionService.prototype.kick()","type":"method","ctx":{"type":"method","constructor":"SessionService","cons":"SessionService","name":"kick","string":"SessionService.prototype.kick()"},"description":{"full":"<p>Kick all the session offline under the user id.</p>","summary":"<p>Kick all the session offline under the user id.</p>","body":""},"full_description":"<p>Kick all the session offline under the user id.</p>","code":"SessionService.prototype.kick = function(uid, reason, cb) {\n  // compatible for old kick(uid, cb);\n  if(typeof reason === 'function') {\n    cb = reason;\n    reason = 'kick';\n  }\n  var sessions = this.getByUid(uid);\n\n  if(sessions) {\n    // notify client\n    for(var i=0, l=sessions.length; i<l; i++) {\n      sessions[i].closed(reason);\n    }\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  } else {\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  }\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"user id asscociated with the session"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"user id asscociated with the session"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"","string":""},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true},{"id":"108-1387877793312","name":"kickBySessionId","signiture":"SessionService.prototype.kickBySessionId()","type":"method","ctx":{"type":"method","constructor":"SessionService","cons":"SessionService","name":"kickBySessionId","string":"SessionService.prototype.kickBySessionId()"},"description":{"full":"<p>Kick a user offline by session id.</p>","summary":"<p>Kick a user offline by session id.</p>","body":""},"full_description":"<p>Kick a user offline by session id.</p>","code":"SessionService.prototype.kickBySessionId = function(sid, cb) {\n  var session = this.get(sid);\n\n  if(session) {\n    // notify client\n    session.closed('kick');\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  } else {\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  }\n};","params":[{"type":"param","types":["Number"],"name":"sid","description":"session id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"sid","description":"session id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"","string":""},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true}]},{"id":"214-1387877793314","name":"Pomelo","signiture":"Pomelo","type":"declaration","ctx":{"type":"declaration","name":"Pomelo","value":"module.exports = {}","string":"Pomelo"},"description":{"full":"<p>Expose <code>createApplication()</code>.</p>","summary":"<p>Expose <code>createApplication()</code>.</p>","body":""},"full_description":"<p>Expose <code>createApplication()</code>.</p>","code":"var Pomelo = module.exports = {};","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"222-1387877793314","name":"createApp","signiture":"Pomelo.createApp()","type":"method","ctx":{"type":"method","receiver":"Pomelo","name":"createApp","string":"Pomelo.createApp()"},"description":{"full":"<p>Create an pomelo application.</p>","summary":"<p>Create an pomelo application.</p>","body":""},"full_description":"<p>Create an pomelo application.</p>","code":"Pomelo.createApp = function (opts) {\n  var app = application;\n  app.init(opts);\n  self.app = app;\n  return app;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Application"],"description":""},{"type":"memberOf","parent":"Pomelo"},{"type":"api","visibility":"public"}],"module":false,"parent":"Pomelo","related":{"href":""},"has_related":true}]}]
    </script>
    <!-- Array，String，Object扩展函数（因为IE9-不支持，而Lunr有使用到) -->
    <script src="./pomelo API_files/extend.js.下载"></script>
    <!-- 将原来引用网上的jquery转为引用本地的 -->
    <script src="./pomelo API_files/jquery-1.6.4-min.js.下载"></script>
    <!-- 将Lunr和页面逻辑整合一起放在lunr.js文件 -->
    <script src="./pomelo API_files/lunr.js.下载"></script>
  </head>
  <body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="./pomelo API_files/timestamp.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./pomelo API_files/graph-calc.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./pomelo API_files/auto-complete.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./pomelo API_files/toolbar.js.下载" charset="utf-8"></script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
.wb-autocomplete-suggestions {
    text-align: left; cursor: default; border: 1px solid #ccc; border-top: 0; background: #fff; box-shadow: -1px 1px 3px rgba(0,0,0,.1);
    position: absolute; display: none; z-index: 2147483647; max-height: 254px; overflow: hidden; overflow-y: auto; box-sizing: border-box;
}
.wb-autocomplete-suggestion { position: relative; padding: 0 .6em; line-height: 23px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 1.02em; color: #333; }
.wb-autocomplete-suggestion b { font-weight: bold; }
.wb-autocomplete-suggestion.selected { background: #f0f0f0; }
</style>
<div id="wm-ipp-base" lang="en" style="display: block; direction: ltr;">
</div><script type="text/javascript">
__wm.bt(600,27,25,2,"web","http://pomelo.netease.com/api.html","2017-05-21",1996,"/static/",['css/banner-styles.css','css/iconochive.css']);
</script><div class="wb-autocomplete-suggestions "></div>
<!-- END WAYBACK TOOLBAR INSERT -->
    <!-- 顶栏 -->
    <div class="g-bar">
      <!-- 顶栏github模块 -->
      <div class="m-github">
          <span class="title">gitHub:</span><a class="link" target="_blank" href="https://github.com/NetEase/pomelo">http://github.com/NetEase/pomelo</a>
      </div>
    </div>
    <!-- 头部 -->
    <div class="g-hd">
      <div class="m-hdnav">
        	<div class="bg">
         	<div class="wrap">
          		<ul class="cnt">
                  	  <li><a href="./index.html">Home</a></li>
                      <li class="current"><a href="./api.html">Api</a></li>
                      <li><a href="./doc9.html">0.9新增</a></li>
                      <li><a href="./doc10.html">0.10新增</a></li>
                	</ul>	
         	 	</div>
          </div>
          <div class="logo"><a href="https://github.com/NetEase/pomelo"><div class="img"></div></a></div>
      </div>
    </div>
    <!-- 整体居中 -->
    <div class="g-doc">
      <!-- 主体 -->
      <div class="g-bd">
        <!-- API主体 -->
        <div class="m-wrap">
          <!-- API -->
          <div class="main">
            <div class="maintt">
              <h1> pomelo<span class="version">0.8.0</span></h1>
            </div>
      
            
              <div class="cls" id="Application">
                <div class="clstt">
                  <h2>Application</h2>
                </div>
      
                <div class="clsdes">
                  <p>Application prototype.</p>
                </div>
      
                
                  <div class="method" id="Application_getBase">
                    <div class="methodtt">
                      <h3>getBase</h3>
                      <h4>Application.getBase()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get application base path</p>

<p>// cwd: /home/game/  pomelo start  // app.getBase() -&gt; /home/game</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getBase&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.get(<span class="class">Constants</span>.<span class="class">Reserved</span>.<span class="class">BASE</span>);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_filter">
                    <div class="methodtt">
                      <h3>filter</h3>
                      <h4>Application.filter()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>filter - provide before and after filter method.</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>add a filter to before and after filter</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.filter&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(filter)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.before(filter);<br>&nbsp;&nbsp;<span class="keyword">this</span>.after(filter);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_before">
                    <div class="methodtt">
                      <h3>before</h3>
                      <h4>Application.before()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>bf - before fileter, bf(msg, session, next)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add before filter.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.before&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(bf)&nbsp;{<br>&nbsp;&nbsp;addFilter(<span class="keyword">this</span>,&nbsp;<span class="class">Constants</span>.<span class="class">KeyWords</span>.BEFORE_FILTER,&nbsp;bf);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_after">
                    <div class="methodtt">
                      <h3>after</h3>
                      <h4>Application.after()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>af - after filter, `af(err, msg, session, resp, next)`</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add after filter.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.after&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(af)&nbsp;{<br>&nbsp;&nbsp;addFilter(<span class="keyword">this</span>,&nbsp;<span class="class">Constants</span>.<span class="class">KeyWords</span>.AFTER_FILTER,&nbsp;af);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_globalFilter">
                    <div class="methodtt">
                      <h3>globalFilter</h3>
                      <h4>Application.globalFilter()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>filter - provide before and after filter method.</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>add a global filter to before and after global filter</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.globalFilter&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(filter)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.globalBefore(filter);<br>&nbsp;&nbsp;<span class="keyword">this</span>.globalAfter(filter);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_globalBefore">
                    <div class="methodtt">
                      <h3>globalBefore</h3>
                      <h4>Application.globalBefore()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>bf - before fileter, bf(msg, session, next)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add global before filter.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.globalBefore&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(bf)&nbsp;{<br>&nbsp;&nbsp;addFilter(<span class="keyword">this</span>,&nbsp;<span class="class">Constants</span>.<span class="class">KeyWords</span>.GLOBAL_BEFORE_FILTER,&nbsp;bf);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_globalAfter">
                    <div class="methodtt">
                      <h3>globalAfter</h3>
                      <h4>Application.globalAfter()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>af - after filter, `af(err, msg, session, resp, next)`</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add global after filter.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.globalAfter&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(af)&nbsp;{<br>&nbsp;&nbsp;addFilter(<span class="keyword">this</span>,&nbsp;<span class="class">Constants</span>.<span class="class">KeyWords</span>.GLOBAL_AFTER_FILTER,&nbsp;af);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_rpcBefore">
                    <div class="methodtt">
                      <h3>rpcBefore</h3>
                      <h4>Application.rpcBefore()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>bf - before fileter, bf(serverId, msg, opts, next)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add rpc before filter.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.rpcBefore&nbsp;=&nbsp;<span class="keyword">function</span>(bf)&nbsp;{<br>&nbsp;&nbsp;addFilter(<span class="keyword">this</span>,&nbsp;<span class="class">Constants</span>.<span class="class">KeyWords</span>.RPC_BEFORE_FILTER,&nbsp;bf);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_rpcAfter">
                    <div class="methodtt">
                      <h3>rpcAfter</h3>
                      <h4>Application.rpcAfter()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>af - after filter, `af(serverId, msg, opts, next)`</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add rpc after filter.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.rpcAfter&nbsp;=&nbsp;<span class="keyword">function</span>(af)&nbsp;{<br>&nbsp;&nbsp;addFilter(<span class="keyword">this</span>,&nbsp;<span class="class">Constants</span>.<span class="class">KeyWords</span>.RPC_AFTER_FILTER,&nbsp;af);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_rpcFilter">
                    <div class="methodtt">
                      <h3>rpcFilter</h3>
                      <h4>Application.rpcFilter()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>filter - provide before and after filter method.</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>add a rpc filter to before and after rpc filter</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.rpcFilter&nbsp;=&nbsp;<span class="keyword">function</span>(filter)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.rpcBefore(filter);<br>&nbsp;&nbsp;<span class="keyword">this</span>.rpcAfter(filter);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_load">
                    <div class="methodtt">
                      <h3>load</h3>
                      <h4>Application.load()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - (optional) name of the component</li>
                        
                          <li>component - component instance or factory function of the component</li>
                        
                          <li>opts - (optional) construct parameters for the factory function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Load component</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.load&nbsp;=&nbsp;<span class="keyword">function</span>(name,&nbsp;component,&nbsp;opts)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;name&nbsp;!==&nbsp;<span class="string">'string'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;opts&nbsp;=&nbsp;component;<br>&nbsp;&nbsp;&nbsp;&nbsp;component&nbsp;=&nbsp;name;<br>&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;<span class="keyword">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;component.name&nbsp;===&nbsp;<span class="string">'string'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;component.name;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;component&nbsp;===&nbsp;<span class="string">'function'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;component&nbsp;=&nbsp;component(<span class="keyword">this</span>,&nbsp;opts);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(!name&nbsp;&amp;&amp;&nbsp;<span class="keyword">typeof</span>&nbsp;component.name&nbsp;===&nbsp;<span class="string">'string'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;component.name;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(name&nbsp;&amp;&amp;&nbsp;<span class="keyword">this</span>.components[name])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// ignore duplicat component</span><br>&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(<span class="string">'ignore duplicate component: %j'</span>,&nbsp;name);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">this</span>.loaded.push(component);<br>&nbsp;&nbsp;<span class="keyword">if</span>(name)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// components with a name would get by name throught app.components later.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.components[name]&nbsp;=&nbsp;component;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_loadConfig">
                    <div class="methodtt">
                      <h3>loadConfig</h3>
                      <h4>Application.loadConfig()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>key - environment key</li>
                        
                          <li>val - environment value</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Load Configure json file to settings.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.loadConfig&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(key,&nbsp;val)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;env&nbsp;=&nbsp;<span class="keyword">this</span>.get(<span class="class">Constants</span>.<span class="class">Reserved</span>.<span class="class">ENV</span>);<br>&nbsp;&nbsp;val&nbsp;=&nbsp;require(val);<br>&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(val[env])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;val[env];<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">this</span>.set(key,&nbsp;val);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_route">
                    <div class="methodtt">
                      <h3>route</h3>
                      <h4>Application.route()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>serverType - server type string</li>
                        
                          <li>routeFunc - route function. routeFunc(session, msg, app, cb)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Set the route function for the specified server type.</p>

<p>Examples:</p>

<p>app.route('area', routeFunc);</p>

<p>var routeFunc = function(session, msg, app, cb) {    // all request to area would be route to the first area server    var areas = app.getServersByType('area');    cb(null, areas[0].id);  };</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.route&nbsp;=&nbsp;<span class="keyword">function</span>(serverType,&nbsp;routeFunc)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;routes&nbsp;=&nbsp;<span class="keyword">this</span>.get(<span class="class">Constants</span>.<span class="class">KeyWords</span>.<span class="class">ROUTE</span>);<br>&nbsp;&nbsp;<span class="keyword">if</span>(!routes)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;routes&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.set(<span class="class">Constants</span>.<span class="class">KeyWords</span>.<span class="class">ROUTE</span>,&nbsp;routes);<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;routes[serverType]&nbsp;=&nbsp;routeFunc;<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_beforeStopHook">
                    <div class="methodtt">
                      <h3>beforeStopHook</h3>
                      <h4>Application.beforeStopHook()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>fun - before close function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Set before stop function. It would perform before servers stop.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.beforeStopHook&nbsp;=&nbsp;<span class="keyword">function</span>(fun)&nbsp;{<br>&nbsp;&nbsp;logger.warn(<span class="string">'this method was deprecated in pomelo 0.8'</span>);<br>&nbsp;&nbsp;<span class="keyword">if</span>(!!fun&nbsp;&amp;&amp;&nbsp;<span class="keyword">typeof</span>&nbsp;fun&nbsp;===&nbsp;<span class="string">'function'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.set(<span class="class">Constants</span>.<span class="class">KeyWords</span>.BEFORE_STOP_HOOK,&nbsp;fun);<br>&nbsp;&nbsp;}<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_start">
                    <div class="methodtt">
                      <h3>start</h3>
                      <h4>Application.start()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Start application. It would load the default components and start all the loaded components.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.start&nbsp;=&nbsp;<span class="keyword">function</span>(cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.startTime&nbsp;=&nbsp;<span class="class">Date</span>.now();<br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">this</span>.state&nbsp;&gt;&nbsp;STATE_INITED)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb,&nbsp;<span class="keyword">new</span>&nbsp;<span class="class">Error</span>(<span class="string">'application has already start.'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;appUtil.loadDefaultComponents(<span class="keyword">this</span>);<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;self&nbsp;=&nbsp;<span class="keyword">this</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;startUp&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;appUtil.optComponents(self.loaded,&nbsp;<span class="class">Constants</span>.<span class="class">Reserved</span>.<span class="class">START</span>,&nbsp;<span class="keyword">function</span>(err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.state&nbsp;=&nbsp;STATE_START;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb,&nbsp;err);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span class="string">'%j enter after start...'</span>,&nbsp;self.getServerId());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.afterStart(cb);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;};<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;beforeFun&nbsp;=&nbsp;<span class="keyword">this</span>.lifecycleCbs[<span class="class">Constants</span>.<span class="class">LIFECYCLE</span>.BEFORE_STARTUP];<br>&nbsp;&nbsp;<span class="keyword">if</span>(!!beforeFun)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;beforeFun.call(<span class="keyword">null</span>,&nbsp;<span class="keyword">this</span>,&nbsp;startUp);<br>&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;startUp();<br>&nbsp;&nbsp;}<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_set">
                    <div class="methodtt">
                      <h3>set</h3>
                      <h4>Application.set()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - the setting of application</li>
                        
                          <li>val - the setting's value</li>
                        
                          <li>attach - whether attach the settings to application</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>

<p>Example:</p>

<p>app.set('key1', 'value1');  app.get('key1');  // 'value1'  app.key1;         // undefined</p>

<p>app.set('key2', 'value2', true);  app.get('key2');  // 'value2'  app.key2;         // 'value2'</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.set&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(setting,&nbsp;val,&nbsp;attach)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(arguments.length&nbsp;===&nbsp;<span class="number">1</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.settings[setting];<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">this</span>.settings[setting]&nbsp;=&nbsp;val;<br>&nbsp;&nbsp;<span class="keyword">if</span>(attach)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>[setting]&nbsp;=&nbsp;val;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_get">
                    <div class="methodtt">
                      <h3>get</h3>
                      <h4>Application.get()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get property from setting</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.get&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(setting)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.settings[setting];<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_enabled">
                    <div class="methodtt">
                      <h3>enabled</h3>
                      <h4>Application.enabled()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Check if <code>setting</code> is enabled.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.enabled&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(setting)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;!!<span class="keyword">this</span>.get(setting);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_disabled">
                    <div class="methodtt">
                      <h3>disabled</h3>
                      <h4>Application.disabled()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Check if <code>setting</code> is disabled.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.disabled&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(setting)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;!<span class="keyword">this</span>.get(setting);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_enable">
                    <div class="methodtt">
                      <h3>enable</h3>
                      <h4>Application.enable()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Enable <code>setting</code>.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.enable&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(setting)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.set(setting,&nbsp;<span class="keyword">true</span>);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_disable">
                    <div class="methodtt">
                      <h3>disable</h3>
                      <h4>Application.disable()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Disable <code>setting</code>.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.disable&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(setting)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.set(setting,&nbsp;<span class="keyword">false</span>);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_configure">
                    <div class="methodtt">
                      <h3>configure</h3>
                      <h4>Application.configure()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>env - application environment</li>
                        
                          <li>fn - callback function</li>
                        
                          <li>type - server type</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Configure callback for the specified env and server type. When no env is specified that callback will be invoked for all environments and when no type is specified that callback will be invoked for all server types.</p>

<p>Examples:</p>

<p>app.configure(function(){    // executed for all envs and server types  });</p>

<p>app.configure('development', function(){    // executed development env  });</p>

<p>app.configure('development', 'connector', function(){    // executed for development env and connector server type  });</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.configure&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(env,&nbsp;type,&nbsp;fn)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;args&nbsp;=&nbsp;[].slice.call(arguments);<br>&nbsp;&nbsp;fn&nbsp;=&nbsp;args.pop();<br>&nbsp;&nbsp;env&nbsp;=&nbsp;type&nbsp;=&nbsp;<span class="class">Constants</span>.<span class="class">Reserved</span>.<span class="class">ALL</span>;<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(args.length&nbsp;&gt;&nbsp;<span class="number">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;env&nbsp;=&nbsp;args[<span class="number">0</span>];<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">if</span>(args.length&nbsp;&gt;&nbsp;<span class="number">1</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;args[<span class="number">1</span>];<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(env&nbsp;===&nbsp;<span class="class">Constants</span>.<span class="class">Reserved</span>.<span class="class">ALL</span>&nbsp;||&nbsp;contains(<span class="keyword">this</span>.settings.env,&nbsp;env))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(type&nbsp;===&nbsp;<span class="class">Constants</span>.<span class="class">Reserved</span>.<span class="class">ALL</span>&nbsp;||&nbsp;contains(<span class="keyword">this</span>.settings.serverType,&nbsp;type))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fn.call(<span class="keyword">this</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_registerAdmin">
                    <div class="methodtt">
                      <h3>registerAdmin</h3>
                      <h4>Application.registerAdmin()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>module - (optional) module id or provoided by module.moduleId</li>
                        
                          <li>module - module object or factory function for module</li>
                        
                          <li>opts - construct parameter for module</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Register admin modules. Admin modules is the extends point of the monitor system.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.registerAdmin&nbsp;=&nbsp;<span class="keyword">function</span>(moduleId,&nbsp;module,&nbsp;opts)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;modules&nbsp;=&nbsp;<span class="keyword">this</span>.get(<span class="class">Constants</span>.<span class="class">KeyWords</span>.<span class="class">MODULE</span>);<br>&nbsp;&nbsp;<span class="keyword">if</span>(!modules)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;modules&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.set(<span class="class">Constants</span>.<span class="class">KeyWords</span>.<span class="class">MODULE</span>,&nbsp;modules);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;moduleId&nbsp;!==&nbsp;<span class="string">'string'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;opts&nbsp;=&nbsp;module;<br>&nbsp;&nbsp;&nbsp;&nbsp;module&nbsp;=&nbsp;moduleId;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(module)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleId&nbsp;=&nbsp;module.moduleId;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(!moduleId){<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;modules[moduleId]&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;moduleId:&nbsp;moduleId,<br>&nbsp;&nbsp;&nbsp;&nbsp;module:&nbsp;module,<br>&nbsp;&nbsp;&nbsp;&nbsp;opts:&nbsp;opts<br>&nbsp;&nbsp;};<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_use">
                    <div class="methodtt">
                      <h3>use</h3>
                      <h4>Application.use()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>plugin - plugin instance</li>
                        
                          <li>opts - (optional) construct parameters for the factory function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Use plugin.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.use&nbsp;=&nbsp;<span class="keyword">function</span>(plugin,&nbsp;opts)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!plugin.components)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">'invalid components, no components exist'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;self&nbsp;=&nbsp;<span class="keyword">this</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;dir&nbsp;=&nbsp;path.dirname(plugin.components);<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(!fs.existsSync(plugin.components))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">'fail to find components, find path: %s'</span>,&nbsp;plugin.components);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;fs.readdirSync(plugin.components).forEach(<span class="keyword">function</span>&nbsp;(filename)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(!<span class="regexp">/\.js$/</span>.test(filename))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;name&nbsp;=&nbsp;path.basename(filename,&nbsp;<span class="string">'.js'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;param&nbsp;=&nbsp;opts[name]&nbsp;||&nbsp;{};<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;absolutePath&nbsp;=&nbsp;path.join(dir,&nbsp;<span class="class">Constants</span>.<span class="class">Dir</span>.<span class="class">COMPONENT</span>,&nbsp;filename);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!fs.existsSync(absolutePath))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">'component %s not exist at %s'</span>,&nbsp;name,&nbsp;absolutePath);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.load(require(absolutePath),&nbsp;param);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;<span class="comment">// load events</span><br>&nbsp;&nbsp;<span class="keyword">if</span>(!plugin.events)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!fs.existsSync(plugin.events))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">'fail to find events, find path: %s'</span>,&nbsp;plugin.events);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;fs.readdirSync(plugin.events).forEach(<span class="keyword">function</span>&nbsp;(filename)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(!<span class="regexp">/\.js$/</span>.test(filename))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;absolutePath&nbsp;=&nbsp;path.join(dir,&nbsp;<span class="class">Constants</span>.<span class="class">Dir</span>.<span class="class">EVENT</span>,&nbsp;filename);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!fs.existsSync(absolutePath))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">'events %s not exist at %s'</span>,&nbsp;filename,&nbsp;absolutePath);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bindEvents(require(absolutePath),&nbsp;self);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_transaction">
                    <div class="methodtt">
                      <h3>transaction</h3>
                      <h4>Application.transaction()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - transaction name</li>
                        
                          <li>conditions - functions which are called before transaction</li>
                        
                          <li>handlers - functions which are called during transaction</li>
                        
                          <li>retry - retry times to execute handlers if conditions are successfully executed</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed. And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.transaction&nbsp;=&nbsp;<span class="keyword">function</span>(name,&nbsp;conditions,&nbsp;handlers,&nbsp;retry)&nbsp;{<br>&nbsp;&nbsp;appManager.transaction(name,&nbsp;conditions,&nbsp;handlers,&nbsp;retry);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getMaster">
                    <div class="methodtt">
                      <h3>getMaster</h3>
                      <h4>Application.getMaster()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get master server info.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getMaster&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.master;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getCurServer">
                    <div class="methodtt">
                      <h3>getCurServer</h3>
                      <h4>Application.getCurServer()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get current server info.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getCurServer&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.curServer;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServerId">
                    <div class="methodtt">
                      <h3>getServerId</h3>
                      <h4>Application.getServerId()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get current server id.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServerId&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.serverId;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServerType">
                    <div class="methodtt">
                      <h3>getServerType</h3>
                      <h4>Application.getServerType()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get current server type.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServerType&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.serverType;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServers">
                    <div class="methodtt">
                      <h3>getServers</h3>
                      <h4>Application.getServers()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get all the current server infos.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServers&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.servers;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServersFromConfig">
                    <div class="methodtt">
                      <h3>getServersFromConfig</h3>
                      <h4>Application.getServersFromConfig()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get all server infos from servers.json.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServersFromConfig&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.get(<span class="class">Constants</span>.<span class="class">KeyWords</span>.SERVER_MAP);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServerTypes">
                    <div class="methodtt">
                      <h3>getServerTypes</h3>
                      <h4>Application.getServerTypes()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get all the server type.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServerTypes&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.serverTypes;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServerById">
                    <div class="methodtt">
                      <h3>getServerById</h3>
                      <h4>Application.getServerById()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>serverId - server id</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get server info by server id from current server cluster.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServerById&nbsp;=&nbsp;<span class="keyword">function</span>(serverId)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.servers[serverId];<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServerFromConfig">
                    <div class="methodtt">
                      <h3>getServerFromConfig</h3>
                      <h4>Application.getServerFromConfig()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>serverId - server id</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get server info by server id from servers.json.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServerFromConfig&nbsp;=&nbsp;<span class="keyword">function</span>(serverId)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.get(<span class="class">Constants</span>.keyWords.SERVER_MAP)[serverId];<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_getServersByType">
                    <div class="methodtt">
                      <h3>getServersByType</h3>
                      <h4>Application.getServersByType()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>serverType - server type</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get server infos by server type.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.getServersByType&nbsp;=&nbsp;<span class="keyword">function</span>(serverType)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.serverTypeMaps[serverType];<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_isFrontend">
                    <div class="methodtt">
                      <h3>isFrontend</h3>
                      <h4>Application.isFrontend()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>server - server info. it would check current server</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Check the server whether is a frontend server</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.isFrontend&nbsp;=&nbsp;<span class="keyword">function</span>(server)&nbsp;{<br>&nbsp;&nbsp;server&nbsp;=&nbsp;server&nbsp;||&nbsp;<span class="keyword">this</span>.getCurServer();<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;!!server&nbsp;&amp;&amp;&nbsp;server.frontend&nbsp;===&nbsp;<span class="string">'true'</span>;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_isBackend">
                    <div class="methodtt">
                      <h3>isBackend</h3>
                      <h4>Application.isBackend()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>server - server info. it would check current server</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Check the server whether is a backend server</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.isBackend&nbsp;=&nbsp;<span class="keyword">function</span>(server)&nbsp;{<br>&nbsp;&nbsp;server&nbsp;=&nbsp;server&nbsp;||&nbsp;<span class="keyword">this</span>.getCurServer();<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;!!server&nbsp;&amp;&amp;&nbsp;!server.frontend;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_isMaster">
                    <div class="methodtt">
                      <h3>isMaster</h3>
                      <h4>Application.isMaster()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Check whether current server is a master server</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.isMaster&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.serverType&nbsp;===&nbsp;<span class="class">Constants</span>.<span class="class">Reserved</span>.<span class="class">MASTER</span>;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_addServers">
                    <div class="methodtt">
                      <h3>addServers</h3>
                      <h4>Application.addServers()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>servers - new server info list</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add new server info to current application in runtime.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.addServers&nbsp;=&nbsp;<span class="keyword">function</span>(servers)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!servers&nbsp;||&nbsp;!servers.length)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;item,&nbsp;slist;<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=servers.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;item&nbsp;=&nbsp;servers[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// update global server map</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.servers[item.id]&nbsp;=&nbsp;item;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// update global server type map</span><br>&nbsp;&nbsp;&nbsp;&nbsp;slist&nbsp;=&nbsp;<span class="keyword">this</span>.serverTypeMaps[item.serverType];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!slist)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.serverTypeMaps[item.serverType]&nbsp;=&nbsp;slist&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;replaceServer(slist,&nbsp;item);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// update global server type list</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">this</span>.serverTypes.indexOf(item.serverType)&nbsp;&lt;&nbsp;<span class="number">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.serverTypes.push(item.serverType);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">this</span>.event.emit(events.ADD_SERVERS,&nbsp;servers);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_removeServers">
                    <div class="methodtt">
                      <h3>removeServers</h3>
                      <h4>Application.removeServers()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>ids - server id list</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Remove server info from current application at runtime.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.removeServers&nbsp;=&nbsp;<span class="keyword">function</span>(ids)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!ids&nbsp;||&nbsp;!ids.length)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;id,&nbsp;item,&nbsp;slist;<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=ids.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;=&nbsp;ids[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;item&nbsp;=&nbsp;<span class="keyword">this</span>.servers[id];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!item)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">continue</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// clean global server map</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">delete</span>&nbsp;<span class="keyword">this</span>.servers[id];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// clean global server type map</span><br>&nbsp;&nbsp;&nbsp;&nbsp;slist&nbsp;=&nbsp;<span class="keyword">this</span>.serverTypeMaps[item.serverType];<br>&nbsp;&nbsp;&nbsp;&nbsp;removeServer(slist,&nbsp;id);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// TODO: should remove the server type if the slist is empty?</span><br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">this</span>.event.emit(events.REMOVE_SERVERS,&nbsp;ids);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_replaceServers">
                    <div class="methodtt">
                      <h3>replaceServers</h3>
                      <h4>Application.replaceServers()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>server - id map</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Replace server info from current application at runtime.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.replaceServers&nbsp;=&nbsp;<span class="keyword">function</span>(servers)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!servers){<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">this</span>.servers&nbsp;=&nbsp;servers;<br>&nbsp;&nbsp;<span class="keyword">this</span>.serverTypeMaps&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;<span class="keyword">this</span>.serverTypes&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;serverArray&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;id&nbsp;<span class="keyword">in</span>&nbsp;servers){<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;server&nbsp;=&nbsp;servers[id];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;serverType&nbsp;=&nbsp;server[<span class="class">Constants</span>.<span class="class">Reserved</span>.SERVER_TYPE];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;slist&nbsp;=&nbsp;<span class="keyword">this</span>.serverTypeMaps[serverType];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!slist)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.serverTypeMaps[serverType]&nbsp;=&nbsp;slist&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.serverTypeMaps[serverType].push(server);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// update global server type list</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">this</span>.serverTypes.indexOf(serverType)&nbsp;&lt;&nbsp;<span class="number">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.serverTypes.push(serverType);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;serverArray.push(server);<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">this</span>.event.emit(events.REPLACE_SERVERS,&nbsp;serverArray);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_addCrons">
                    <div class="methodtt">
                      <h3>addCrons</h3>
                      <h4>Application.addCrons()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>crons - new crons would be added in application</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add crons from current application at runtime.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.addCrons&nbsp;=&nbsp;<span class="keyword">function</span>(crons)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!crons&nbsp;||&nbsp;!crons.length)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(<span class="string">'crons is not defined.'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">this</span>.event.emit(events.ADD_CRONS,&nbsp;crons);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Application_removeCrons">
                    <div class="methodtt">
                      <h3>removeCrons</h3>
                      <h4>Application.removeCrons()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>crons - old crons would be removed in application</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Remove crons from current application at runtime.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Application</span>.removeCrons&nbsp;=&nbsp;<span class="keyword">function</span>(crons)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!crons&nbsp;||&nbsp;!crons.length)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(<span class="string">'ids is not defined.'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">this</span>.event.emit(events.REMOVE_CRONS,&nbsp;crons);<br>};<br><br><span class="keyword">var</span>&nbsp;replaceServer&nbsp;=&nbsp;<span class="keyword">function</span>(slist,&nbsp;serverInfo)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=slist.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(slist[i].id&nbsp;===&nbsp;serverInfo.id)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slist[i]&nbsp;=&nbsp;serverInfo;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;slist.push(serverInfo);<br>};<br><br><span class="keyword">var</span>&nbsp;removeServer&nbsp;=&nbsp;<span class="keyword">function</span>(slist,&nbsp;id)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!slist&nbsp;||&nbsp;!slist.length)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=slist.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(slist[i].id&nbsp;===&nbsp;id)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slist.splice(i,&nbsp;<span class="number">1</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>};<br><br><span class="keyword">var</span>&nbsp;contains&nbsp;=&nbsp;<span class="keyword">function</span>(str,&nbsp;settings)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!settings)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;ts&nbsp;=&nbsp;settings.split(<span class="string">"|"</span>);<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=ts.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(str&nbsp;===&nbsp;ts[i])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;<br>};<br><br><span class="keyword">var</span>&nbsp;bindEvents&nbsp;=&nbsp;<span class="keyword">function</span>(<span class="class">Event</span>,&nbsp;app)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;emethods&nbsp;=&nbsp;<span class="keyword">new</span>&nbsp;<span class="class">Event</span>(app);<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;m&nbsp;<span class="keyword">in</span>&nbsp;emethods)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;emethods[m]&nbsp;===&nbsp;<span class="string">'function'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.event.on(m,&nbsp;emethods[m].bind(emethods));<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>};<br><br><span class="keyword">var</span>&nbsp;addFilter&nbsp;=&nbsp;<span class="keyword">function</span>(app,&nbsp;type,&nbsp;filter)&nbsp;{<br>&nbsp;<span class="keyword">var</span>&nbsp;filters&nbsp;=&nbsp;app.get(type);<br>&nbsp;&nbsp;<span class="keyword">if</span>(!filters)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;=&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;app.set(type,&nbsp;filters);<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;filters.push(filter);<br>};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class="cls" id="BackendSessionService">
                <div class="clstt">
                  <h2>BackendSessionService</h2>
                </div>
      
                <div class="clsdes">
                  <p>Service that maintains backend sessions and the communiation with frontend servers.</p>

<p>BackendSessionService would be created in each server process and maintains backend sessions for current process and communicates with the relative frontend servers.</p>

<p>BackendSessionService instance could be accessed by <code>app.get(<span class="string">'backendSessionService'</span>)</code> or app.backendSessionService.</p>
                </div>
      
                
                  <div class="method" id="BackendSessionService_get">
                    <div class="methodtt">
                      <h3>get</h3>
                      <h4>BackendSessionService.prototype.get()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>frontendId - frontend server id that session attached</li>
                        
                          <li>sid - session id</li>
                        
                          <li>cb - callback function. args: cb(err, BackendSession)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get backend session by frontend server id and session id.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSessionService</span>.prototype.get&nbsp;=&nbsp;<span class="keyword">function</span>(frontendId,&nbsp;sid,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;namespace&nbsp;=&nbsp;<span class="string">'sys'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;service&nbsp;=&nbsp;<span class="string">'sessionRemote'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;method&nbsp;=&nbsp;<span class="string">'getBackendSessionBySid'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;args&nbsp;=&nbsp;[sid];<br>&nbsp;&nbsp;rpcInvoke(<span class="keyword">this</span>.app,&nbsp;frontendId,&nbsp;namespace,&nbsp;service,&nbsp;method,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args,&nbsp;<span class="class">BackendSessionCB</span>.bind(<span class="keyword">null</span>,&nbsp;<span class="keyword">this</span>,&nbsp;cb));<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSessionService_getByUid">
                    <div class="methodtt">
                      <h3>getByUid</h3>
                      <h4>BackendSessionService.prototype.getByUid()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>frontendId - frontend server id that session attached</li>
                        
                          <li>uid - user id binded with the session</li>
                        
                          <li>cb - callback function. args: cb(err, BackendSessions)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get backend sessions by frontend server id and user id.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSessionService</span>.prototype.getByUid&nbsp;=&nbsp;<span class="keyword">function</span>(frontendId,&nbsp;uid,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;namespace&nbsp;=&nbsp;<span class="string">'sys'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;service&nbsp;=&nbsp;<span class="string">'sessionRemote'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;method&nbsp;=&nbsp;<span class="string">'getBackendSessionsByUid'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;args&nbsp;=&nbsp;[uid];<br>&nbsp;&nbsp;rpcInvoke(<span class="keyword">this</span>.app,&nbsp;frontendId,&nbsp;namespace,&nbsp;service,&nbsp;method,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args,&nbsp;<span class="class">BackendSessionCB</span>.bind(<span class="keyword">null</span>,&nbsp;<span class="keyword">this</span>,&nbsp;cb));<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSessionService_kickBySid">
                    <div class="methodtt">
                      <h3>kickBySid</h3>
                      <h4>BackendSessionService.prototype.kickBySid()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>frontendId - cooperating frontend server id</li>
                        
                          <li>sid - session id</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Kick a session by session id.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSessionService</span>.prototype.kickBySid&nbsp;=&nbsp;<span class="keyword">function</span>(frontendId,&nbsp;sid,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;namespace&nbsp;=&nbsp;<span class="string">'sys'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;service&nbsp;=&nbsp;<span class="string">'sessionRemote'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;method&nbsp;=&nbsp;<span class="string">'kickBySid'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;args&nbsp;=&nbsp;[sid];<br>&nbsp;&nbsp;rpcInvoke(<span class="keyword">this</span>.app,&nbsp;frontendId,&nbsp;namespace,&nbsp;service,&nbsp;method,&nbsp;args,&nbsp;cb);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSessionService_kickByUid">
                    <div class="methodtt">
                      <h3>kickByUid</h3>
                      <h4>BackendSessionService.prototype.kickByUid()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>frontendId - cooperating frontend server id</li>
                        
                          <li>uid - user id</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Kick sessions by user id.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSessionService</span>.prototype.kickByUid&nbsp;=&nbsp;<span class="keyword">function</span>(frontendId,&nbsp;uid,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;namespace&nbsp;=&nbsp;<span class="string">'sys'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;service&nbsp;=&nbsp;<span class="string">'sessionRemote'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;method&nbsp;=&nbsp;<span class="string">'kickByUid'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;args&nbsp;=&nbsp;[uid];<br>&nbsp;&nbsp;rpcInvoke(<span class="keyword">this</span>.app,&nbsp;frontendId,&nbsp;namespace,&nbsp;service,&nbsp;method,&nbsp;args,&nbsp;cb);<br>};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class="cls" id="BackendSession">
                <div class="clstt">
                  <h2>BackendSession</h2>
                </div>
      
                <div class="clsdes">
                  <p>BackendSession is the proxy for the frontend internal session passed to handlers and it helps to keep the key/value pairs for the server locally. Internal session locates in frontend server and should not be accessed directly.</p>

<p>The mainly operation on backend session should be read and any changes happen in backend  session is local and would be discarded in next request. You have to push the changes to the frontend manually if necessary. Any push would overwrite the last push of the same key silently and the changes would be saw in next request. And you have to make sure the transaction outside if you would push the session concurrently in different processes.</p>

<p>See the api below for more details.</p>
                </div>
      
                
                  <div class="method" id="BackendSession_bind">
                    <div class="methodtt">
                      <h3>bind</h3>
                      <h4>BackendSession.prototype.bind()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Bind current session with the user id. It would push the uid to frontend server and bind  uid to the frontend internal session.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSession</span>.prototype.bind&nbsp;=&nbsp;<span class="keyword">function</span>(uid,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;self&nbsp;=&nbsp;<span class="keyword">this</span>;<br>&nbsp;&nbsp;<span class="keyword">this</span>.__sessionService__.bind(<span class="keyword">this</span>.frontendId,&nbsp;<span class="keyword">this</span>.id,&nbsp;uid,&nbsp;<span class="keyword">function</span>(err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.uid&nbsp;=&nbsp;uid;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb,&nbsp;err);<br>&nbsp;&nbsp;});<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSession_unbind">
                    <div class="methodtt">
                      <h3>unbind</h3>
                      <h4>BackendSession.prototype.unbind()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Unbind current session with the user id. It would push the uid to frontend server and unbind uid from the frontend internal session.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSession</span>.prototype.unbind&nbsp;=&nbsp;<span class="keyword">function</span>(uid,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;self&nbsp;=&nbsp;<span class="keyword">this</span>;<br>&nbsp;&nbsp;<span class="keyword">this</span>.__sessionService__.unbind(<span class="keyword">this</span>.frontendId,&nbsp;<span class="keyword">this</span>.id,&nbsp;uid,&nbsp;<span class="keyword">function</span>(err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.uid&nbsp;=&nbsp;<span class="keyword">null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb,&nbsp;err);<br>&nbsp;&nbsp;});<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSession_set">
                    <div class="methodtt">
                      <h3>set</h3>
                      <h4>BackendSession.prototype.set()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>key - key</li>
                        
                          <li>value - value</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Set the key/value into backend session.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSession</span>.prototype.set&nbsp;=&nbsp;<span class="keyword">function</span>(key,&nbsp;value)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.settings[key]&nbsp;=&nbsp;value;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSession_get">
                    <div class="methodtt">
                      <h3>get</h3>
                      <h4>BackendSession.prototype.get()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>key - key</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get the value from backend session by key.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSession</span>.prototype.get&nbsp;=&nbsp;<span class="keyword">function</span>(key)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.settings[key];<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSession_push">
                    <div class="methodtt">
                      <h3>push</h3>
                      <h4>BackendSession.prototype.push()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>key - key</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Push the key/value in backend session to the front internal session.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSession</span>.prototype.push&nbsp;=&nbsp;<span class="keyword">function</span>(key,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.__sessionService__.push(<span class="keyword">this</span>.frontendId,&nbsp;<span class="keyword">this</span>.id,&nbsp;key,&nbsp;<span class="keyword">this</span>.get(key),&nbsp;cb);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="BackendSession_pushAll">
                    <div class="methodtt">
                      <h3>pushAll</h3>
                      <h4>BackendSession.prototype.pushAll()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Push all the key/values in backend session to the frontend internal session.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">BackendSession</span>.prototype.pushAll&nbsp;=&nbsp;<span class="keyword">function</span>(cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.__sessionService__.pushAll(<span class="keyword">this</span>.frontendId,&nbsp;<span class="keyword">this</span>.id,&nbsp;<span class="keyword">this</span>.settings,&nbsp;cb);<br>};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class="cls" id="ChannelService">
                <div class="clstt">
                  <h2>ChannelService</h2>
                </div>
      
                <div class="clsdes">
                  <p>Create and maintain channels for server local.</p>

<p>ChannelService is created by channel component which is a default loaded component of pomelo and channel service would be accessed by <code>app.get(<span class="string">'channelService'</span>)</code>.</p>
                </div>
      
                
                  <div class="method" id="ChannelService_createChannel">
                    <div class="methodtt">
                      <h3>createChannel</h3>
                      <h4>ChannelService.prototype.createChannel()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - channel's name</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Create channel with name.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">ChannelService</span>.prototype.createChannel&nbsp;=&nbsp;<span class="keyword">function</span>(name)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">this</span>.channels[name])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.channels[name];<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;c&nbsp;=&nbsp;<span class="keyword">new</span>&nbsp;<span class="class">Channel</span>(name,&nbsp;<span class="keyword">this</span>);<br>&nbsp;&nbsp;<span class="keyword">this</span>.channels[name]&nbsp;=&nbsp;c;<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;c;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="ChannelService_getChannel">
                    <div class="methodtt">
                      <h3>getChannel</h3>
                      <h4>ChannelService.prototype.getChannel()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - channel's name</li>
                        
                          <li>create - if true, create channel</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get channel by name.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">ChannelService</span>.prototype.getChannel&nbsp;=&nbsp;<span class="keyword">function</span>(name,&nbsp;create)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;channel&nbsp;=&nbsp;<span class="keyword">this</span>.channels[name];<br>&nbsp;&nbsp;<span class="keyword">if</span>(!channel&nbsp;&amp;&amp;&nbsp;!!create)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;channel&nbsp;=&nbsp;<span class="keyword">this</span>.channels[name]&nbsp;=&nbsp;<span class="keyword">new</span>&nbsp;<span class="class">Channel</span>(name,&nbsp;<span class="keyword">this</span>);<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;channel;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="ChannelService_destroyChannel">
                    <div class="methodtt">
                      <h3>destroyChannel</h3>
                      <h4>ChannelService.prototype.destroyChannel()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - channel name</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Destroy channel by name.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">ChannelService</span>.prototype.destroyChannel&nbsp;=&nbsp;<span class="keyword">function</span>(name)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">delete</span>&nbsp;<span class="keyword">this</span>.channels[name];<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="ChannelService_pushMessageByUids">
                    <div class="methodtt">
                      <h3>pushMessageByUids</h3>
                      <h4>ChannelService.prototype.pushMessageByUids()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>route - message route</li>
                        
                          <li>msg - message that would be sent to client</li>
                        
                          <li>uids - the receiver info list, [{uid: userId, sid: frontendServerId}]</li>
                        
                          <li>opts - user-defined push options, optional </li>
                        
                          <li>cb - cb(err)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Push message by uids. Group the uids by group. ignore any uid if sid not specified.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">ChannelService</span>.prototype.pushMessageByUids&nbsp;=&nbsp;<span class="keyword">function</span>(route,&nbsp;msg,&nbsp;uids,&nbsp;opts,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;route&nbsp;!==&nbsp;<span class="string">'string'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;cb&nbsp;=&nbsp;opts;<br>&nbsp;&nbsp;&nbsp;&nbsp;opts&nbsp;=&nbsp;uids;<br>&nbsp;&nbsp;&nbsp;&nbsp;uids&nbsp;=&nbsp;msg;<br>&nbsp;&nbsp;&nbsp;&nbsp;msg&nbsp;=&nbsp;route;<br>&nbsp;&nbsp;&nbsp;&nbsp;route&nbsp;=&nbsp;msg.route;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(!cb&nbsp;&amp;&amp;&nbsp;<span class="keyword">typeof</span>&nbsp;opts&nbsp;===&nbsp;<span class="string">'function'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;cb&nbsp;=&nbsp;opts;<br>&nbsp;&nbsp;&nbsp;&nbsp;opts&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(!uids&nbsp;||&nbsp;uids.length&nbsp;===&nbsp;<span class="number">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb,&nbsp;<span class="keyword">new</span>&nbsp;<span class="class">Error</span>(<span class="string">'uids should not be empty'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;groups&nbsp;=&nbsp;{},&nbsp;record;<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=uids.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;record&nbsp;=&nbsp;uids[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;add(record.uid,&nbsp;record.sid,&nbsp;groups);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;sendMessageByGroup(<span class="keyword">this</span>,&nbsp;route,&nbsp;msg,&nbsp;groups,&nbsp;opts,&nbsp;cb);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="ChannelService_broadcast">
                    <div class="methodtt">
                      <h3>broadcast</h3>
                      <h4>ChannelService.prototype.broadcast()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>stype - frontend server type string</li>
                        
                          <li>route - route string</li>
                        
                          <li>msg - message</li>
                        
                          <li>opts - user-defined broadcast options, optional</li>
                        
                          <li>cb - callback</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Broadcast message to all the connected clients.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">ChannelService</span>.prototype.broadcast&nbsp;=&nbsp;<span class="keyword">function</span>(stype,&nbsp;route,&nbsp;msg,&nbsp;opts,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;app&nbsp;=&nbsp;<span class="keyword">this</span>.app;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;namespace&nbsp;=&nbsp;<span class="string">'sys'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;service&nbsp;=&nbsp;<span class="string">'channelRemote'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;method&nbsp;=&nbsp;<span class="string">'broadcast'</span>;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;servers&nbsp;=&nbsp;app.getServersByType(stype);<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(!servers&nbsp;||&nbsp;servers.length&nbsp;===&nbsp;<span class="number">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// server list is empty</span><br>&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;count&nbsp;=&nbsp;servers.length;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;successFlag&nbsp;=&nbsp;<span class="keyword">false</span>;<br><br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;latch&nbsp;=&nbsp;countDownLatch.createCountDownLatch(count,&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!successFlag)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb,&nbsp;<span class="keyword">new</span>&nbsp;<span class="class">Error</span>(<span class="string">'broadcast fails'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb,&nbsp;<span class="keyword">null</span>);<br>&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;genCB&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">function</span>(err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(err)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span class="string">'[broadcast] fail to push message, err:'</span>&nbsp;+&nbsp;err.stack);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latch.done();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;successFlag&nbsp;=&nbsp;<span class="keyword">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latch.done();<br>&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;opts&nbsp;=&nbsp;{type:&nbsp;<span class="string">'broadcast'</span>,&nbsp;userOptions:&nbsp;opts&nbsp;||&nbsp;{}};<br><br>&nbsp;&nbsp;<span class="comment">// for compatiblity </span><br>&nbsp;&nbsp;opts.isBroadcast&nbsp;=&nbsp;<span class="keyword">true</span>;<br>&nbsp;&nbsp;<span class="keyword">if</span>(opts.userOptions)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;opts.binded&nbsp;=&nbsp;opts.userOptions.binded;<br>&nbsp;&nbsp;&nbsp;&nbsp;opts.filterParam&nbsp;=&nbsp;opts.userOptions.filterParam;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=count;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;app.rpcInvoke(servers[i].id,&nbsp;{namespace:&nbsp;namespace,&nbsp;service:&nbsp;service,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method:&nbsp;method,&nbsp;args:&nbsp;[route,&nbsp;msg,&nbsp;opts]},&nbsp;genCB());<br>&nbsp;&nbsp;}<br>};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class="cls" id="Channel">
                <div class="clstt">
                  <h2>Channel</h2>
                </div>
      
                <div class="clsdes">
                  <p>Channel maintains the receiver collection for a subject. You can add users into a channel and then broadcast message to them by channel.</p>
                </div>
      
                
                  <div class="method" id="Channel_add">
                    <div class="methodtt">
                      <h3>add</h3>
                      <h4>Channel.prototype.add()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                          <li>sid - frontend server id which user has connected to</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add user to channel.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Channel</span>.prototype.add&nbsp;=&nbsp;<span class="keyword">function</span>(uid,&nbsp;sid)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">this</span>.state&nbsp;&gt;&nbsp;ST_INITED)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;<br>&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;res&nbsp;=&nbsp;add(uid,&nbsp;sid,&nbsp;<span class="keyword">this</span>.groups);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(res)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.records[uid]&nbsp;=&nbsp;{sid:&nbsp;sid,&nbsp;uid:&nbsp;uid};<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;res;<br>&nbsp;&nbsp;}<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Channel_leave">
                    <div class="methodtt">
                      <h3>leave</h3>
                      <h4>Channel.prototype.leave()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                          <li>sid - frontend server id which user has connected to.</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Remove user from channel.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Channel</span>.prototype.leave&nbsp;=&nbsp;<span class="keyword">function</span>(uid,&nbsp;sid)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(!uid&nbsp;||&nbsp;!sid)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">delete</span>&nbsp;<span class="keyword">this</span>.records[uid];<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;res&nbsp;=&nbsp;deleteFrom(uid,&nbsp;sid,&nbsp;<span class="keyword">this</span>.groups[sid]);<br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">this</span>.groups[sid]&nbsp;&amp;&amp;&nbsp;<span class="keyword">this</span>.groups[sid].length&nbsp;===&nbsp;<span class="number">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">delete</span>&nbsp;<span class="keyword">this</span>.groups[sid];<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;res;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Channel_getMembers">
                    <div class="methodtt">
                      <h3>getMembers</h3>
                      <h4>Channel.prototype.getMembers()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get channel members.</p>

<p><b>Notice:</b> Heavy operation.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Channel</span>.prototype.getMembers&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;res&nbsp;=&nbsp;[],&nbsp;groups&nbsp;=&nbsp;<span class="keyword">this</span>.groups;<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;group,&nbsp;i,&nbsp;l;<br>&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;sid&nbsp;<span class="keyword">in</span>&nbsp;groups)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;group&nbsp;=&nbsp;groups[sid];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>(i=<span class="number">0</span>,&nbsp;l=group.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.push(group[i]);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;res;<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Channel_getMember">
                    <div class="methodtt">
                      <h3>getMember</h3>
                      <h4>Channel.prototype.getMember()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get Member info.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Channel</span>.prototype.getMember&nbsp;=&nbsp;<span class="keyword">function</span>(uid)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">this</span>.records[uid];<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Channel_destroy">
                    <div class="methodtt">
                      <h3>destroy</h3>
                      <h4>Channel.prototype.destroy()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Destroy channel.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Channel</span>.prototype.destroy&nbsp;=&nbsp;<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">this</span>.state&nbsp;=&nbsp;ST_DESTROYED;<br>&nbsp;&nbsp;<span class="keyword">this</span>.__channelService__.destroyChannel(<span class="keyword">this</span>.name);<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="Channel_pushMessage">
                    <div class="methodtt">
                      <h3>pushMessage</h3>
                      <h4>Channel.prototype.pushMessage()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>route - message route</li>
                        
                          <li>msg - message that would be sent to client</li>
                        
                          <li>opts - user-defined push options, optional</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Push message to all the members in the channel</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Channel</span>.prototype.pushMessage&nbsp;=&nbsp;<span class="keyword">function</span>(route,&nbsp;msg,&nbsp;opts,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">this</span>.state&nbsp;!==&nbsp;ST_INITED)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(<span class="keyword">new</span>&nbsp;<span class="class">Error</span>(<span class="string">'channel is not running now'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;route&nbsp;!==&nbsp;<span class="string">'string'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;cb&nbsp;=&nbsp;opts;<br>&nbsp;&nbsp;&nbsp;&nbsp;opts&nbsp;=&nbsp;msg;<br>&nbsp;&nbsp;&nbsp;&nbsp;msg&nbsp;=&nbsp;route;<br>&nbsp;&nbsp;&nbsp;&nbsp;route&nbsp;=&nbsp;msg.route;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(!cb&nbsp;&amp;&amp;&nbsp;<span class="keyword">typeof</span>&nbsp;opts&nbsp;===&nbsp;<span class="string">'function'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;cb&nbsp;=&nbsp;opts;<br>&nbsp;&nbsp;&nbsp;&nbsp;opts&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;sendMessageByGroup(<span class="keyword">this</span>.__channelService__,&nbsp;route,&nbsp;msg,&nbsp;<span class="keyword">this</span>.groups,&nbsp;opts,&nbsp;cb);<br>};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class="cls" id="SessionService">
                <div class="clstt">
                  <h2>SessionService</h2>
                </div>
      
                <div class="clsdes">
                  <p>Session service maintains the internal session for each client connection.</p>

<p>Session service is created by session component and is only <b>available</b> in frontend servers. You can access the service by <code>app.get(<span class="string">'sessionService'</span>)</code> or <code>app.sessionService</code> in frontend servers.</p>
                </div>
      
                
                  <div class="method" id="SessionService_kick">
                    <div class="methodtt">
                      <h3>kick</h3>
                      <h4>SessionService.prototype.kick()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id asscociated with the session</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Kick all the session offline under the user id.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">SessionService</span>.prototype.kick&nbsp;=&nbsp;<span class="keyword">function</span>(uid,&nbsp;reason,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="comment">// compatible for old kick(uid, cb);</span><br>&nbsp;&nbsp;<span class="keyword">if</span>(<span class="keyword">typeof</span>&nbsp;reason&nbsp;===&nbsp;<span class="string">'function'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;cb&nbsp;=&nbsp;reason;<br>&nbsp;&nbsp;&nbsp;&nbsp;reason&nbsp;=&nbsp;<span class="string">'kick'</span>;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;sessions&nbsp;=&nbsp;<span class="keyword">this</span>.getByUid(uid);<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(sessions)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// notify client</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>(<span class="keyword">var</span>&nbsp;i=<span class="number">0</span>,&nbsp;l=sessions.length;&nbsp;i&nbsp;&lt;&nbsp;l;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sessions[i].closed(reason);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;process.nextTick(<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;process.nextTick(<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class="method" id="SessionService_kickBySessionId">
                    <div class="methodtt">
                      <h3>kickBySessionId</h3>
                      <h4>SessionService.prototype.kickBySessionId()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>sid - session id</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Kick a user offline by session id.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">SessionService</span>.prototype.kickBySessionId&nbsp;=&nbsp;<span class="keyword">function</span>(sid,&nbsp;cb)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;session&nbsp;=&nbsp;<span class="keyword">this</span>.get(sid);<br><br>&nbsp;&nbsp;<span class="keyword">if</span>(session)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// notify client</span><br>&nbsp;&nbsp;&nbsp;&nbsp;session.closed(<span class="string">'kick'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;process.nextTick(<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;process.nextTick(<span class="keyword">function</span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;utils.invokeCallback(cb);<br>&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;}<br>};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class="cls" id="Pomelo">
                <div class="clstt">
                  <h2>Pomelo</h2>
                </div>
      
                <div class="clsdes">
                  <p>Expose <code>createApplication()</code>.</p>
                </div>
      
                
                  <div class="method" id="Pomelo_createApp">
                    <div class="methodtt">
                      <h3>createApp</h3>
                      <h4>Pomelo.createApp()</h4>
                      <p class="type">type: method</p>
                    </div>
      
                    <div class="params">
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Create an pomelo application.</p>
                    </div>
      
                    <div class="source">
                      <h4>Source</h4>
                      <pre><code><span class="class">Pomelo</span>.createApp&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;(opts)&nbsp;{<br>&nbsp;&nbsp;<span class="keyword">var</span>&nbsp;app&nbsp;=&nbsp;application;<br>&nbsp;&nbsp;app.init(opts);<br>&nbsp;&nbsp;self.app&nbsp;=&nbsp;app;<br>&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;app;<br>};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
          </div>
          <!-- API导航 -->
          <div class="side">
            <div class="m-nav">
              <div class="m-search">
                <input type="text" id="search-input" placeholder="Search">
                <div id="search-results"></div>
              </div>
              <ul>
                
                  <li>
                    <h3><a target="Application" class="cap">Application</a></h3>
                    <ul>
                      
                        <li><a target="Application_getBase">getBase</a></li>
                      
                        <li><a target="Application_filter">filter</a></li>
                      
                        <li><a target="Application_before">before</a></li>
                      
                        <li><a target="Application_after">after</a></li>
                      
                        <li><a target="Application_globalFilter">globalFilter</a></li>
                      
                        <li><a target="Application_globalBefore">globalBefore</a></li>
                      
                        <li><a target="Application_globalAfter">globalAfter</a></li>
                      
                        <li><a target="Application_rpcBefore">rpcBefore</a></li>
                      
                        <li><a target="Application_rpcAfter">rpcAfter</a></li>
                      
                        <li><a target="Application_rpcFilter">rpcFilter</a></li>
                      
                        <li><a target="Application_load">load</a></li>
                      
                        <li><a target="Application_loadConfig">loadConfig</a></li>
                      
                        <li><a target="Application_route">route</a></li>
                      
                        <li><a target="Application_beforeStopHook">beforeStopHook</a></li>
                      
                        <li><a target="Application_start">start</a></li>
                      
                        <li><a target="Application_set">set</a></li>
                      
                        <li><a target="Application_get">get</a></li>
                      
                        <li><a target="Application_enabled">enabled</a></li>
                      
                        <li><a target="Application_disabled">disabled</a></li>
                      
                        <li><a target="Application_enable">enable</a></li>
                      
                        <li><a target="Application_disable">disable</a></li>
                      
                        <li><a target="Application_configure">configure</a></li>
                      
                        <li><a target="Application_registerAdmin">registerAdmin</a></li>
                      
                        <li><a target="Application_use">use</a></li>
                      
                        <li><a target="Application_transaction">transaction</a></li>
                      
                        <li><a target="Application_getMaster">getMaster</a></li>
                      
                        <li><a target="Application_getCurServer">getCurServer</a></li>
                      
                        <li><a target="Application_getServerId">getServerId</a></li>
                      
                        <li><a target="Application_getServerType">getServerType</a></li>
                      
                        <li><a target="Application_getServers">getServers</a></li>
                      
                        <li><a target="Application_getServersFromConfig">getServersFromConfig</a></li>
                      
                        <li><a target="Application_getServerTypes">getServerTypes</a></li>
                      
                        <li><a target="Application_getServerById">getServerById</a></li>
                      
                        <li><a target="Application_getServerFromConfig">getServerFromConfig</a></li>
                      
                        <li><a target="Application_getServersByType">getServersByType</a></li>
                      
                        <li><a target="Application_isFrontend">isFrontend</a></li>
                      
                        <li><a target="Application_isBackend">isBackend</a></li>
                      
                        <li><a target="Application_isMaster">isMaster</a></li>
                      
                        <li><a target="Application_addServers">addServers</a></li>
                      
                        <li><a target="Application_removeServers">removeServers</a></li>
                      
                        <li><a target="Application_replaceServers">replaceServers</a></li>
                      
                        <li><a target="Application_addCrons">addCrons</a></li>
                      
                        <li><a target="Application_removeCrons">removeCrons</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target="BackendSessionService" class="cap">BackendSessionService</a></h3>
                    <ul>
                      
                        <li><a target="BackendSessionService_get">get</a></li>
                      
                        <li><a target="BackendSessionService_getByUid">getByUid</a></li>
                      
                        <li><a target="BackendSessionService_kickBySid">kickBySid</a></li>
                      
                        <li><a target="BackendSessionService_kickByUid">kickByUid</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target="BackendSession" class="cap">BackendSession</a></h3>
                    <ul>
                      
                        <li><a target="BackendSession_bind">bind</a></li>
                      
                        <li><a target="BackendSession_unbind">unbind</a></li>
                      
                        <li><a target="BackendSession_set">set</a></li>
                      
                        <li><a target="BackendSession_get">get</a></li>
                      
                        <li><a target="BackendSession_push">push</a></li>
                      
                        <li><a target="BackendSession_pushAll">pushAll</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target="ChannelService" class="cap">ChannelService</a></h3>
                    <ul>
                      
                        <li><a target="ChannelService_createChannel">createChannel</a></li>
                      
                        <li><a target="ChannelService_getChannel">getChannel</a></li>
                      
                        <li><a target="ChannelService_destroyChannel">destroyChannel</a></li>
                      
                        <li><a target="ChannelService_pushMessageByUids">pushMessageByUids</a></li>
                      
                        <li><a target="ChannelService_broadcast">broadcast</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target="Channel" class="cap">Channel</a></h3>
                    <ul>
                      
                        <li><a target="Channel_add">add</a></li>
                      
                        <li><a target="Channel_leave">leave</a></li>
                      
                        <li><a target="Channel_getMembers">getMembers</a></li>
                      
                        <li><a target="Channel_getMember">getMember</a></li>
                      
                        <li><a target="Channel_destroy">destroy</a></li>
                      
                        <li><a target="Channel_pushMessage">pushMessage</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target="SessionService" class="cap">SessionService</a></h3>
                    <ul>
                      
                        <li><a target="SessionService_kick">kick</a></li>
                      
                        <li><a target="SessionService_kickBySessionId">kickBySessionId</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target="Pomelo" class="cap">Pomelo</a></h3>
                    <ul>
                      
                        <li><a target="Pomelo_createApp">createApp</a></li>
                      
                    </ul>
                  </li>
                
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 尾部 -->
    <div class="g-ft">
      <!-- 尾部模块 -->
      <div class="m-ft">
	copyright 2012, NetEase, Inc. All Rights Reserved.
      </div>
    </div>
    <!-- 向上图标 -->
    <div class="m-arrow f-dn"><a href="https://github.com/NetEase/pomelo"></a></div>
    <!-- 代码高亮模块 -->
    <script src="./pomelo API_files/hijs.js.下载"></script>
    <!-- 页面效果模块 -->
    <script src="./pomelo API_files/api.js.下载"></script>
  

<!--
     FILE ARCHIVED ON 09:56:39 May 21, 2017 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 08:03:27 Apr 17, 2019.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  LoadShardBlock: 38.391 (3)
  esindex: 0.009
  captures_list: 63.134
  CDXLines.iter: 9.271 (3)
  PetaboxLoader3.datanode: 79.422 (4)
  exclusion.robots: 0.271
  exclusion.robots.policy: 0.258
  RedisCDXSource: 12.031
  PetaboxLoader3.resolve: 29.114
  load_resource: 77.579
--></body></html>