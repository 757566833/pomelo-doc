<!DOCTYPE html>
<!-- saved from url=(0077)https://web.archive.org/web/20170521095639/http://pomelo.netease.com/api.html -->
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="./pomelo API_files/analytics.js.下载" type="text/javascript"></script>
  <script
    type="text/javascript">window.addEventListener('DOMContentLoaded', function () { var v = archive_analytics.values; v.service = 'wb'; v.server_name = 'wwwb-app103.us.archive.org'; v.server_ms = 145; archive_analytics.send_pageview({}); });</script>
  <script type="text/javascript" src="./pomelo API_files/ait-client-rewrite.js.下载" charset="utf-8"></script>
  <script type="text/javascript">
    WB_wombat_Init("https://web.archive.org/web", "20170521095639", "pomelo.netease.com:80");
  </script>
  <script type="text/javascript" src="./pomelo API_files/wbhack.js.下载" charset="utf-8"></script>
  <script type="text/javascript">
    __wbhack.init('https://web.archive.org/web');
  </script>
  <link rel="stylesheet" type="text/css" href="./pomelo API_files/banner-styles.css">
  <link rel="stylesheet" type="text/css" href="./pomelo API_files/iconochive.css">
  <!-- End Wayback Rewrite JS Include -->


  <title>pomelo API</title>
  <meta http-equiv="content-type" content="text/html">
  <meta http-equiv="content-style-type" content="text/css">
  <meta http-equiv="content-script-type" content="text/javascript">
  <meta name="author" content="netease">
  <meta name="version" content="1.0">
  <meta name="keywords" content="pomelo, game, framework, lordofpomelo, node.js, js, 网易，游戏">
  <meta name="description"
    content="Pomelo is a fast, scalable, distributed game server framework for Node.js. It provides the basic development framework and a lot of related components, including libraries and tools. Pomelo is also suitable for realtime web application, its distributed architecture makes Pomelo scale better than other realtime web frameworks.">


  <link type="text/css" rel="stylesheet" href="./pomelo API_files/base.css">
  <link type="text/css" rel="stylesheet" href="./pomelo API_files/api.css">
  <link type="text/css" rel="stylesheet" href="./doc/mk.css">
  <script>
    var raw = [{ "id": "1-1387877793311", "name": "Application", "signiture": "Application", "type": "declaration", "ctx": { "type": "declaration", "name": "Application", "value": "module.exports = {}", "string": "Application" }, "description": { "full": "<p>Application prototype.</p>", "summary": "<p>Application prototype.</p>", "body": "" }, "full_description": "<p>Application prototype.</p>", "code": "var Application = module.exports = {};", "params": [], "has_params": false, "tags": [{ "type": "module", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "4-1387877793311", "name": "getBase", "signiture": "Application.getBase()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getBase", "string": "Application.getBase()" }, "description": { "full": "<p>Get application base path</p>\n\n<p>// cwd: /home/game/<br /> pomelo start<br /> // app.getBase() -> /home/game</p>", "summary": "<p>Get application base path</p>", "body": "<p>// cwd: /home/game/<br /> pomelo start<br /> // app.getBase() -> /home/game</p>" }, "full_description": "<p>Get application base path</p>\n\n<p>// cwd: /home/game/  pomelo start  // app.getBase() -> /home/game</p>", "code": "Application.getBase = function() {\n  return this.get(Constants.Reserved.BASE);\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["String"], "description": "application base path" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "5-1387877793311", "name": "filter", "signiture": "Application.filter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "filter", "string": "Application.filter()" }, "description": { "full": "<p>add a filter to before and after filter</p>", "summary": "<p>add a filter to before and after filter</p>", "body": "" }, "full_description": "<p>add a filter to before and after filter</p>", "code": "Application.filter = function (filter) {\n  this.before(filter);\n  this.after(filter);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }, { "type": "", "string": "A filter should have two methods: before and after." }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "6-1387877793311", "name": "before", "signiture": "Application.before()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "before", "string": "Application.before()" }, "description": { "full": "<p>Add before filter.</p>", "summary": "<p>Add before filter.</p>", "body": "" }, "full_description": "<p>Add before filter.</p>", "code": "Application.before = function (bf) {\n  addFilter(this, Constants.KeyWords.BEFORE_FILTER, bf);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "7-1387877793311", "name": "after", "signiture": "Application.after()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "after", "string": "Application.after()" }, "description": { "full": "<p>Add after filter.</p>", "summary": "<p>Add after filter.</p>", "body": "" }, "full_description": "<p>Add after filter.</p>", "code": "Application.after = function (af) {\n  addFilter(this, Constants.KeyWords.AFTER_FILTER, af);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "8-1387877793311", "name": "globalFilter", "signiture": "Application.globalFilter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "globalFilter", "string": "Application.globalFilter()" }, "description": { "full": "<p>add a global filter to before and after global filter</p>", "summary": "<p>add a global filter to before and after global filter</p>", "body": "" }, "full_description": "<p>add a global filter to before and after global filter</p>", "code": "Application.globalFilter = function (filter) {\n  this.globalBefore(filter);\n  this.globalAfter(filter);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }, { "type": "", "string": "A filter should have two methods: before and after." }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "9-1387877793311", "name": "globalBefore", "signiture": "Application.globalBefore()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "globalBefore", "string": "Application.globalBefore()" }, "description": { "full": "<p>Add global before filter.</p>", "summary": "<p>Add global before filter.</p>", "body": "" }, "full_description": "<p>Add global before filter.</p>", "code": "Application.globalBefore = function (bf) {\n  addFilter(this, Constants.KeyWords.GLOBAL_BEFORE_FILTER, bf);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(msg, session, next)" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "10-1387877793311", "name": "globalAfter", "signiture": "Application.globalAfter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "globalAfter", "string": "Application.globalAfter()" }, "description": { "full": "<p>Add global after filter.</p>", "summary": "<p>Add global after filter.</p>", "body": "" }, "full_description": "<p>Add global after filter.</p>", "code": "Application.globalAfter = function (af) {\n  addFilter(this, Constants.KeyWords.GLOBAL_AFTER_FILTER, af);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(err, msg, session, resp, next)`" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "11-1387877793311", "name": "rpcBefore", "signiture": "Application.rpcBefore()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "rpcBefore", "string": "Application.rpcBefore()" }, "description": { "full": "<p>Add rpc before filter.</p>", "summary": "<p>Add rpc before filter.</p>", "body": "" }, "full_description": "<p>Add rpc before filter.</p>", "code": "Application.rpcBefore = function(bf) {\n  addFilter(this, Constants.KeyWords.RPC_BEFORE_FILTER, bf);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(serverId, msg, opts, next)" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "bf", "description": "before fileter, bf(serverId, msg, opts, next)" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "12-1387877793311", "name": "rpcAfter", "signiture": "Application.rpcAfter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "rpcAfter", "string": "Application.rpcAfter()" }, "description": { "full": "<p>Add rpc after filter.</p>", "summary": "<p>Add rpc after filter.</p>", "body": "" }, "full_description": "<p>Add rpc after filter.</p>", "code": "Application.rpcAfter = function(af) {\n  addFilter(this, Constants.KeyWords.RPC_AFTER_FILTER, af);\n};", "params": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(serverId, msg, opts, next)`" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object", "Function"], "name": "af", "description": "after filter, `af(serverId, msg, opts, next)`" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "13-1387877793311", "name": "rpcFilter", "signiture": "Application.rpcFilter()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "rpcFilter", "string": "Application.rpcFilter()" }, "description": { "full": "<p>add a rpc filter to before and after rpc filter</p>", "summary": "<p>add a rpc filter to before and after rpc filter</p>", "body": "" }, "full_description": "<p>add a rpc filter to before and after rpc filter</p>", "code": "Application.rpcFilter = function(filter) {\n  this.rpcBefore(filter);\n  this.rpcAfter(filter);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "filter", "description": "provide before and after filter method." }, { "type": "", "string": "A filter should have two methods: before and after." }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "14-1387877793311", "name": "load", "signiture": "Application.load()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "load", "string": "Application.load()" }, "description": { "full": "<p>Load component</p>", "summary": "<p>Load component</p>", "body": "" }, "full_description": "<p>Load component</p>", "code": "Application.load = function(name, component, opts) {\n  if(typeof name !== 'string') {\n    opts = component;\n    component = name;\n    name = null;\n    if(typeof component.name === 'string') {\n      name = component.name;\n    }\n  }\n\n  if(typeof component === 'function') {\n    component = component(this, opts);\n  }\n\n  if(!name && typeof component.name === 'string') {\n    name = component.name;\n  }\n\n  if(name && this.components[name]) {\n    // ignore duplicat component\n    logger.warn('ignore duplicate component: %j', name);\n    return;\n  }\n\n  this.loaded.push(component);\n  if(name) {\n    // components with a name would get by name throught app.components later.\n    this.components[name] = component;\n  }\n\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "(optional) name of the component" }, { "type": "param", "types": ["Object"], "name": "component", "description": "component instance or factory function of the component" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "(optional) name of the component" }, { "type": "param", "types": ["Object"], "name": "component", "description": "component instance or factory function of the component" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }, { "type": "return", "types": ["Object"], "description": "app instance for chain invoke" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "15-1387877793311", "name": "loadConfig", "signiture": "Application.loadConfig()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "loadConfig", "string": "Application.loadConfig()" }, "description": { "full": "<p>Load Configure json file to settings.</p>", "summary": "<p>Load Configure json file to settings.</p>", "body": "" }, "full_description": "<p>Load Configure json file to settings.</p>", "code": "Application.loadConfig = function (key, val) {\n  var env = this.get(Constants.Reserved.ENV);\n  val = require(val);\n  if (val[env]) {\n    val = val[env];\n  }\n  this.set(key, val);\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "environment key" }, { "type": "param", "types": ["String"], "name": "val", "description": "environment value" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "environment key" }, { "type": "param", "types": ["String"], "name": "val", "description": "environment value" }, { "type": "return", "types": ["Server", "Mixed"], "description": "for chaining, or the setting value" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "16-1387877793311", "name": "route", "signiture": "Application.route()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "route", "string": "Application.route()" }, "description": { "full": "<p>Set the route function for the specified server type.</p>\n\n<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {<br />   // all request to area would be route to the first area server<br />   var areas = app.getServersByType('area');<br />   cb(null, areas[0].id);<br /> };</p>", "summary": "<p>Set the route function for the specified server type.</p>", "body": "<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {<br />   // all request to area would be route to the first area server<br />   var areas = app.getServersByType('area');<br />   cb(null, areas[0].id);<br /> };</p>" }, "full_description": "<p>Set the route function for the specified server type.</p>\n\n<p>Examples:</p>\n\n<p>app.route('area', routeFunc);</p>\n\n<p>var routeFunc = function(session, msg, app, cb) {    // all request to area would be route to the first area server    var areas = app.getServersByType('area');    cb(null, areas[0].id);  };</p>", "code": "Application.route = function(serverType, routeFunc) {\n  var routes = this.get(Constants.KeyWords.ROUTE);\n  if(!routes) {\n    routes = {};\n    this.set(Constants.KeyWords.ROUTE, routes);\n  }\n  routes[serverType] = routeFunc;\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type string" }, { "type": "param", "types": ["Function"], "name": "routeFunc", "description": "route function. routeFunc(session, msg, app, cb)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type string" }, { "type": "param", "types": ["Function"], "name": "routeFunc", "description": "route function. routeFunc(session, msg, app, cb)" }, { "type": "return", "types": ["Object"], "description": "current application instance for chain invoking" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "17-1387877793311", "name": "beforeStopHook", "signiture": "Application.beforeStopHook()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "beforeStopHook", "string": "Application.beforeStopHook()" }, "description": { "full": "<p>Set before stop function. It would perform before servers stop.</p>", "summary": "<p>Set before stop function. It would perform before servers stop.</p>", "body": "" }, "full_description": "<p>Set before stop function. It would perform before servers stop.</p>", "code": "Application.beforeStopHook = function(fun) {\n  logger.warn('this method was deprecated in pomelo 0.8');\n  if(!!fun && typeof fun === 'function') {\n    this.set(Constants.KeyWords.BEFORE_STOP_HOOK, fun);\n  }\n};", "params": [{ "type": "param", "types": ["Function"], "name": "fun", "description": "before close function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Function"], "name": "fun", "description": "before close function" }, { "type": "return", "types": ["Void"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "18-1387877793311", "name": "start", "signiture": "Application.start()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "start", "string": "Application.start()" }, "description": { "full": "<p>Start application. It would load the default components and start all the loaded components.</p>", "summary": "<p>Start application. It would load the default components and start all the loaded components.</p>", "body": "" }, "full_description": "<p>Start application. It would load the default components and start all the loaded components.</p>", "code": "Application.start = function(cb) {\n  this.startTime = Date.now();\n  if(this.state > STATE_INITED) {\n    utils.invokeCallback(cb, new Error('application has already start.'));\n    return;\n  }\n  appUtil.loadDefaultComponents(this);\n  var self = this;\n  var startUp = function() {\n    appUtil.optComponents(self.loaded, Constants.Reserved.START, function(err) {\n      self.state = STATE_START;\n      if(err) {\n        utils.invokeCallback(cb, err);\n      } else {\n        logger.info('%j enter after start...', self.getServerId());\n        self.afterStart(cb);\n      }\n    });\n  };\n  var beforeFun = this.lifecycleCbs[Constants.LIFECYCLE.BEFORE_STARTUP];\n  if(!!beforeFun) {\n    beforeFun.call(null, this, startUp);\n  } else {\n    startUp();\n  }\n};", "params": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "21-1387877793311", "name": "set", "signiture": "Application.set()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "set", "string": "Application.set()" }, "description": { "full": "<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>\n\n<p>Example:</p>\n\n<p>app.set('key1', 'value1');<br /> app.get('key1');  // 'value1'<br /> app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);<br /> app.get('key2');  // 'value2'<br /> app.key2;         // 'value2'</p>", "summary": "<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>", "body": "<p>Example:</p>\n\n<p>app.set('key1', 'value1');<br /> app.get('key1');  // 'value1'<br /> app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);<br /> app.get('key2');  // 'value2'<br /> app.key2;         // 'value2'</p>" }, "full_description": "<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>\n\n<p>Example:</p>\n\n<p>app.set('key1', 'value1');  app.get('key1');  // 'value1'  app.key1;         // undefined</p>\n\n<p>app.set('key2', 'value2', true);  app.get('key2');  // 'value2'  app.key2;         // 'value2'</p>", "code": "Application.set = function (setting, val, attach) {\n  if (arguments.length === 1) {\n    return this.settings[setting];\n  }\n  this.settings[setting] = val;\n  if(attach) {\n    this[setting] = val;\n  }\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "the setting of application" }, { "type": "param", "types": ["String"], "name": "val", "description": "the setting's value" }, { "type": "param", "types": ["Boolean"], "name": "attach", "description": "whether attach the settings to application" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "the setting of application" }, { "type": "param", "types": ["String"], "name": "val", "description": "the setting's value" }, { "type": "param", "types": ["Boolean"], "name": "attach", "description": "whether attach the settings to application" }, { "type": "return", "types": ["Server", "Mixed"], "description": "for chaining, or the setting value" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "22-1387877793311", "name": "get", "signiture": "Application.get()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "get", "string": "Application.get()" }, "description": { "full": "<p>Get property from setting</p>", "summary": "<p>Get property from setting</p>", "body": "" }, "full_description": "<p>Get property from setting</p>", "code": "Application.get = function (setting) {\n  return this.settings[setting];\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["String"], "description": "val" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "23-1387877793311", "name": "enabled", "signiture": "Application.enabled()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "enabled", "string": "Application.enabled()" }, "description": { "full": "<p>Check if <code>setting</code> is enabled.</p>", "summary": "<p>Check if <code>setting</code> is enabled.</p>", "body": "" }, "full_description": "<p>Check if <code>setting</code> is enabled.</p>", "code": "Application.enabled = function (setting) {\n  return !!this.get(setting);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "24-1387877793311", "name": "disabled", "signiture": "Application.disabled()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "disabled", "string": "Application.disabled()" }, "description": { "full": "<p>Check if <code>setting</code> is disabled.</p>", "summary": "<p>Check if <code>setting</code> is disabled.</p>", "body": "" }, "full_description": "<p>Check if <code>setting</code> is disabled.</p>", "code": "Application.disabled = function (setting) {\n  return !this.get(setting);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "25-1387877793311", "name": "enable", "signiture": "Application.enable()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "enable", "string": "Application.enable()" }, "description": { "full": "<p>Enable <code>setting</code>.</p>", "summary": "<p>Enable <code>setting</code>.</p>", "body": "" }, "full_description": "<p>Enable <code>setting</code>.</p>", "code": "Application.enable = function (setting) {\n  return this.set(setting, true);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["app"], "description": "for chaining" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "26-1387877793311", "name": "disable", "signiture": "Application.disable()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "disable", "string": "Application.disable()" }, "description": { "full": "<p>Disable <code>setting</code>.</p>", "summary": "<p>Disable <code>setting</code>.</p>", "body": "" }, "full_description": "<p>Disable <code>setting</code>.</p>", "code": "Application.disable = function (setting) {\n  return this.set(setting, false);\n};", "params": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "setting", "description": "application setting" }, { "type": "return", "types": ["app"], "description": "for chaining" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "27-1387877793311", "name": "configure", "signiture": "Application.configure()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "configure", "string": "Application.configure()" }, "description": { "full": "<p>Configure callback for the specified env and server type.<br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified<br />that callback will be invoked for all server types.</p>\n\n<p>Examples:</p>\n\n<p>app.configure(function(){<br />   // executed for all envs and server types<br /> });</p>\n\n<p>app.configure('development', function(){<br />   // executed development env<br /> });</p>\n\n<p>app.configure('development', 'connector', function(){<br />   // executed for development env and connector server type<br /> });</p>", "summary": "<p>Configure callback for the specified env and server type.<br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified<br />that callback will be invoked for all server types.</p>", "body": "<p>Examples:</p>\n\n<p>app.configure(function(){<br />   // executed for all envs and server types<br /> });</p>\n\n<p>app.configure('development', function(){<br />   // executed development env<br /> });</p>\n\n<p>app.configure('development', 'connector', function(){<br />   // executed for development env and connector server type<br /> });</p>" }, "full_description": "<p>Configure callback for the specified env and server type. When no env is specified that callback will be invoked for all environments and when no type is specified that callback will be invoked for all server types.</p>\n\n<p>Examples:</p>\n\n<p>app.configure(function(){    // executed for all envs and server types  });</p>\n\n<p>app.configure('development', function(){    // executed development env  });</p>\n\n<p>app.configure('development', 'connector', function(){    // executed for development env and connector server type  });</p>", "code": "Application.configure = function (env, type, fn) {\n  var args = [].slice.call(arguments);\n  fn = args.pop();\n  env = type = Constants.Reserved.ALL;\n\n  if(args.length > 0) {\n    env = args[0];\n  }\n  if(args.length > 1) {\n    type = args[1];\n  }\n\n  if (env === Constants.Reserved.ALL || contains(this.settings.env, env)) {\n    if (type === Constants.Reserved.ALL || contains(this.settings.serverType, type)) {\n      fn.call(this);\n    }\n  }\n  return this;\n};", "params": [{ "type": "param", "types": ["String"], "name": "env", "description": "application environment" }, { "type": "param", "types": ["Function"], "name": "fn", "description": "callback function" }, { "type": "param", "types": ["String"], "name": "type", "description": "server type" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "env", "description": "application environment" }, { "type": "param", "types": ["Function"], "name": "fn", "description": "callback function" }, { "type": "param", "types": ["String"], "name": "type", "description": "server type" }, { "type": "return", "types": ["Application"], "description": "for chaining" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "28-1387877793311", "name": "registerAdmin", "signiture": "Application.registerAdmin()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "registerAdmin", "string": "Application.registerAdmin()" }, "description": { "full": "<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>", "summary": "<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>", "body": "" }, "full_description": "<p>Register admin modules. Admin modules is the extends point of the monitor system.</p>", "code": "Application.registerAdmin = function(moduleId, module, opts) {\n  var modules = this.get(Constants.KeyWords.MODULE);\n  if(!modules) {\n    modules = {};\n    this.set(Constants.KeyWords.MODULE, modules);\n  }\n\n  if(typeof moduleId !== 'string') {\n    opts = module;\n    module = moduleId;\n    if(module) {\n      moduleId = module.moduleId;\n    }\n  }\n\n  if(!moduleId){\n    return;\n  }\n\n  modules[moduleId] = {\n    moduleId: moduleId,\n    module: module,\n    opts: opts\n  };\n};", "params": [{ "type": "param", "types": ["String"], "name": "module", "description": "(optional) module id or provoided by module.moduleId" }, { "type": "param", "types": ["Object"], "name": "module", "description": "module object or factory function for module" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "construct parameter for module" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "module", "description": "(optional) module id or provoided by module.moduleId" }, { "type": "param", "types": ["Object"], "name": "module", "description": "module object or factory function for module" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "construct parameter for module" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "29-1387877793311", "name": "use", "signiture": "Application.use()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "use", "string": "Application.use()" }, "description": { "full": "<p>Use plugin.</p>", "summary": "<p>Use plugin.</p>", "body": "" }, "full_description": "<p>Use plugin.</p>", "code": "Application.use = function(plugin, opts) {\n  if(!plugin.components) {\n    logger.error('invalid components, no components exist');\n    return;\n  }\n  \n  var self = this;\n  var dir = path.dirname(plugin.components);\n\n  if(!fs.existsSync(plugin.components)) {\n    logger.error('fail to find components, find path: %s', plugin.components);\n    return;\n  }\n\n  fs.readdirSync(plugin.components).forEach(function (filename) {\n    if (!/\\.js$/.test(filename)) {\n      return;\n    }\n    var name = path.basename(filename, '.js');\n    var param = opts[name] || {};\n    var absolutePath = path.join(dir, Constants.Dir.COMPONENT, filename);\n    if(!fs.existsSync(absolutePath)) {\n      logger.error('component %s not exist at %s', name, absolutePath);\n    } else {\n      self.load(require(absolutePath), param);\n    }\n  });\n\n  // load events\n  if(!plugin.events) {\n    return;\n  } else {\n    if(!fs.existsSync(plugin.events)) {\n      logger.error('fail to find events, find path: %s', plugin.events);\n      return;\n    }\n\n    fs.readdirSync(plugin.events).forEach(function (filename) {\n      if (!/\\.js$/.test(filename)) {\n        return;\n      }\n      var absolutePath = path.join(dir, Constants.Dir.EVENT, filename);\n      if(!fs.existsSync(absolutePath)) {\n        logger.error('events %s not exist at %s', filename, absolutePath);\n      } else {\n        bindEvents(require(absolutePath), self);\n      }\n    });\n  }\n};", "params": [{ "type": "param", "types": ["Object"], "name": "plugin", "description": "plugin instance" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "plugin", "description": "plugin instance" }, { "type": "param", "types": ["[type]"], "name": "opts", "description": "(optional) construct parameters for the factory function" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "30-1387877793311", "name": "transaction", "signiture": "Application.transaction()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "transaction", "string": "Application.transaction()" }, "description": { "full": "<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed.<br />And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>", "summary": "<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed.<br />And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>", "body": "" }, "full_description": "<p>Application transaction. Transcation includes conditions and handlers, if conditions are satisfied, handlers would be executed. And you can set retry times to execute handlers. The transaction log is in file logs/transaction.log.</p>", "code": "Application.transaction = function(name, conditions, handlers, retry) {\n  appManager.transaction(name, conditions, handlers, retry);\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "transaction name" }, { "type": "param", "types": ["Object"], "name": "conditions", "description": "functions which are called before transaction" }, { "type": "param", "types": ["Object"], "name": "handlers", "description": "functions which are called during transaction" }, { "type": "param", "types": ["Number"], "name": "retry", "description": "retry times to execute handlers if conditions are successfully executed" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "transaction name" }, { "type": "param", "types": ["Object"], "name": "conditions", "description": "functions which are called before transaction" }, { "type": "param", "types": ["Object"], "name": "handlers", "description": "functions which are called during transaction" }, { "type": "param", "types": ["Number"], "name": "retry", "description": "retry times to execute handlers if conditions are successfully executed" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "31-1387877793311", "name": "getMaster", "signiture": "Application.getMaster()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getMaster", "string": "Application.getMaster()" }, "description": { "full": "<p>Get master server info.</p>", "summary": "<p>Get master server info.</p>", "body": "" }, "full_description": "<p>Get master server info.</p>", "code": "Application.getMaster = function() {\n  return this.master;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "master server info, {id, host, port}" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "32-1387877793311", "name": "getCurServer", "signiture": "Application.getCurServer()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getCurServer", "string": "Application.getCurServer()" }, "description": { "full": "<p>Get current server info.</p>", "summary": "<p>Get current server info.</p>", "body": "" }, "full_description": "<p>Get current server info.</p>", "code": "Application.getCurServer = function() {\n  return this.curServer;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "current server info, {id, serverType, host, port}" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "33-1387877793311", "name": "getServerId", "signiture": "Application.getServerId()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerId", "string": "Application.getServerId()" }, "description": { "full": "<p>Get current server id.</p>", "summary": "<p>Get current server id.</p>", "body": "" }, "full_description": "<p>Get current server id.</p>", "code": "Application.getServerId = function() {\n  return this.serverId;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["String", "Number"], "description": "current server id from servers.json" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "34-1387877793311", "name": "getServerType", "signiture": "Application.getServerType()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerType", "string": "Application.getServerType()" }, "description": { "full": "<p>Get current server type.</p>", "summary": "<p>Get current server type.</p>", "body": "" }, "full_description": "<p>Get current server type.</p>", "code": "Application.getServerType = function() {\n  return this.serverType;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["String", "Number"], "description": "current server type from servers.json" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "35-1387877793311", "name": "getServers", "signiture": "Application.getServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServers", "string": "Application.getServers()" }, "description": { "full": "<p>Get all the current server infos.</p>", "summary": "<p>Get all the current server infos.</p>", "body": "" }, "full_description": "<p>Get all the current server infos.</p>", "code": "Application.getServers = function() {\n  return this.servers;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "server info map, key: server id, value: server info" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "36-1387877793311", "name": "getServersFromConfig", "signiture": "Application.getServersFromConfig()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServersFromConfig", "string": "Application.getServersFromConfig()" }, "description": { "full": "<p>Get all server infos from servers.json.</p>", "summary": "<p>Get all server infos from servers.json.</p>", "body": "" }, "full_description": "<p>Get all server infos from servers.json.</p>", "code": "Application.getServersFromConfig = function() {\n  return this.get(Constants.KeyWords.SERVER_MAP);\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Object"], "description": "server info map, key: server id, value: server info" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "37-1387877793311", "name": "getServerTypes", "signiture": "Application.getServerTypes()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerTypes", "string": "Application.getServerTypes()" }, "description": { "full": "<p>Get all the server type.</p>", "summary": "<p>Get all the server type.</p>", "body": "" }, "full_description": "<p>Get all the server type.</p>", "code": "Application.getServerTypes = function() {\n  return this.serverTypes;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Array"], "description": "server type list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "38-1387877793311", "name": "getServerById", "signiture": "Application.getServerById()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerById", "string": "Application.getServerById()" }, "description": { "full": "<p>Get server info by server id from current server cluster.</p>", "summary": "<p>Get server info by server id from current server cluster.</p>", "body": "" }, "full_description": "<p>Get server info by server id from current server cluster.</p>", "code": "Application.getServerById = function(serverId) {\n  return this.servers[serverId];\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }, { "type": "return", "types": ["Object"], "description": "server info or undefined" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "39-1387877793311", "name": "getServerFromConfig", "signiture": "Application.getServerFromConfig()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServerFromConfig", "string": "Application.getServerFromConfig()" }, "description": { "full": "<p>Get server info by server id from servers.json.</p>", "summary": "<p>Get server info by server id from servers.json.</p>", "body": "" }, "full_description": "<p>Get server info by server id from servers.json.</p>", "code": "Application.getServerFromConfig = function(serverId) {\n  return this.get(Constants.keyWords.SERVER_MAP)[serverId];\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverId", "description": "server id" }, { "type": "return", "types": ["Object"], "description": "server info or undefined" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "40-1387877793311", "name": "getServersByType", "signiture": "Application.getServersByType()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "getServersByType", "string": "Application.getServersByType()" }, "description": { "full": "<p>Get server infos by server type.</p>", "summary": "<p>Get server infos by server type.</p>", "body": "" }, "full_description": "<p>Get server infos by server type.</p>", "code": "Application.getServersByType = function(serverType) {\n  return this.serverTypeMaps[serverType];\n};", "params": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "serverType", "description": "server type" }, { "type": "return", "types": ["Array"], "description": "server info list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "41-1387877793311", "name": "isFrontend", "signiture": "Application.isFrontend()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "isFrontend", "string": "Application.isFrontend()" }, "description": { "full": "<p>Check the server whether is a frontend server</p>", "summary": "<p>Check the server whether is a frontend server</p>", "body": "" }, "full_description": "<p>Check the server whether is a frontend server</p>", "code": "Application.isFrontend = function(server) {\n  server = server || this.getCurServer();\n  return !!server && server.frontend === 'true';\n};", "params": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }], "has_params": true, "tags": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }, { "type": "", "string": "if server not specified" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "42-1387877793311", "name": "isBackend", "signiture": "Application.isBackend()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "isBackend", "string": "Application.isBackend()" }, "description": { "full": "<p>Check the server whether is a backend server</p>", "summary": "<p>Check the server whether is a backend server</p>", "body": "" }, "full_description": "<p>Check the server whether is a backend server</p>", "code": "Application.isBackend = function(server) {\n  server = server || this.getCurServer();\n  return !!server && !server.frontend;\n};", "params": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }], "has_params": true, "tags": [{ "type": "param", "types": ["server"], "name": "server", "description": "server info. it would check current server" }, { "type": "", "string": "if server not specified" }, { "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "43-1387877793311", "name": "isMaster", "signiture": "Application.isMaster()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "isMaster", "string": "Application.isMaster()" }, "description": { "full": "<p>Check whether current server is a master server</p>", "summary": "<p>Check whether current server is a master server</p>", "body": "" }, "full_description": "<p>Check whether current server is a master server</p>", "code": "Application.isMaster = function() {\n  return this.serverType === Constants.Reserved.MASTER;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Boolean"], "description": "" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "44-1387877793311", "name": "addServers", "signiture": "Application.addServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "addServers", "string": "Application.addServers()" }, "description": { "full": "<p>Add new server info to current application in runtime.</p>", "summary": "<p>Add new server info to current application in runtime.</p>", "body": "" }, "full_description": "<p>Add new server info to current application in runtime.</p>", "code": "Application.addServers = function(servers) {\n  if(!servers || !servers.length) {\n    return;\n  }\n\n  var item, slist;\n  for(var i=0, l=servers.length; i<l; i++) {\n    item = servers[i];\n    // update global server map\n    this.servers[item.id] = item;\n\n    // update global server type map\n    slist = this.serverTypeMaps[item.serverType];\n    if(!slist) {\n      this.serverTypeMaps[item.serverType] = slist = [];\n    }\n    replaceServer(slist, item);\n\n    // update global server type list\n    if(this.serverTypes.indexOf(item.serverType) < 0) {\n      this.serverTypes.push(item.serverType);\n    }\n  }\n  this.event.emit(events.ADD_SERVERS, servers);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "servers", "description": "new server info list" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "servers", "description": "new server info list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "45-1387877793311", "name": "removeServers", "signiture": "Application.removeServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "removeServers", "string": "Application.removeServers()" }, "description": { "full": "<p>Remove server info from current application at runtime.</p>", "summary": "<p>Remove server info from current application at runtime.</p>", "body": "" }, "full_description": "<p>Remove server info from current application at runtime.</p>", "code": "Application.removeServers = function(ids) {\n  if(!ids || !ids.length) {\n    return;\n  }\n\n  var id, item, slist;\n  for(var i=0, l=ids.length; i<l; i++) {\n    id = ids[i];\n    item = this.servers[id];\n    if(!item) {\n      continue;\n    }\n    // clean global server map\n    delete this.servers[id];\n\n    // clean global server type map\n    slist = this.serverTypeMaps[item.serverType];\n    removeServer(slist, id);\n    // TODO: should remove the server type if the slist is empty?\n  }\n  this.event.emit(events.REMOVE_SERVERS, ids);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "ids", "description": "server id list" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "ids", "description": "server id list" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "46-1387877793311", "name": "replaceServers", "signiture": "Application.replaceServers()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "replaceServers", "string": "Application.replaceServers()" }, "description": { "full": "<p>Replace server info from current application at runtime.</p>", "summary": "<p>Replace server info from current application at runtime.</p>", "body": "" }, "full_description": "<p>Replace server info from current application at runtime.</p>", "code": "Application.replaceServers = function(servers) {\n  if(!servers){\n    return;\n  }\n\n  this.servers = servers;\n  this.serverTypeMaps = {};\n  this.serverTypes = [];\n  var serverArray = [];\n  for(var id in servers){\n    var server = servers[id];\n    var serverType = server[Constants.Reserved.SERVER_TYPE];\n    var slist = this.serverTypeMaps[serverType];\n    if(!slist) {\n      this.serverTypeMaps[serverType] = slist = [];\n    }\n    this.serverTypeMaps[serverType].push(server);\n    // update global server type list\n    if(this.serverTypes.indexOf(serverType) < 0) {\n      this.serverTypes.push(serverType);\n    }\n    serverArray.push(server);\n  }\n  this.event.emit(events.REPLACE_SERVERS, serverArray);\n};", "params": [{ "type": "param", "types": ["Object"], "name": "server", "description": "id map" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "server", "description": "id map" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "47-1387877793311", "name": "addCrons", "signiture": "Application.addCrons()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "addCrons", "string": "Application.addCrons()" }, "description": { "full": "<p>Add crons from current application at runtime.</p>", "summary": "<p>Add crons from current application at runtime.</p>", "body": "" }, "full_description": "<p>Add crons from current application at runtime.</p>", "code": "Application.addCrons = function(crons) {\n  if(!crons || !crons.length) {\n    logger.warn('crons is not defined.');\n    return;\n  }\n  this.event.emit(events.ADD_CRONS, crons);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "new crons would be added in application" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "new crons would be added in application" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }, { "id": "48-1387877793311", "name": "removeCrons", "signiture": "Application.removeCrons()", "type": "method", "ctx": { "type": "method", "receiver": "Application", "name": "removeCrons", "string": "Application.removeCrons()" }, "description": { "full": "<p>Remove crons from current application at runtime.</p>", "summary": "<p>Remove crons from current application at runtime.</p>", "body": "" }, "full_description": "<p>Remove crons from current application at runtime.</p>", "code": "Application.removeCrons = function(crons) {\n  if(!crons || !crons.length) {\n    logger.warn('ids is not defined.');\n    return;\n  }\n  this.event.emit(events.REMOVE_CRONS, crons);\n};\n\nvar replaceServer = function(slist, serverInfo) {\n  for(var i=0, l=slist.length; i<l; i++) {\n    if(slist[i].id === serverInfo.id) {\n      slist[i] = serverInfo;\n      return;\n    }\n  }\n  slist.push(serverInfo);\n};\n\nvar removeServer = function(slist, id) {\n  if(!slist || !slist.length) {\n    return;\n  }\n\n  for(var i=0, l=slist.length; i<l; i++) {\n    if(slist[i].id === id) {\n      slist.splice(i, 1);\n      return;\n    }\n  }\n};\n\nvar contains = function(str, settings) {\n  if(!settings) {\n    return false;\n  }\n\n  var ts = settings.split(\"|\");\n  for(var i=0, l=ts.length; i<l; i++) {\n    if(str === ts[i]) {\n      return true;\n    }\n  }\n  return false;\n};\n\nvar bindEvents = function(Event, app) {\n  var emethods = new Event(app);\n  for(var m in emethods) {\n    if(typeof emethods[m] === 'function') {\n      app.event.on(m, emethods[m].bind(emethods));\n    }\n  }\n};\n\nvar addFilter = function(app, type, filter) {\n var filters = app.get(type);\n  if(!filters) {\n    filters = [];\n    app.set(type, filters);\n  }\n  filters.push(filter);\n};", "params": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "old crons would be removed in application" }], "has_params": true, "tags": [{ "type": "param", "types": ["Array"], "name": "crons", "description": "old crons would be removed in application" }, { "type": "memberOf", "parent": "Application" }], "module": false, "parent": "Application", "related": { "href": "" }, "has_related": true }] }, { "id": "63-1387877793312", "name": "BackendSessionService", "signiture": "BackendSessionService()", "type": "function", "ctx": { "type": "function", "name": "BackendSessionService", "string": "BackendSessionService()" }, "description": { "full": "<p>Service that maintains backend sessions and the communiation with frontend<br />servers.</p>\n\n<p>BackendSessionService would be created in each server process and maintains<br />backend sessions for current process and communicates with the relative<br />frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by<br /><code>app.get('backendSessionService')</code> or app.backendSessionService.</p>", "summary": "<p>Service that maintains backend sessions and the communiation with frontend<br />servers.</p>", "body": "<p>BackendSessionService would be created in each server process and maintains<br />backend sessions for current process and communicates with the relative<br />frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by<br /><code>app.get('backendSessionService')</code> or app.backendSessionService.</p>" }, "full_description": "<p>Service that maintains backend sessions and the communiation with frontend servers.</p>\n\n<p>BackendSessionService would be created in each server process and maintains backend sessions for current process and communicates with the relative frontend servers.</p>\n\n<p>BackendSessionService instance could be accessed by <code>app.get('backendSessionService')</code> or app.backendSessionService.</p>", "code": "var BackendSessionService = function(app) {\n  this.app = app;\n};\n\nmodule.exports = BackendSessionService;\n\nBackendSessionService.prototype.create = function(opts) {\n  if(!opts) {\n    throw new Error('opts should not be empty.');\n  }\n  return new BackendSession(opts, this);\n};", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "64-1387877793312", "name": "get", "signiture": "BackendSessionService.prototype.get()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "get", "string": "BackendSessionService.prototype.get()" }, "description": { "full": "<p>Get backend session by frontend server id and session id.</p>", "summary": "<p>Get backend session by frontend server id and session id.</p>", "body": "" }, "full_description": "<p>Get backend session by frontend server id and session id.</p>", "code": "BackendSessionService.prototype.get = function(frontendId, sid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'getBackendSessionBySid';\n  var args = [sid];\n  rpcInvoke(this.app, frontendId, namespace, service, method,\n            args, BackendSessionCB.bind(null, this, cb));\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSession)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSession)" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }, { "id": "65-1387877793312", "name": "getByUid", "signiture": "BackendSessionService.prototype.getByUid()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "getByUid", "string": "BackendSessionService.prototype.getByUid()" }, "description": { "full": "<p>Get backend sessions by frontend server id and user id.</p>", "summary": "<p>Get backend sessions by frontend server id and user id.</p>", "body": "" }, "full_description": "<p>Get backend sessions by frontend server id and user id.</p>", "code": "BackendSessionService.prototype.getByUid = function(frontendId, uid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'getBackendSessionsByUid';\n  var args = [uid];\n  rpcInvoke(this.app, frontendId, namespace, service, method,\n            args, BackendSessionCB.bind(null, this, cb));\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "uid", "description": "user id binded with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSessions)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "frontend server id that session attached" }, { "type": "param", "types": ["String"], "name": "uid", "description": "user id binded with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function. args: cb(err, BackendSessions)" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }, { "id": "66-1387877793312", "name": "kickBySid", "signiture": "BackendSessionService.prototype.kickBySid()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "kickBySid", "string": "BackendSessionService.prototype.kickBySid()" }, "description": { "full": "<p>Kick a session by session id.</p>", "summary": "<p>Kick a session by session id.</p>", "body": "" }, "full_description": "<p>Kick a session by session id.</p>", "code": "BackendSessionService.prototype.kickBySid = function(frontendId, sid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'kickBySid';\n  var args = [sid];\n  rpcInvoke(this.app, frontendId, namespace, service, method, args, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }, { "id": "67-1387877793312", "name": "kickByUid", "signiture": "BackendSessionService.prototype.kickByUid()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSessionService", "cons": "BackendSessionService", "name": "kickByUid", "string": "BackendSessionService.prototype.kickByUid()" }, "description": { "full": "<p>Kick sessions by user id.</p>", "summary": "<p>Kick sessions by user id.</p>", "body": "" }, "full_description": "<p>Kick sessions by user id.</p>", "code": "BackendSessionService.prototype.kickByUid = function(frontendId, uid, cb) {\n  var namespace = 'sys';\n  var service = 'sessionRemote';\n  var method = 'kickByUid';\n  var args = [uid];\n  rpcInvoke(this.app, frontendId, namespace, service, method, args, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "frontendId", "description": "cooperating frontend server id" }, { "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSessionService" }], "module": false, "parent": "BackendSessionService", "related": { "href": "" }, "has_related": true }] }, { "id": "68-1387877793312", "name": "BackendSession", "signiture": "BackendSession()", "type": "function", "ctx": { "type": "function", "name": "BackendSession", "string": "BackendSession()" }, "description": { "full": "<p>BackendSession is the proxy for the frontend internal session passed to handlers and<br />it helps to keep the key/value pairs for the server locally.<br />Internal session locates in frontend server and should not be accessed directly.</p>\n\n<p>The mainly operation on backend session should be read and any changes happen in backend <br />session is local and would be discarded in next request. You have to push the<br />changes to the frontend manually if necessary. Any push would overwrite the last push<br />of the same key silently and the changes would be saw in next request.<br />And you have to make sure the transaction outside if you would push the session<br />concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>", "summary": "<p>BackendSession is the proxy for the frontend internal session passed to handlers and<br />it helps to keep the key/value pairs for the server locally.<br />Internal session locates in frontend server and should not be accessed directly.</p>", "body": "<p>The mainly operation on backend session should be read and any changes happen in backend <br />session is local and would be discarded in next request. You have to push the<br />changes to the frontend manually if necessary. Any push would overwrite the last push<br />of the same key silently and the changes would be saw in next request.<br />And you have to make sure the transaction outside if you would push the session<br />concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>" }, "full_description": "<p>BackendSession is the proxy for the frontend internal session passed to handlers and it helps to keep the key/value pairs for the server locally. Internal session locates in frontend server and should not be accessed directly.</p>\n\n<p>The mainly operation on backend session should be read and any changes happen in backend  session is local and would be discarded in next request. You have to push the changes to the frontend manually if necessary. Any push would overwrite the last push of the same key silently and the changes would be saw in next request. And you have to make sure the transaction outside if you would push the session concurrently in different processes.</p>\n\n<p>See the api below for more details.</p>", "code": "var BackendSession = function(opts, service) {\n  EventEmitter.call(this);\n  for(var f in opts) {\n    this[f] = opts[f];\n  }\n  this.__sessionService__ = service;\n};\n\nutil.inherits(BackendSession, EventEmitter);", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "69-1387877793312", "name": "bind", "signiture": "BackendSession.prototype.bind()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "bind", "string": "BackendSession.prototype.bind()" }, "description": { "full": "<p>Bind current session with the user id. It would push the uid to frontend<br />server and bind  uid to the frontend internal session.</p>", "summary": "<p>Bind current session with the user id. It would push the uid to frontend<br />server and bind  uid to the frontend internal session.</p>", "body": "" }, "full_description": "<p>Bind current session with the user id. It would push the uid to frontend server and bind  uid to the frontend internal session.</p>", "code": "BackendSession.prototype.bind = function(uid, cb) {\n  var self = this;\n  this.__sessionService__.bind(this.frontendId, this.id, uid, function(err) {\n    if(!err) {\n      self.uid = uid;\n    }\n    utils.invokeCallback(cb, err);\n  });\n};", "params": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSession" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "70-1387877793312", "name": "unbind", "signiture": "BackendSession.prototype.unbind()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "unbind", "string": "BackendSession.prototype.unbind()" }, "description": { "full": "<p>Unbind current session with the user id. It would push the uid to frontend<br />server and unbind uid from the frontend internal session.</p>", "summary": "<p>Unbind current session with the user id. It would push the uid to frontend<br />server and unbind uid from the frontend internal session.</p>", "body": "" }, "full_description": "<p>Unbind current session with the user id. It would push the uid to frontend server and unbind uid from the frontend internal session.</p>", "code": "BackendSession.prototype.unbind = function(uid, cb) {\n  var self = this;\n  this.__sessionService__.unbind(this.frontendId, this.id, uid, function(err) {\n    if(!err) {\n      self.uid = null;\n    }\n    utils.invokeCallback(cb, err);\n  });\n};", "params": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number", "String"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "BackendSession" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "71-1387877793312", "name": "set", "signiture": "BackendSession.prototype.set()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "set", "string": "BackendSession.prototype.set()" }, "description": { "full": "<p>Set the key/value into backend session.</p>", "summary": "<p>Set the key/value into backend session.</p>", "body": "" }, "full_description": "<p>Set the key/value into backend session.</p>", "code": "BackendSession.prototype.set = function(key, value) {\n  this.settings[key] = value;\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Object"], "name": "value", "description": "value" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Object"], "name": "value", "description": "value" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "72-1387877793312", "name": "get", "signiture": "BackendSession.prototype.get()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "get", "string": "BackendSession.prototype.get()" }, "description": { "full": "<p>Get the value from backend session by key.</p>", "summary": "<p>Get the value from backend session by key.</p>", "body": "" }, "full_description": "<p>Get the value from backend session by key.</p>", "code": "BackendSession.prototype.get = function(key) {\n  return this.settings[key];\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "return", "types": ["Object"], "description": "value" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "73-1387877793312", "name": "push", "signiture": "BackendSession.prototype.push()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "push", "string": "BackendSession.prototype.push()" }, "description": { "full": "<p>Push the key/value in backend session to the front internal session.</p>", "summary": "<p>Push the key/value in backend session to the front internal session.</p>", "body": "" }, "full_description": "<p>Push the key/value in backend session to the front internal session.</p>", "code": "BackendSession.prototype.push = function(key, cb) {\n  this.__sessionService__.push(this.frontendId, this.id, key, this.get(key), cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "key", "description": "key" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }, { "id": "74-1387877793312", "name": "pushAll", "signiture": "BackendSession.prototype.pushAll()", "type": "method", "ctx": { "type": "method", "constructor": "BackendSession", "cons": "BackendSession", "name": "pushAll", "string": "BackendSession.prototype.pushAll()" }, "description": { "full": "<p>Push all the key/values in backend session to the frontend internal session.</p>", "summary": "<p>Push all the key/values in backend session to the frontend internal session.</p>", "body": "" }, "full_description": "<p>Push all the key/values in backend session to the frontend internal session.</p>", "code": "BackendSession.prototype.pushAll = function(cb) {\n  this.__sessionService__.pushAll(this.frontendId, this.id, this.settings, cb);\n};", "params": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "module": false, "parent": "BackendSession", "related": { "href": "" }, "has_related": true }] }, { "id": "76-1387877793312", "name": "ChannelService", "signiture": "ChannelService()", "type": "function", "ctx": { "type": "function", "name": "ChannelService", "string": "ChannelService()" }, "description": { "full": "<p>Create and maintain channels for server local.</p>\n\n<p>ChannelService is created by channel component which is a default loaded<br />component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>", "summary": "<p>Create and maintain channels for server local.</p>", "body": "<p>ChannelService is created by channel component which is a default loaded<br />component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>" }, "full_description": "<p>Create and maintain channels for server local.</p>\n\n<p>ChannelService is created by channel component which is a default loaded component of pomelo and channel service would be accessed by <code>app.get('channelService')</code>.</p>", "code": "var ChannelService = function(app, opts) {\n  opts = opts || {};\n  this.app = app;\n  this.channels = {};\n  this.broadcastFilter = opts.broadcastFilter;\n};\n\nmodule.exports = ChannelService;", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "77-1387877793312", "name": "createChannel", "signiture": "ChannelService.prototype.createChannel()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "createChannel", "string": "ChannelService.prototype.createChannel()" }, "description": { "full": "<p>Create channel with name.</p>", "summary": "<p>Create channel with name.</p>", "body": "" }, "full_description": "<p>Create channel with name.</p>", "code": "ChannelService.prototype.createChannel = function(name) {\n  if(this.channels[name]) {\n    return this.channels[name];\n  }\n\n  var c = new Channel(name, this);\n  this.channels[name] = c;\n  return c;\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "78-1387877793312", "name": "getChannel", "signiture": "ChannelService.prototype.getChannel()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "getChannel", "string": "ChannelService.prototype.getChannel()" }, "description": { "full": "<p>Get channel by name.</p>", "summary": "<p>Get channel by name.</p>", "body": "" }, "full_description": "<p>Get channel by name.</p>", "code": "ChannelService.prototype.getChannel = function(name, create) {\n  var channel = this.channels[name];\n  if(!channel && !!create) {\n    channel = this.channels[name] = new Channel(name, this);\n  }\n  return channel;\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }, { "type": "param", "types": ["Boolean"], "name": "create", "description": "if true, create channel" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel's name" }, { "type": "param", "types": ["Boolean"], "name": "create", "description": "if true, create channel" }, { "type": "return", "types": ["Channel"], "description": "" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "79-1387877793312", "name": "destroyChannel", "signiture": "ChannelService.prototype.destroyChannel()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "destroyChannel", "string": "ChannelService.prototype.destroyChannel()" }, "description": { "full": "<p>Destroy channel by name.</p>", "summary": "<p>Destroy channel by name.</p>", "body": "" }, "full_description": "<p>Destroy channel by name.</p>", "code": "ChannelService.prototype.destroyChannel = function(name) {\n  delete this.channels[name];\n};", "params": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel name" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "name", "description": "channel name" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "80-1387877793312", "name": "pushMessageByUids", "signiture": "ChannelService.prototype.pushMessageByUids()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "pushMessageByUids", "string": "ChannelService.prototype.pushMessageByUids()" }, "description": { "full": "<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>", "summary": "<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>", "body": "" }, "full_description": "<p>Push message by uids. Group the uids by group. ignore any uid if sid not specified.</p>", "code": "ChannelService.prototype.pushMessageByUids = function(route, msg, uids, opts, cb) {\n  if(typeof route !== 'string') {\n    cb = opts;\n    opts = uids;\n    uids = msg;\n    msg = route;\n    route = msg.route;\n  }\n\n  if(!cb && typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  if(!uids || uids.length === 0) {\n    utils.invokeCallback(cb, new Error('uids should not be empty'));\n    return;\n  }\n  var groups = {}, record;\n  for(var i=0, l=uids.length; i<l; i++) {\n    record = uids[i];\n    add(record.uid, record.sid, groups);\n  }\n\n  sendMessageByGroup(this, route, msg, groups, opts, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Array"], "name": "uids", "description": "the receiver info list, [{uid: userId, sid: frontendServerId}]" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional " }, { "type": "param", "types": ["Function"], "name": "cb", "description": "cb(err)" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Array"], "name": "uids", "description": "the receiver info list, [{uid: userId, sid: frontendServerId}]" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional " }, { "type": "param", "types": ["Function"], "name": "cb", "description": "cb(err)" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }, { "id": "81-1387877793312", "name": "broadcast", "signiture": "ChannelService.prototype.broadcast()", "type": "method", "ctx": { "type": "method", "constructor": "ChannelService", "cons": "ChannelService", "name": "broadcast", "string": "ChannelService.prototype.broadcast()" }, "description": { "full": "<p>Broadcast message to all the connected clients.</p>", "summary": "<p>Broadcast message to all the connected clients.</p>", "body": "" }, "full_description": "<p>Broadcast message to all the connected clients.</p>", "code": "ChannelService.prototype.broadcast = function(stype, route, msg, opts, cb) {\n  var app = this.app;\n  var namespace = 'sys';\n  var service = 'channelRemote';\n  var method = 'broadcast';\n  var servers = app.getServersByType(stype);\n\n  if(!servers || servers.length === 0) {\n    // server list is empty\n    utils.invokeCallback(cb);\n    return;\n  }\n\n  var count = servers.length;\n  var successFlag = false;\n\n  var latch = countDownLatch.createCountDownLatch(count, function() {\n    if(!successFlag) {\n      utils.invokeCallback(cb, new Error('broadcast fails'));\n      return;\n    }\n    utils.invokeCallback(cb, null);\n  });\n\n  var genCB = function() {\n    return function(err) {\n      if(err) {\n        logger.error('[broadcast] fail to push message, err:' + err.stack);\n        latch.done();\n        return;\n      }\n      successFlag = true;\n      latch.done();\n    };\n  };\n\n  opts = {type: 'broadcast', userOptions: opts || {}};\n\n  // for compatiblity \n  opts.isBroadcast = true;\n  if(opts.userOptions) {\n    opts.binded = opts.userOptions.binded;\n    opts.filterParam = opts.userOptions.filterParam;\n  }\n\n  for(var i=0, l=count; i<l; i++) {\n    app.rpcInvoke(servers[i].id, {namespace: namespace, service: service,\n      method: method, args: [route, msg, opts]}, genCB());\n  }\n};", "params": [{ "type": "param", "types": ["String"], "name": "stype", "description": "frontend server type string" }, { "type": "param", "types": ["String"], "name": "route", "description": "route string" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined broadcast options, optional" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "stype", "description": "frontend server type string" }, { "type": "param", "types": ["String"], "name": "route", "description": "route string" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined broadcast options, optional" }, { "type": "", "string": "opts.binded: push to binded sessions or all the sessions" }, { "type": "", "string": "opts.filterParam: parameters for broadcast filter." }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback" }, { "type": "memberOf", "parent": "ChannelService" }], "module": false, "parent": "ChannelService", "related": { "href": "" }, "has_related": true }] }, { "id": "82-1387877793312", "name": "Channel", "signiture": "Channel()", "type": "function", "ctx": { "type": "function", "name": "Channel", "string": "Channel()" }, "description": { "full": "<p>Channel maintains the receiver collection for a subject. You can<br />add users into a channel and then broadcast message to them by channel.</p>", "summary": "<p>Channel maintains the receiver collection for a subject. You can<br />add users into a channel and then broadcast message to them by channel.</p>", "body": "" }, "full_description": "<p>Channel maintains the receiver collection for a subject. You can add users into a channel and then broadcast message to them by channel.</p>", "code": "var Channel = function(name, service) {\n  this.name = name;\n  this.groups = {};       // group map for uids. key: sid, value: [uid]\n  this.records = {};      // member records. key: uid\n  this.__channelService__ = service;\n  this.state = ST_INITED;\n};", "params": [], "has_params": false, "tags": [{ "type": "class", "string": "channel" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "83-1387877793312", "name": "add", "signiture": "Channel.prototype.add()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "add", "string": "Channel.prototype.add()" }, "description": { "full": "<p>Add user to channel.</p>", "summary": "<p>Add user to channel.</p>", "body": "" }, "full_description": "<p>Add user to channel.</p>", "code": "Channel.prototype.add = function(uid, sid) {\n  if(this.state > ST_INITED) {\n    return false;\n  } else {\n    var res = add(uid, sid, this.groups);\n    if(res) {\n      this.records[uid] = {sid: sid, uid: uid};\n    }\n    return res;\n  }\n};", "params": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "84-1387877793312", "name": "leave", "signiture": "Channel.prototype.leave()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "leave", "string": "Channel.prototype.leave()" }, "description": { "full": "<p>Remove user from channel.</p>", "summary": "<p>Remove user from channel.</p>", "body": "" }, "full_description": "<p>Remove user from channel.</p>", "code": "Channel.prototype.leave = function(uid, sid) {\n  if(!uid || !sid) {\n    return false;\n  }\n  delete this.records[uid];\n  var res = deleteFrom(uid, sid, this.groups[sid]);\n  if(this.groups[sid] && this.groups[sid].length === 0) {\n    delete this.groups[sid];\n  }\n  return res;\n};", "params": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to." }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id" }, { "type": "param", "types": ["String"], "name": "sid", "description": "frontend server id which user has connected to." }, { "type": "return", "types": ["[Boolean]"], "description": "true if success or false if fail" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "85-1387877793312", "name": "getMembers", "signiture": "Channel.prototype.getMembers()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "getMembers", "string": "Channel.prototype.getMembers()" }, "description": { "full": "<p>Get channel members.</p>\n\n<p><b>Notice:</b> Heavy operation.</p>", "summary": "<p>Get channel members.</p>", "body": "<p><b>Notice:</b> Heavy operation.</p>" }, "full_description": "<p>Get channel members.</p>\n\n<p><b>Notice:</b> Heavy operation.</p>", "code": "Channel.prototype.getMembers = function() {\n  var res = [], groups = this.groups;\n  var group, i, l;\n  for(var sid in groups) {\n    group = groups[sid];\n    for(i=0, l=group.length; i<l; i++) {\n      res.push(group[i]);\n    }\n  }\n  return res;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Array"], "description": "channel member uid list" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "86-1387877793312", "name": "getMember", "signiture": "Channel.prototype.getMember()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "getMember", "string": "Channel.prototype.getMember()" }, "description": { "full": "<p>Get Member info.</p>", "summary": "<p>Get Member info.</p>", "body": "" }, "full_description": "<p>Get Member info.</p>", "code": "Channel.prototype.getMember = function(uid) {\n  return this.records[uid];\n};", "params": [{ "type": "param", "types": ["String"], "name": "uid", "description": "user id" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "uid", "description": "user id" }, { "type": "return", "types": ["Object"], "description": "member info" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }, { "id": "87-1387877793312", "name": "destroy", "signiture": "Channel.prototype.destroy()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "destroy", "string": "Channel.prototype.destroy()" }, "description": { "full": "<p>Destroy channel.</p>", "summary": "<p>Destroy channel.</p>", "body": "" }, "full_description": "<p>Destroy channel.</p>", "code": "Channel.prototype.destroy = function() {\n  this.state = ST_DESTROYED;\n  this.__channelService__.destroyChannel(this.name);\n};", "params": [], "has_params": false, "tags": [], "module": false, "parent": "Channel", "has_related": false }, { "id": "88-1387877793312", "name": "pushMessage", "signiture": "Channel.prototype.pushMessage()", "type": "method", "ctx": { "type": "method", "constructor": "Channel", "cons": "Channel", "name": "pushMessage", "string": "Channel.prototype.pushMessage()" }, "description": { "full": "<p>Push message to all the members in the channel</p>", "summary": "<p>Push message to all the members in the channel</p>", "body": "" }, "full_description": "<p>Push message to all the members in the channel</p>", "code": "Channel.prototype.pushMessage = function(route, msg, opts, cb) {\n  if(this.state !== ST_INITED) {\n    utils.invokeCallback(new Error('channel is not running now'));\n    return;\n  }\n\n  if(typeof route !== 'string') {\n    cb = opts;\n    opts = msg;\n    msg = route;\n    route = msg.route;\n  }\n\n  if(!cb && typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  sendMessageByGroup(this.__channelService__, route, msg, this.groups, opts, cb);\n};", "params": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["String"], "name": "route", "description": "message route" }, { "type": "param", "types": ["Object"], "name": "msg", "description": "message that would be sent to client" }, { "type": "param", "types": ["Object"], "name": "opts", "description": "user-defined push options, optional" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "module": false, "parent": "Channel", "related": { "href": "" }, "has_related": true }] }, { "id": "106-1387877793312", "name": "SessionService", "signiture": "SessionService()", "type": "function", "ctx": { "type": "function", "name": "SessionService", "string": "SessionService()" }, "description": { "full": "<p>Session service maintains the internal session for each client connection.</p>\n\n<p>Session service is created by session component and is only<br /><b>available</b> in frontend servers. You can access the service by<br /><code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>", "summary": "<p>Session service maintains the internal session for each client connection.</p>", "body": "<p>Session service is created by session component and is only<br /><b>available</b> in frontend servers. You can access the service by<br /><code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>" }, "full_description": "<p>Session service maintains the internal session for each client connection.</p>\n\n<p>Session service is created by session component and is only <b>available</b> in frontend servers. You can access the service by <code>app.get('sessionService')</code> or <code>app.sessionService</code> in frontend servers.</p>", "code": "var SessionService = function(opts) {\n  opts = opts || {};\n  this.singleSession = opts.singleSession;\n  this.sessions = {};     // sid -> session\n  this.uidMap = {};       // uid -> sessions\n};\n\nmodule.exports = SessionService;", "params": [{ "type": "param", "types": ["Object"], "name": "opts", "description": "constructor parameters" }], "has_params": true, "tags": [{ "type": "param", "types": ["Object"], "name": "opts", "description": "constructor parameters" }, { "type": "class", "string": "" }, { "type": "constructor", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "107-1387877793312", "name": "kick", "signiture": "SessionService.prototype.kick()", "type": "method", "ctx": { "type": "method", "constructor": "SessionService", "cons": "SessionService", "name": "kick", "string": "SessionService.prototype.kick()" }, "description": { "full": "<p>Kick all the session offline under the user id.</p>", "summary": "<p>Kick all the session offline under the user id.</p>", "body": "" }, "full_description": "<p>Kick all the session offline under the user id.</p>", "code": "SessionService.prototype.kick = function(uid, reason, cb) {\n  // compatible for old kick(uid, cb);\n  if(typeof reason === 'function') {\n    cb = reason;\n    reason = 'kick';\n  }\n  var sessions = this.getByUid(uid);\n\n  if(sessions) {\n    // notify client\n    for(var i=0, l=sessions.length; i<l; i++) {\n      sessions[i].closed(reason);\n    }\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  } else {\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  }\n};", "params": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id asscociated with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "uid", "description": "user id asscociated with the session" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "SessionService" }], "module": false, "parent": "SessionService", "related": { "href": "" }, "has_related": true }, { "id": "108-1387877793312", "name": "kickBySessionId", "signiture": "SessionService.prototype.kickBySessionId()", "type": "method", "ctx": { "type": "method", "constructor": "SessionService", "cons": "SessionService", "name": "kickBySessionId", "string": "SessionService.prototype.kickBySessionId()" }, "description": { "full": "<p>Kick a user offline by session id.</p>", "summary": "<p>Kick a user offline by session id.</p>", "body": "" }, "full_description": "<p>Kick a user offline by session id.</p>", "code": "SessionService.prototype.kickBySessionId = function(sid, cb) {\n  var session = this.get(sid);\n\n  if(session) {\n    // notify client\n    session.closed('kick');\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  } else {\n    process.nextTick(function() {\n      utils.invokeCallback(cb);\n    });\n  }\n};", "params": [{ "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }], "has_params": true, "tags": [{ "type": "param", "types": ["Number"], "name": "sid", "description": "session id" }, { "type": "param", "types": ["Function"], "name": "cb", "description": "callback function" }, { "type": "", "string": "" }, { "type": "memberOf", "parent": "SessionService" }], "module": false, "parent": "SessionService", "related": { "href": "" }, "has_related": true }] }, { "id": "214-1387877793314", "name": "Pomelo", "signiture": "Pomelo", "type": "declaration", "ctx": { "type": "declaration", "name": "Pomelo", "value": "module.exports = {}", "string": "Pomelo" }, "description": { "full": "<p>Expose <code>createApplication()</code>.</p>", "summary": "<p>Expose <code>createApplication()</code>.</p>", "body": "" }, "full_description": "<p>Expose <code>createApplication()</code>.</p>", "code": "var Pomelo = module.exports = {};", "params": [], "has_params": false, "tags": [{ "type": "module", "string": "" }], "module": true, "related": { "href": "" }, "has_related": true, "methods": [{ "id": "222-1387877793314", "name": "createApp", "signiture": "Pomelo.createApp()", "type": "method", "ctx": { "type": "method", "receiver": "Pomelo", "name": "createApp", "string": "Pomelo.createApp()" }, "description": { "full": "<p>Create an pomelo application.</p>", "summary": "<p>Create an pomelo application.</p>", "body": "" }, "full_description": "<p>Create an pomelo application.</p>", "code": "Pomelo.createApp = function (opts) {\n  var app = application;\n  app.init(opts);\n  self.app = app;\n  return app;\n};", "params": [], "has_params": false, "tags": [{ "type": "return", "types": ["Application"], "description": "" }, { "type": "memberOf", "parent": "Pomelo" }, { "type": "api", "visibility": "public" }], "module": false, "parent": "Pomelo", "related": { "href": "" }, "has_related": true }] }]
  </script>
  <!-- Array，String，Object扩展函数（因为IE9-不支持，而Lunr有使用到) -->
  <script src="./pomelo API_files/extend.js.下载"></script>
  <!-- 将原来引用网上的jquery转为引用本地的 -->
  <script src="./pomelo API_files/jquery-1.6.4-min.js.下载"></script>
  <!-- 将Lunr和页面逻辑整合一起放在lunr.js文件 -->
  <script src="./pomelo API_files/lunr.js.下载"></script>
</head>

<body>
  <!-- BEGIN WAYBACK TOOLBAR INSERT -->
  <script type="text/javascript" src="./pomelo API_files/timestamp.js.下载" charset="utf-8"></script>
  <script type="text/javascript" src="./pomelo API_files/graph-calc.js.下载" charset="utf-8"></script>
  <script type="text/javascript" src="./pomelo API_files/auto-complete.js.下载" charset="utf-8"></script>
  <script type="text/javascript" src="./pomelo API_files/toolbar.js.下载" charset="utf-8"></script>
  <style type="text/css">
    body {
      margin-top: 0 !important;
      padding-top: 0 !important;
      /*min-width:800px !important;*/
    }

    .wb-autocomplete-suggestions {
      text-align: left;
      cursor: default;
      border: 1px solid #ccc;
      border-top: 0;
      background: #fff;
      box-shadow: -1px 1px 3px rgba(0, 0, 0, .1);
      position: absolute;
      display: none;
      z-index: 2147483647;
      max-height: 254px;
      overflow: hidden;
      overflow-y: auto;
      box-sizing: border-box;
    }

    .wb-autocomplete-suggestion {
      position: relative;
      padding: 0 .6em;
      line-height: 23px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 1.02em;
      color: #333;
    }

    .wb-autocomplete-suggestion b {
      font-weight: bold;
    }

    .wb-autocomplete-suggestion.selected {
      background: #f0f0f0;
    }
  </style>
  <div id="wm-ipp-base" lang="en" style="display: block; direction: ltr;">
  </div>
  <script type="text/javascript">
    __wm.bt(600, 27, 25, 2, "web", "http://pomelo.netease.com/api.html", "2017-05-21", 1996, "/static/", ['css/banner-styles.css', 'css/iconochive.css']);
  </script>
  <div class="wb-autocomplete-suggestions "></div>
  <!-- END WAYBACK TOOLBAR INSERT -->
  <!-- 顶栏 -->
  <div class="g-bar">
    <!-- 顶栏github模块 -->
    <div class="m-github">
      <span class="title">gitHub:</span><a class="link" target="_blank"
        href="https://github.com/NetEase/pomelo">http://github.com/NetEase/pomelo</a>
    </div>
  </div>
  <!-- 头部 -->
  <div class="g-hd">
    <div class="m-hdnav">
      <div class="bg">
        <div class="wrap">
          <ul class="cnt">
            <li><a href="./index.html">Home</a></li>
            <li><a href="./api.html">Api</a></li>
            <li><a href="./doc9.html">0.9新增</a></li>
            <li class="current"><a href="./doc10.html">0.10新增</a></li>
          </ul>
        </div>
      </div>
      <div class="logo"><a href="https://github.com/NetEase/pomelo">
          <div class="img"></div>
        </a></div>
    </div>
  </div>
  <!-- 整体居中 -->
  <div class="g-doc">
    <!-- 主体 -->
    <div class="g-bd">
      <!-- API主体 -->
      <div class="m-wrap">
        <!-- API -->
        <div class="container-lg new-discussion-timeline experiment-repo-nav  p-responsive content markdown-section">
          <div class="repository-content ">



            <div id="wiki-wrapper" class="page">





              <div id="wiki-wrapper" class="page">


                <div class="d-flex flex-column flex-md-row gh-header">
                  <h1 class="flex-auto min-width-0 mb-2 mb-md-0 mr-0 mr-md-2 gh-header-title instapaper_title">pomelo
                    1.0新特性</h1>

                  <div class="mt-0 mt-lg-1 flex-shrink-0 gh-header-actions">
                    <a href="#wiki-pages-box" class="d-md-none pl-2 float-right">Jump to bottom</a>

                    <a class="btn btn-sm ml-0"
                      href="/NetEase/pomelo/wiki/pomelo-1.0%E6%96%B0%E7%89%B9%E6%80%A7/_edit">Edit</a>
                    <a class="btn btn-sm btn-primary" href="/NetEase/pomelo/wiki/_new">New Page</a>
                  </div>
                </div>

                <div class="mt-2 mt-md-1 pb-3 gh-header-meta">
                  Wang Xy edited this page <relative-time datetime="2015-03-24T05:55:28Z"
                    title="2015年3月24日 GMT+8 下午1:55">on 24 Mar 2015</relative-time>
                  ·
                  <a href="/NetEase/pomelo/wiki/pomelo-1.0%E6%96%B0%E7%89%B9%E6%80%A7/_history" class="muted-link">
                    3 revisions
                  </a>
                </div>

                <div id="wiki-content" class="d-flex flex-column flex-md-row">
                  <div id="wiki-body" class="mt-4 flex-auto min-width-0 gollum-markdown-content instapaper_body">
                    <div class="markdown-body">
                      <h2>
                        <a id="user-content-pomelo-udpconnector提供" class="anchor"
                          href="#pomelo-udpconnector%E6%8F%90%E4%BE%9B" aria-hidden="true"><svg
                            class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>pomelo udpconnector提供</h2>
                      <p>根据网友的要求，在pomelo
                        1.0中提供了udpconnector。在该udpconnector中，采用了pomelo之前hybridconnector提供的传输协议，包括握手、心跳及数据包的格式。该connector中通过客户端的ip和port来对客户端进行唯一标识，客户端的断开则是通过心跳超时进行判定。
                      </p>
                      <p>使用方法：</p>
                      <pre><code>
              // app configuration
              
              app.configure('production|development', 'connector', function() {
              
                app.set('connectorConfig',
                  {
                    connector : pomelo.connectors.udpconnector,
                    heartbeat : 3
                  });
              });
              
              </code></pre>
                      <p>由于pomelo中提供的客户端还没有支持udp的，所以在1.0.0中提供一个node版本的udp client，配合通过pomelo init出来的demo使用，具体可以参考<a
                          href="https://github.com/py8765/udpclient/tree/master">udpclient</a></p>
                      <h2>
                        <a id="user-content-pomelo-rpc-负载均衡及容错机制" class="anchor"
                          href="#pomelo-rpc-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%8F%8A%E5%AE%B9%E9%94%99%E6%9C%BA%E5%88%B6"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>pomelo-rpc 负载均衡及容错机制</h2>
                      <p>在pomelo
                        1.0版本中，pomelo-rpc提供了相关的负载均衡算法，开发者在调用rpc时，可以选择相应的路由算法，rpc框架会根据不同的配置在rpc客户端进行路由算法的选择，从而完成相应的rpc调用。提供的负载均衡算法包括：rr（ROUNDROBIN）,
                        wrr(WEIGHT_ROUNDROBIN), la(LEAST_ACTIVE), ch(CONSISTENT_HASH)。</p>
                      <p>配置方法：</p>
                      <pre><code>
              // rr
              
              app.configure('production|development', 'connector', function() {
              
                app.set('proxyConfig',
                  {
                    routerType: 'rr'
                  });
              });
              
              //基于权重的rr，在servers.json中对rpc目标服务器进行权重配置
              
              app.configure('production|development', 'connector', function() {
              
                app.set('proxyConfig',
                  {
                    routerType: 'wrr'
                  });
              });
              
               "read": [
               
                  {"id": "read-server-1", "host": "127.0.0.1", "port": 4150, "weight": 1},
                  {"id": "read-server-2", "host": "127.0.0.1", "port": 4151, "weight": 5},
                  {"id": "read-server-3", "host": "127.0.0.1", "port": 4152, "weight": 8}
               ]
              
              //la
              
              app.configure('production|development', 'connector', function() {
              
                app.set('proxyConfig',
                  {
                    routerType: 'la'
                  });
              });
              
              //consistent_hash
              
              app.configure('production|development', 'connector', function() {
              
                app.set('proxyConfig',
                  {
                    routerType: 'ch',
                          replicas: '100',   //虚拟节点数量
                          algorithm: 'md5',  //hash算法
                    hashFieldIndex: 0 //根据rpc参数列表中的具体参数进行hash
                  });
              });
              
              </code></pre>
                      <p>
                        ps:　如果使用toServer('chat-server-1')这种指定rpc目标服务器的rpc调用则不会使用相关的负载均衡算法，如果是指定了routerType则之前在application对象中设置的route函数则无效；综合这三种方式的优先级是toServer
                        &gt; 指定routerType &gt; 指定路由函数。</p>
                      <p>
                        在新版本中,pomelo-rpc模块提供了相关的容错机制，包括failover，即失败自动切换，当出现失败，重试其它同类型服务器，这种模式通常用于读操作，但重试可能会带来更长延迟；failfast是快速失败，其策略为只发起一次rpc调用，失败后就立即将错误信息返回；failsafe则是一种安全策略，也是rpc默认采用的，即根据rpc的不同类型错误进行不同的处理策略，主要是发起连接重试和发送重试操作。
                      </p>
                      <p>配置方法：</p>
                      <pre><code>
              //快速失败
              
              app.configure('production|development', 'connector', function() {
              
                app.set('proxyConfig',
                  {
                    failMode : 'failfast'
                  });
              });
              
              //切换服务器
              
              app.configure('production|development', 'connector', function() {
              
                app.set('proxyConfig',
                  {
                    failMode : 'failover'
                  });
              });
              
              //安全策略
              
              app.configure('production|development', 'connector', function() {
              
                app.set('proxyConfig',
                  {
                    failMode : 'failsafe',
                    retryTimes:　3， //重试次数
                    retryConnectTime：　5 * 1000 //重连间隔时间
                  });
              });
              
              
              </code></pre>
                      <p>ps: rpc默认采用安全策略。</p>
                      <h2>
                        <a id="user-content-pomelo-支持tls及wss" class="anchor"
                          href="#pomelo-%E6%94%AF%E6%8C%81tls%E5%8F%8Awss" aria-hidden="true"><svg
                            class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>pomelo 支持tls及wss</h2>
                      <p>考虑到安全性方面的问题，pomelo
                        1.0版本中增加了对tls及wss协议的支持；在之前的pomelo版本中，提供了hybridconnector和sioconnector；对于sioconnector,其底层使用的是socket.io，socket.io提供了包括websocket和长轮询等几种传输方式，其中websocket默认采用的ws协议，现在pomelo支持wss协议，即用户可以在sioconnector中配置基于wss协议的websocket的通信方式；对于hybridconnector,提供包括原生socket的支持和websocket的支持，针对这两种方式，在pomelo
                        1.0中提供了两种连接的安全版本即tls和wss,用户可以在使用hybridconnector时，采用安全级别较高的tls或者wss。</p>
                      <p>使用方法：</p>
                      <p>支持tls客户端，pomelo现在提供的tls客户端有libpomelo.</p>
                      <pre><code>
              app.configure('production|development', 'connector', function() {
              
                app.set('connectorConfig',
              
                  {
                    connector : pomelo.connectors.hybridconnector,
                    heartbeat : 3,
                    useDict : true,
                    useProtobuf : true,
                    ssl: {
                      key: fs.readFileSync('./keys/server.key'),
                  cert: fs.readFileSync('./keys/server.crt'),
                    }
                  });
              });
              
              </code></pre>
                      <p>支持wss客户端, pomelo提供的wss客户端有js客户端.</p>
                      <pre><code>
              app.configure('production|development', 'connector', function() {
              
                app.set('connectorConfig',
              
                  {
                    connector : pomelo.connectors.hybridconnector,
                    heartbeat : 3,
                    useDict : true,
                    useProtobuf : true,
                    ssl: {
                      key: fs.readFileSync('./keys/server.key'),
                  cert: fs.readFileSync('./keys/server.crt'),
                    }
                  });
              });
              
              </code></pre>
                      <p>支持socket.io的wss客户端, pomelo提供的socket.io的wss客户端有js客户端.</p>
                      <pre><code>
              app.configure('production|development', 'connector', function() {
              
                app.set('connectorConfig',
              
                  {
                    connector : pomelo.connectors.sioconnector,
                    key: fs.readFileSync('./keys/server.key'),
                    cert: fs.readFileSync('./keys/server.crt')
                  });
              });
              
              
              </code></pre>
                      <p>在pomelo 1.0中增加了通过pomelo init
                        获取wss和socket.io的wss两种客户端及服务端的初始化项目，同时初始化的项目中提供了相应的密钥及证书。注意由于证书是和域名绑定的，所以在打开客户端的时候输入的ip地址为 <a
                          href="https://127.0.0.1:3001" rel="nofollow">https://127.0.0.1:3001</a></p>
                      <h2>
                        <a id="user-content-pomelo-提供zookeeper集群管理" class="anchor"
                          href="#pomelo-%E6%8F%90%E4%BE%9Bzookeeper%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>pomelo 提供zookeeper集群管理</h2>
                      <p>
                        在pomelo之前版本中，提供了master服务器进行集群管理，对于中小型游戏项目及非大型分布式集群项目来说已经能够满足需求；对于大型的分布式项目的集群管理，zookeeper则是最佳选择。为了让pomelo在更广泛的领域适用，在1.0版本中pomelo提供了zookeeper的插件。
                      </p>
                      <p>
                        其主要原理是利用zookeeper的集群管理，使得pomelo集群中服务器信息保持一致，确保pomelo对外提供稳定的服务。具体实现则是master服务器启动后主动向zookeeper注册一个根节点，其它服务器启动后作为这个根节点的孩子注册到zookeeper,并将服务器相关信息写入，同时非master服务器监听该根节点的孩子节点变化情况；一旦孩子节点有变化，则其它节点重新从根节点或者当前集群中服务器信息。
                      </p>
                      <p>使用方法：</p>
                      <pre><code>
                 var zookeeper = require('pomelo-zookeeper-plugin');
              
                 app.configure('production|development', function() {
              
                  //关闭master集群管理功能
                app.set('masterConfig', {
                  closeWatcher: true
                });
                app.set('monitorConfig', {
                  closeWatcher: true
                });
              
                app.use(zookeeper, {
                  zookeeper: {
                    server: '127.0.0.1:2181',
                    path: '/pomelo/servers',
                    username: 'pomelo',
                    password: 'pomelo'
                  }
                });
               
                }
              
              </code></pre>
                      <p>github地址： <a
                          href="https://github.com/NetEase/pomelo-zookeeper-plugin">pomelo-zookeeper-plugin</a></p>
                      <h2>
                        <a id="user-content-libpomelo-提供自动重连及ssltls支持" class="anchor"
                          href="#libpomelo-%E6%8F%90%E4%BE%9B%E8%87%AA%E5%8A%A8%E9%87%8D%E8%BF%9E%E5%8F%8Assltls%E6%94%AF%E6%8C%81"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>libpomelo 提供自动重连及SSL/TLS支持</h2>
                      <h1>
                        <a id="user-content-libpomelo自动重连" class="anchor"
                          href="#libpomelo%E8%87%AA%E5%8A%A8%E9%87%8D%E8%BF%9E" aria-hidden="true"><svg
                            class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>libpomelo自动重连</h1>
                      <p>关于libpomelo的自动重连，目前使用的策略为一旦检测到读写socket错误或者数据包解析遇到非法包时，将重置连接，并发起自动重连，重连成功后抛出reconnect事件。
                        用户可以通过显式地调用pc_client_disconnect来断开连接，这样的话，将不会发起自动重连。</p>
                      <p>新增API:</p>
                      <ul>
                        <li>pc_client_t* pc_client_new_with_reconnect(int delay, int delay_max, int exp_backoff);
                          参数说明：
                          delay - 这个参数是重连时，用来退避的延时值，单位为秒
                          delay_max - 这个参数是重连时最大延时值，单位也为秒
                          exp_backoff - 是否开启指数退避，非0时为开启指数退避，为0时不开启指数退避
                          返回值：
                          成功，返回创建成功的实例
                          失败，返回NULL</li>
                      </ul>
                      <p>例如，如果delay为2s，delay_max为10s，exp_backoff为0，不开启指数退避，那么重连时的连接重试间隔将为
                        2s， 4s， 6s， 8s， 10s， 10s， 10s......直到连接上为止</p>
                      <pre><code>  如果delay为2s， delay_max为30s，exp_backoff为1， 开启指数退避，那么重连时的连接重试间隔将为
                 2s， 4s， 8s， 16s， 30s， 30s.....直到连接上为止
              </code></pre>
                      <ul>
                        <li>void pc_client_disconnect(pc_client_t* client);
                          参数说明:
                          client 为pomelo client实例</li>
                      </ul>
                      <h1>
                        <a id="user-content-libpomelo-ssltls支持" class="anchor"
                          href="#libpomelo-ssltls%E6%94%AF%E6%8C%81" aria-hidden="true"><svg
                            class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>libpomelo SSL/TLS支持</h1>
                      <p>libpomelo目前计划支持SSL/TLS，使用OpenSSL。在使用TLS支持时，在编译时需开启宏 WITH_TLS。 <strong>拟</strong>增加API如下：</p>
                      <ul>
                        <li>
                          <p>int pc_client_lib_init();
                            这个函数主要用来做一些全局SSL/TLS相关的以及库相关的初始化，此函数应该在所有其他库函数执行前调用一次，不用检查返回值，返回值永远为0。</p>
                        </li>
                        <li>
                          <p>int pc_client_lib_cleanup();
                            这个函数与pc_client_lib_init相对应，用来在应用关闭时，对整个库做一些全局化的清理工作，其应当是最后一个被调用的库函数，返回值永远为0</p>
                        </li>
                        <li>
                          <p>int pc_client_set_tls_ca(pc_client_t* client, const char* cafile, const char* capath)
                            这个函数用来设置SSL/TLS用到的ca信息.
                            参数说明：
                            client - pomelo client实例.
                            cafile,capath - 这两个参数用来指定ca信息，具体请参见SSL的调用<a
                              href="https://www.openssl.org/docs/ssl/SSL_CTX_load_verify_locations.html"
                              rel="nofollow">SSL_CTX_load_verify_locations</a>.
                            返回值:
                            成功，返回值为0
                            参数错误时，返回值为-1</p>
                        </li>
                        <li>
                          <p>int pc_client_set_tls_cert(pc_client_t* client, const char* certfile, const char* keyfile,
                            int (*pw_callback)(char* buf, int size, int rwflag, void* userdata));
                            这个函数是服务端要求对pc client进行验证时，用来设置客户端的证书以及私钥信息， 如果不需要双向验证，则不需要设置。</p>
                        </li>
                      </ul>
                      <p>参数说明:
                        cerfile - 存放证书链的文件，PEM格式，具体请参见OpenSSL的调用<a
                          href="https://www.openssl.org/docs/ssl/SSL_CTX_use_certificate.html"
                          rel="nofollow">SSL_CTX_use_certificate_chain_file</a>
                        keyfile - 存放私钥的文件，PEM格式。
                        pw_callback - 如果私钥文件使用口令加密的话，此参数会被回调用来传递解密私钥文件的口令，否则为NULL即可，具体参见 <a
                          href="https://www.openssl.org/docs/ssl/SSL_CTX_set_default_passwd_cb.html#"
                          rel="nofollow">SSL_CTX_set_default_passwd_cb</a></p>
                      <ul>
                        <li>
                          <p>int pc_client_set_tls_opts(pc_client_t* client, int enable_verify, const char* ciphers);
                            这个参数是用来设置SSL的一些选项的，OpenSSL的提供的选项很多，这里仅提供了两处选项设置
                            参数说明：
                            enable_verify - 是否开启服务端证书验证，将此值设置为0，将不验证服务端证书，设置为1将验证服务端证书，缺省时不对服务端证书进行验证
                            ciphers - 一个字符串用来说明可用的加密算法，如果使用缺省值的话，只需设置为NULL即可</p>
                        </li>
                        <li>
                          <p>int pc_client_set_tls_hostname_verify(pc_client_t* client, int
                            (*hostname_verify_cb)(pc_client_t* client, const char** names, int len));
                            这个函数用来设置对服务端的hostname进行验证的回调的</p>
                        </li>
                      </ul>
                      <p>参数说明：
                        hostname_verify_cb -
                        这个参数是一个回调用来验证服务器端证书中的SAN以及CN字段的，如果设置了此回调，那么当收到证书后，libpomelo会从证书中解析出SAN和CN，并调用此回调函数，此函数返回1表示验证通过，返回0表示验证失败，参数
                        names 和 len
                        是用来表示一个字符串数组，其内部存储着证书中解析出来的SAN和CN。对于names，用户在实现回调时，只需要访问其获取SAN和CN即可，不要对其进行其他的操作，libpomelo会负责其内存的申请和释放。
                      </p>
                      <h1>
                        <a id="user-content-说明" class="anchor" href="#%E8%AF%B4%E6%98%8E" aria-hidden="true"><svg
                            class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>说明</h1>
                      <p>
                        关于自动重连和TLS支持，目前还处于实验阶段，其中自动重连已经可以测试，但是TLS实现尚未加完，在github上有auto-reconn分支和ssl分支，也欢迎各位把你修改后的或者更好的实现代码贡献出来,
                        谢谢。
                        关于libpomelo任何想法，无论是代码组织，还是具体的实现策略，欢迎大家互相交流。</p>
                      <h2>
                        <a id="user-content-pomelo-提供自动扩展插件" class="anchor"
                          href="#pomelo-%E6%8F%90%E4%BE%9B%E8%87%AA%E5%8A%A8%E6%89%A9%E5%B1%95%E6%8F%92%E4%BB%B6"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>pomelo 提供自动扩展插件</h2>
                      <p>
                        在pomelo1.0里提供了一个服务器自动扩展的插件，其主要原理是监控某一类型的服务器，监控的指标现在暂时提供cpu和memory，当这一类型的服务器的某项监控指标超过之前设置的阈值时，服务器就自动扩展，扩展服务器的数量可以由用户进行配置。
                      </p>
                      <p>使用方法：</p>
                      <pre><code>//app.js配置方法
              
              app.configure('production|development', 'master', function() {
              
                app.use(scale, {
                  scale: {
                    cpu: {
                      chat: 5,
                      interval: 10 * 1000,
                      increasement: 1
                    },
                    memory: {
                      connector: 5,
                      interval: 15 * 1000,
                      increasement: 1
                    },
                    backup: 'config/development/backupServers.json'
                  }
                });
              });
              
              </code></pre>
                      <pre><code>//backupServer.json配置
              
              {
                  "connector":[
              
                           {"id":"backup-connector-server-1", "host":"127.0.0.1", "port":4053, "clientPort": 3053, "frontend": true},
                           {"id":"backup-connector-server-2", "host":"127.0.0.1", "port":4054, "clientPort": 3054, "frontend": true},
                           {"id":"backup-connector-server-3", "host":"127.0.0.1", "port":4055, "clientPort": 3055, "frontend": true}
                       ],
                      "chat":[
                           {"id":"backup-chat-server-1", "host":"127.0.0.1", "port":6053},
                           {"id":"backup-chat-server-2", "host":"127.0.0.1", "port":6054},
                           {"id":"backup-chat-server-3", "host":"127.0.0.1", "port":6055}
                      ]
              }
              
              
              </code></pre>
                      <p>配置参数说明：</p>
                      <p>
                        现在监控指标包括cpu和memory两项，在每一个监控指标内可以有监控的服务器类型，例如chat：5，这样就表示chat类型的服务器的阈值为5%，当chat类型的服务器cpu的平均值超过5%后，系统将自动扩展服务器，服务器一次扩展的数量由increasement参数决定，例如increasement参数为1，则表示每次超过阈值后扩展1个服务器，扩展服务器的列表由用户指定，backup参数就是扩展的服务器列表；另外interval参数表示系统检测时间，单位是秒，例如interval:
                        15 * 1000表示系统每15秒检测一次相应的指标，如果超过该指标则进行相应的扩展。</p>
                      <p>github地址： <a href="https://github.com/NetEase/pomelo-scale-plugin">pomelo-scale-plugin</a></p>
                      <h2>
                        <a id="user-content-支持按环境目录配置" class="anchor"
                          href="#%E6%94%AF%E6%8C%81%E6%8C%89%E7%8E%AF%E5%A2%83%E7%9B%AE%E5%BD%95%E9%85%8D%E7%BD%AE"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>支持按环境目录配置</h2>
                      <p>在pomelo1.0中支持按照目录结构进行配置相关的配置文件，在之前的版本中pomelo的配置文件如下图所示：</p>
                      <img src="https://raw.githubusercontent.com/py8765/pomelo_images/master/dir.bmp">
                      <p>不同环境是根据具体配置文件里的key进行区分，例如：</p>
                      <pre><code>
              // servers.json配置
              
              {
                  "development":{
              
                      "connector":[
                           {"id":"connector-server-1", "host":"127.0.0.1", "port":4050, "clientPort": 3050, "frontend": true}
                       ]
                  },
                  "production":{
                         "connector":[
                           {"id":"connector-server-1", "host":"127.0.0.1", "port":4050, "clientPort": 3050, "frontend": true}
                       ]
                }
              }
              
              </code></pre>
                      <p>在pomelo1.0支持根据目录进行配置，如下图所示：</p>
                      <img src="https://raw.githubusercontent.com/py8765/pomelo_images/master/new_dir.bmp">
                      <p>config 目录下是根据环境进行文件配置， 在启动过程中选择不同的环境就会根据相应的环境名称目录加载该目录下的所有配置文件。例如 pomelo start env=online
                        这样就会加载config/online目录下的所有配置文件。默认会加载development下面的配置文件。在这种情况下，对应的servers.json就不需要根据环境配置，具体配置如下：
                      </p>
                      <pre><code>
              {
              
                      "connector":[
                           {"id":"connector-server-1", "host":"127.0.0.1", "port":4050, "clientPort": 3050, "frontend": true}
                       ]
              }
              
              
              </code></pre>
                      <p>PS:
                        默认还是会直接加载config目录下的配置文件，当config目录下面没有对应的文件系统将才会加载环境名称对应的目录下的配置文件；所以要使用根据环境名称目录进行配置时需要先将config目录下之前的配置文件删除。
                      </p>
                      <h2>
                        <a id="user-content-支持pomelo-cli输入脚本" class="anchor"
                          href="#%E6%94%AF%E6%8C%81pomelo-cli%E8%BE%93%E5%85%A5%E8%84%9A%E6%9C%AC"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>支持pomelo-cli输入脚本</h2>
                      <p>pomelo
                        1.0版本中，在pomelo-cli中增加了对脚本输入的支持，主要是方便通过pomelo-cli对不同服务器进行动态地查看相关信息，例如在前端服务器查看相应的session数量，某一个用户的session，或者某一个用户的地址信息等等。
                      </p>
                      <p>使用方法：</p>
                      <pre><code>
              pomelo-cli　　//进入pomelo-cli
              
              use connector-server-1  //使用具体服务器
              
              run app.get("sessionService").getSessionsCount()  //执行相应的命令
              
              
              </code></pre>
                      <p>ps: 脚本默认app为每个服务器的application对象，考虑到通过application对象可以获取到这个服务器的所有信息，所以在这个执行脚本中只提供application对象。
                      </p>
                      <h2>
                        <a id="user-content-sioconnector支持低版本的ie浏览器" class="anchor"
                          href="#sioconnector%E6%94%AF%E6%8C%81%E4%BD%8E%E7%89%88%E6%9C%AC%E7%9A%84ie%E6%B5%8F%E8%A7%88%E5%99%A8"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>sioconnector支持低版本的IE浏览器</h2>
                      <p>
                        之前有很多网友提出希望sioconnector支持低版本的IE浏览器，因为之前sioconnector的通信方法使用了pomelo-protocol,在encode/decode过程中使用了一些低版本IE浏览器不支持的数据结构，在1.0正式版本的pomelo中提供了新的js客户端对IE低版本的客户端支持。客户端代码地址：<a
                          href="https://github.com/pomelonode/pomeloclient">pomeloclient.js</a></p>
                      <p>使用方法：</p>
                      <p>在web-server中将之前的pomeloclient.js替换为pomeloclient_ie.js，在game-server中进行对app.js进行配置如下：</p>
                      <pre><code>
              var encode = function(reqId, route, msg) {
              
                  if (!!reqId) {
                      return{
                          id: reqId,
                          body: msg
                      };
                  } else {
                      var m = {
                          route: route,
                          body: msg
                      };
                      return JSON.stringify(m);
                  }
              };
              
              var decode = function(data) {
              
                  data = JSON.parse(data);
                  return {
                      id: data.id,
                      route: data.route,
                      body: data.msg
                  };
              };
              
              //将对应的前端服务器进行配置
              app.configure('production|development', 'connector|gate', function() {
              
                      app.set('connectorConfig', {
                      connector: pomelo.connectors.sioconnector,
                      encode: encode,
                      decode: decode
                  });
              });
              
              
              </code></pre>
                      <h2>
                        <a id="user-content-mqtt-connector-支持" class="anchor" href="#mqtt-connector-%E6%94%AF%E6%8C%81"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>mqtt connector 支持</h2>
                      <p>在1.0正式版本的pomelo中，发布了mqtt connector.考虑到pomelo本身的体系的兼容，mqtt
                        connector实际上并未采用publish/subscribe的模式。因为mqtt本身协议具有精简、灵活等优势，比较适合移动设备使用，所以pomelo引入mqtt
                        connector主要是使用其协议。</p>
                      <p>使用方法：</p>
                      <pre><code>
              app.configure('production|development', 'connector', function() {
              
               app.set('connectorConfig', {
              
                  connector: mqttconnector,
                  publishRoute: 'connector.mqttHandler.publish',
                  subscribeRoute: 'connector.mqttHandler.subscribe'
                });
              
              });
              
              
              </code></pre>
                      <p>其中publishRoute指的是客户端通过publish方法发到服务端的消息所导向的handler具体方法，例如publishRoute:
                        'connector.mqttHandler.publish'表示客户端的publish消息将导入connector的mqttHandler文件的publish方法，subscribeRoute与publishRoute类似。
                      </p>
                      <h2>
                        <a id="user-content-handler及remote的部分热更新支持" class="anchor"
                          href="#handler%E5%8F%8Aremote%E7%9A%84%E9%83%A8%E5%88%86%E7%83%AD%E6%9B%B4%E6%96%B0%E6%94%AF%E6%8C%81"
                          aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1"
                            width="16" height="16" aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>handler及remote的部分热更新支持</h2>
                      <p>
                        在1.0正式版本中，提供了handler和remote的热更新的部分支持。在pomelo1.0正式版中，提供对handler和remote两个目录中的文件进行监控，当有文件更新时，系统会重新load对应的handler和remote服务，这时当有新的handler请求和rpc请求进入时，系统就会自动执行更新后的服务。但是对于在非handler和remote目录的文件就不支持热更新。热更新开关默认是关闭状态，用户可以通过配置打开热更新服务。
                      </p>
                      <p>使用方法：</p>
                      <pre><code>
                // handler 热更新开关 
              
                app.set('serverConfig',
                {
                  reloadHandlers: true
                });
              
              
               // remote 热更新开关 
                app.set('remoteConfig',
                {
                  reloadRemotes: true
                });
              
              
              </code></pre>
                      <h2>
                        <a id="user-content-其它" class="anchor" href="#%E5%85%B6%E5%AE%83" aria-hidden="true"><svg
                            class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16"
                            aria-hidden="true">
                            <path fill-rule="evenodd"
                              d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
                            </path>
                          </svg></a>其它</h2>
                      <p>
                        在1.0版本中取消对toobusy和ndump模块的支持，但保留toobusy的filter,如果需要可以自己在项目中安装toobusy模块；对于ndump则采用node-heapdump取代，pomelo-cli暂时只支持对内存的dump，停止对cpu
                        dump的支持。</p>

                    </div>

                    <div id="wiki-footer" class="mt-5 mb-0 wiki-footer gollum-markdown-content">
                      <div class="Box Box--condensed bg-gray box-shadow">
                        <div class="Box-body wiki-writable markdown-body">
                          <a href="/NetEase/pomelo/wiki/_Footer/_edit" class="position-relative float-right muted-link"
                            title="Edit footer" style="right: -5px; z-index: 2">
                            <svg class="octicon octicon-pencil" viewBox="0 0 14 16" version="1.1" width="14" height="16"
                              aria-hidden="true">
                              <path fill-rule="evenodd"
                                d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996 0 0 1 1.41 0l1.59 1.59c.39.39.39 1.02 0 1.41z">
                              </path>
                            </svg>
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>


              </div>
              <div class="modal-backdrop js-touch-events"></div>


              <div class="mt-2 mt-md-1 pb-3 gh-header-meta">
                py edited this page <relative-time datetime="2014-02-26T06:32:49Z" title="2014年2月26日 GMT+8 下午2:32">on 26
                  Feb 2014</relative-time>
                ·
                <a href="/NetEase/pomelo/wiki/pomelo-0.9%E6%96%B0%E7%89%B9%E6%80%A7/_history" class="muted-link">
                  1 revision
                </a>
              </div>
            </div>
          </div>
        </div>

      
      </div>
    </div>
  </div>
  <!-- 尾部 -->
  <div class="g-ft">
    <!-- 尾部模块 -->
    <div class="m-ft">
      copyright 2012, NetEase, Inc. All Rights Reserved.
    </div>
  </div>
  <!-- 向上图标 -->
  <div class="m-arrow f-dn"><a href="https://github.com/NetEase/pomelo"></a></div>
  <!-- 代码高亮模块 -->
  <script src="./pomelo API_files/hijs.js.下载"></script>
  <!-- 页面效果模块 -->
  <script src="./pomelo API_files/api.js.下载"></script>


  <!--
     FILE ARCHIVED ON 09:56:39 May 21, 2017 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 08:03:27 Apr 17, 2019.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
  <!--
playback timings (ms):
  LoadShardBlock: 38.391 (3)
  esindex: 0.009
  captures_list: 63.134
  CDXLines.iter: 9.271 (3)
  PetaboxLoader3.datanode: 79.422 (4)
  exclusion.robots: 0.271
  exclusion.robots.policy: 0.258
  RedisCDXSource: 12.031
  PetaboxLoader3.resolve: 29.114
  load_resource: 77.579
-->
</body>

</html>